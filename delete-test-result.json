
> zakapp@0.9.2 test
> npm run test:server && npm run test:client && npm run test:cli --testNamePattern=DELETE.*soft delete.*record --reporter=json


> zakapp@0.9.2 test:server
> cd server && npm test


> zakapp-server@0.9.2 test
> vitest run


 RUN  v3.2.4 /home/chuwi_agent/workspace/zakapp/server

[globalSetup] Preparing test database schema...
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "base.db" at "file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/base.db"

The database is already in sync with the Prisma schema.

Running generate... (Use --skip-generate to skip the generators)
[2K[1A[2K[GRunning generate... - Prisma Client
[2K[1A[2K[Gâœ” Generated Prisma Client (v6.19.2) to ./node_modules/@prisma/client in 309ms

[globalSetup] Base test database schema created.
[globalSetup] Test database schema is ready.
stdout | ../tests/contract/payment-records.contract.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c3abcbfd781bb490.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c3abcbfd781bb490.db

stdout | tests/integration/liveTracking.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-907a17a29692f9d8.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-907a17a29692f9d8.db

stdout | ../tests/contract/assets-post.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2c2081f0bc0b0207.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2c2081f0bc0b0207.db

stdout | ../tests/contract/assets-post.test.ts > Contract Test: POST /api/assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/payment-records.contract.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/liveTracking.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/liveTracking.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/assets-post.test.ts > Contract Test: POST /api/assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/payment-records.contract.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 388.475 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 391.915 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 396.017 ms - -[0m
[0mPOST /api/assets [32m201[0m 15.390 ms - 503[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmb5x00050grsev2oa5da 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmb5x00050grsev2oa5da for user cmldqmb3c00000grsjdu06xsf 

[0mPOST /api/nisab-year-records [32m201[0m 23.823 ms - 797[0m
[0mGET /api/nisab-year-records/status [32m200[0m 4.752 ms - 222[0m
[0mGET /api/nisab-year-records/cmldqmb5x00050grsev2oa5da [32m200[0m 8.582 ms - -[0m
[0mPOST /api/assets [32m201[0m 8.601 ms - 503[0m
[0mGET /api/nisab-year-records/cmldqmb5x00050grsev2oa5da [32m200[0m 3.738 ms - -[0m
[0mPOST /api/assets [33m400[0m 1.008 ms - 191[0m
[0mPOST /api/assets [32m201[0m 8.965 ms - 506[0m
[0mGET /api/nisab-year-records/cmldqmb5x00050grsev2oa5da [32m200[0m 4.231 ms - -[0m
[0mPOST /api/assets [32m201[0m 8.406 ms - 506[0m
[0mGET /api/nisab-year-records/cmldqmb5x00050grsev2oa5da [32m200[0m 6.362 ms - -[0m
[0mGET /api/nisab-year-records/cmldqmb5x00050grsev2oa5da [32m200[0m 6.720 ms - -[0m
[0mPOST /api/assets [32m201[0m 10.026 ms - 515[0m
[0mGET /api/nisab-year-records/cmldqmb5x00050grsev2oa5da [32m200[0m 4.123 ms - -[0m
[0mPOST /api/assets [32m201[0m 124.212 ms - 497[0m
[0mPOST /api/auth/login [32m200[0m 343.531 ms - -[0m
[0mPOST /api/assets [32m201[0m 114.584 ms - 497[0m
[0mPOST /api/assets [32m201[0m 100.779 ms - 498[0m
 â¯ ../tests/contract/assets-post.test.ts (8 tests | 8 skipped) 4309ms
   â†“ Contract Test: POST /api/assets > POST /api/assets > should require authentication
   â†“ Contract Test: POST /api/assets > POST /api/assets > should create asset with valid data and return standardized response
   â†“ Contract Test: POST /api/assets > POST /api/assets > should validate required fields
   â†“ Contract Test: POST /api/assets > POST /api/assets > should validate asset type enum
   â†“ Contract Test: POST /api/assets > POST /api/assets > should validate currency format (ISO 4217)
   â†“ Contract Test: POST /api/assets > POST /api/assets > should validate minimum asset value
   â†“ Contract Test: POST /api/assets > POST /api/assets > should validate description length limit
   â†“ Contract Test: POST /api/assets > POST /api/assets > should handle all valid asset types
[0mPOST /api/assets [32m201[0m 134.761 ms - 498[0m
[0mPOST /api/assets [32m201[0m 121.262 ms - 498[0m
[0mPOST /api/auth/login [32m200[0m 362.155 ms - -[0m
[0mPOST /api/assets [32m201[0m 146.440 ms - 498[0m
[0mPOST /api/assets [32m201[0m 132.948 ms - 498[0m
[0mPOST /api/assets [32m201[0m 160.386 ms - 498[0m
[0mPOST /api/zakat/payments [32m201[0m 16.528 ms - 623[0m
[0mPOST /api/assets [32m201[0m 148.938 ms - 498[0m
[0mPOST /api/assets [32m201[0m 169.496 ms - 498[0m
[0mPOST /api/assets [32m201[0m 154.094 ms - 498[0m
[0mPOST /api/assets [32m201[0m 192.479 ms - 497[0m
[0mPOST /api/assets [32m201[0m 164.452 ms - 498[0m
[0mPOST /api/assets [32m201[0m 201.584 ms - 497[0m
[0mPOST /api/assets [32m201[0m 172.869 ms - 498[0m
[0mPOST /api/assets [32m201[0m 178.122 ms - 498[0m
[0mPOST /api/assets [32m201[0m 173.610 ms - 498[0m
[0mPOST /api/assets [32m201[0m 189.051 ms - 498[0m
[0mPOST /api/assets [32m201[0m 183.965 ms - 498[0m
[0mPOST /api/assets [32m201[0m 201.205 ms - 498[0m
[0mPOST /api/assets [32m201[0m 197.690 ms - 498[0m
[0mPOST /api/assets [32m201[0m 215.072 ms - 498[0m
[0mPOST /api/assets [32m201[0m 211.192 ms - 498[0m
[0mPOST /api/assets [32m201[0m 227.743 ms - 498[0m
[0mPOST /api/assets [32m201[0m 220.807 ms - 498[0m
[0mPOST /api/assets [32m201[0m 240.139 ms - 498[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

[0mPOST /api/assets [32m201[0m 245.696 ms - 498[0m
[0mPOST /api/assets [32m201[0m 244.597 ms - 498[0m
[0mPOST /api/assets [32m201[0m 245.635 ms - 498[0m
[0mPOST /api/assets [32m201[0m 257.153 ms - 498[0m
[0mPOST /api/assets [32m201[0m 257.237 ms - 498[0m
[0mPOST /api/assets [32m201[0m 267.252 ms - 498[0m
[0mPOST /api/assets [32m201[0m 266.339 ms - 498[0m
[0mPOST /api/assets [32m201[0m 269.762 ms - 498[0m
[0mPOST /api/assets [32m201[0m 276.233 ms - 498[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

[0mPOST /api/assets [32m201[0m 289.631 ms - 498[0m
[0mPOST /api/assets [32m201[0m 286.617 ms - 498[0m
[0mPOST /api/assets [32m201[0m 290.244 ms - 498[0m
[0mPOST /api/assets [32m201[0m 361.961 ms - 498[0m
[0mPOST /api/assets [32m201[0m 374.239 ms - 498[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | ../tests/contract/assets-get.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-0d10a3c353efc113.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-0d10a3c353efc113.db

[0mPOST /api/assets [32m201[0m 384.443 ms - 498[0m
[0mPOST /api/assets [32m201[0m 418.085 ms - 497[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

[0mPOST /api/auth/register [32m201[0m 343.988 ms - -[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

[0mPOST /api/auth/login [32m200[0m 335.348 ms - -[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

[0mPOST /api/zakat/payments [32m201[0m 8.910 ms - 562[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | ../tests/contract/assets-get.test.ts > Contract Test: GET /api/assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 364.189 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 298.215 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 1.839 ms - 162[0m
[0mPOST /api/auth/register [32m201[0m 311.736 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 304.540 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 1.652 ms - 166[0m
stdout | ../tests/contract/assets-get.test.ts > Contract Test: GET /api/assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 316.561 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 344.027 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 296.100 ms - -[0m
[0mPOST /api/zakat/payments [33m401[0m 0.438 ms - 94[0m
[0mPOST /api/auth/login [32m200[0m 300.272 ms - -[0m
[0mGET /api/assets [33m401[0m 0.707 ms - 94[0m
[0mGET /api/assets [33m401[0m 0.788 ms - 91[0m
[0mGET /api/assets [33m401[0m 1.506 ms - 91[0m
 â¯ ../tests/contract/assets-get.test.ts (7 tests | 4 failed) 2521ms
   âœ“ Contract Test: GET /api/assets > GET /api/assets > should require authentication 7ms
   Ã— Contract Test: GET /api/assets > GET /api/assets > should return user assets with standardized response format 1ms
     â†’ App or auth token not available
   Ã— Contract Test: GET /api/assets > GET /api/assets > should return encrypted asset data with proper structure 0ms
     â†’ App or auth token not available
   Ã— Contract Test: GET /api/assets > GET /api/assets > should handle empty asset list correctly 4ms
     â†’ expected true to be false // Object.is equality
   âœ“ Contract Test: GET /api/assets > GET /api/assets > should reject invalid JWT tokens 4ms
   âœ“ Contract Test: GET /api/assets > GET /api/assets > should reject expired JWT tokens 6ms
   Ã— Contract Test: GET /api/assets > GET /api/assets > should respect rate limiting 1ms
     â†’ expected true to be false // Object.is equality
[0mPOST /api/auth/register [32m201[0m 319.863 ms - -[0m
stdout | ../tests/contract/auth-refresh.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2b6b3604f730be42.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2b6b3604f730be42.db

[0mPOST /api/auth/login [32m200[0m 320.124 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 9.331 ms - 585[0m
[0mPOST /api/zakat/payments [32m201[0m 7.209 ms - 585[0m
[0mPOST /api/zakat/payments [32m201[0m 7.686 ms - 585[0m
[0mGET /api/zakat/payments [32m200[0m 4.301 ms - -[0m
stdout | ../tests/contract/auth-refresh.test.ts > Contract Test: POST /api/auth/refresh
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 326.983 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 303.427 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 6.928 ms - 585[0m
[0mPOST /api/zakat/payments [32m201[0m 6.922 ms - 585[0m
[0mPOST /api/zakat/payments [32m201[0m 8.033 ms - 585[0m
[0mGET /api/zakat/payments?year=2024 [32m200[0m 2.766 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 314.272 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 313.697 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 15.697 ms - 585[0m
[0mPOST /api/zakat/payments [32m201[0m 9.695 ms - 585[0m
[0mPOST /api/zakat/payments [32m201[0m 6.741 ms - 585[0m
[0mGET /api/zakat/payments?page=1&limit=2 [32m200[0m 4.864 ms - -[0m
stdout | ../tests/contract/auth-refresh.test.ts > Contract Test: POST /api/auth/refresh
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/assets [31m500[0m 5152.681 ms - 567[0m
[0mPOST /api/assets [31m500[0m 5147.836 ms - 567[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should provide asset breakdown by category
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/register [32m201[0m 325.448 ms - -[0m
[0mPOST /api/assets [31m500[0m 5188.053 ms - 567[0m
[0mPOST /api/auth/register [32m201[0m 345.694 ms - -[0m
[0mPOST /api/assets [31m500[0m 5400.156 ms - 567[0m
[0mPOST /api/assets [32m201[0m 5428.030 ms - 498[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should provide asset breakdown by category
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 310.739 ms - -[0m
[0mGET /api/nisab-year-records/cmldqmb5x00050grsev2oa5da [32m200[0m 539.224 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 10.126 ms - 585[0m
[0mPOST /api/zakat/payments [32m201[0m 16.616 ms - 585[0m
[0mPOST /api/zakat/payments [32m201[0m 11.649 ms - 585[0m
[0mGET /api/zakat/payments [33m401[0m 0.303 ms - 94[0m
[0mPOST /api/auth/login [32m200[0m 352.858 ms - -[0m
 â¯ ../tests/contract/auth-refresh.test.ts (13 tests | 13 failed) 2489ms
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should refresh tokens with valid refresh token and return standardized response 2ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should require refresh token in request body 1ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle invalid refresh token format 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle expired refresh token 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle revoked refresh token 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle non-existent refresh token 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle deactivated user account 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should revoke old refresh token after successful refresh 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should include user info in refresh response 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should validate token rotation security 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle concurrent refresh attempts 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle refresh rate limiting 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should create audit log entry for token refresh 0ms
     â†’ resetAuthState is not a function
[0mPOST /api/auth/register [32m201[0m 319.606 ms - -[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmb3c00000grsjdu06xsf 

stdout | src/__tests__/integration/admin-system.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-3d4c3c99fab26568.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-3d4c3c99fab26568.db

[0mPOST /api/auth/login [32m200[0m 319.506 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 8.824 ms - 592[0m
[0mPUT /api/zakat/payments/cmldqmg3g001n0grtal99r0ho [32m200[0m 11.437 ms - 644[0m
[0mPOST /api/auth/register [32m201[0m 329.165 ms - -[0m
stdout | src/__tests__/integration/admin-system.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 326.525 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 7.381 ms - 592[0m
[0mPUT /api/zakat/payments/non-existent-id [33m404[0m 1.793 ms - 161[0m
[0mPOST /api/auth/register [32m201[0m 310.607 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 296.897 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 7.982 ms - 592[0m
[0mPUT /api/zakat/payments/cmldqmh41001x0grtbl1h5p1a [33m401[0m 0.446 ms - 94[0m
stdout | src/__tests__/integration/admin-system.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 321.297 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 297.607 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 10.127 ms - 561[0m
[0mDELETE /api/zakat/payments/cmldqmhlp00220grtptppk3y9 [32m200[0m 10.757 ms - 143[0m
[0mGET /api/zakat/payments/cmldqmhlp00220grtptppk3y9 [33m404[0m 2.184 ms - 183[0m
[0mPOST /api/auth/register [32m201[0m 360.108 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 312.677 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 299.760 ms - -[0m
[0mGET /api/admin/system/status [32m200[0m 30.564 ms - 304[0m
[0mGET /api/admin/system/status/schema [32m200[0m 3.200 ms - 214[0m
[0mPOST /api/auth/login [32m200[0m 305.713 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 8.774 ms - 561[0m
[0mDELETE /api/zakat/payments/non-existent-id [33m404[0m 1.718 ms - 161[0m
[0mPOST /api/auth/register [32m201[0m 308.843 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 316.526 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 307.644 ms - -[0m
[0mGET /api/admin/system/status [33m403[0m 2.784 ms - 95[0m
 â¯ src/__tests__/integration/admin-system.test.ts (3 tests | 1 failed) 1382ms
   âœ“ Admin System API > GET /api/admin/system/status returns system status 36ms
   Ã— Admin System API > GET /api/admin/system/status/schema returns detailed schema info 13ms
     â†’ expected false to be true // Object.is equality
   âœ“ Admin System API > GET /api/admin/system/status requires admin privileges  628ms
stdout | tests/integration/unlockEdit.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-315b412fc248f639.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-315b412fc248f639.db

[0mPOST /api/auth/login [32m200[0m 319.630 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 8.204 ms - 561[0m
[0mDELETE /api/zakat/payments/cmldqmimb002c0grtsq4z3ttt [33m401[0m 0.268 ms - 94[0m
[0mPOST /api/auth/register [32m201[0m 326.838 ms - -[0m
stdout | tests/integration/unlockEdit.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 318.159 ms - -[0m
[0mPOST /api/assets [31m500[0m 10142.343 ms - 567[0m
[0mPOST /api/zakat/payments [32m201[0m 10.778 ms - 596[0m
[0mPOST /api/assets [31m500[0m 10138.897 ms - 567[0m
[0mPOST /api/zakat/payments [32m201[0m 6.895 ms - 562[0m
[0mPOST /api/auth/register [32m201[0m 314.141 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 305.673 ms - -[0m
[0mPOST /api/zakat/payments [32m201[0m 6.580 ms - 596[0m
[0mPOST /api/zakat/payments [32m201[0m 8.186 ms - 562[0m
[0mGET /api/zakat/receipts/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXltZW50SWQiOiJjbWxkcW1qbjMwMDJxMGdydHlkeTV0Nm0yIiwidXNlcklkIjoiY21sZHFtamRvMDAyazBncnR1c2ppcHJpaCIsImlhdCI6MTc3MDU1NDgyMSwiZXhwIjoxODAyMTEyNDIxfQ.TZf4lXZ0ifIiHfl9QMEvdGu5X3yObRjq7HZCVfhj6Ig [32m200[0m 2.351 ms - 249[0m
 â¯ ../tests/contract/payment-records.contract.test.ts (17 tests | 2 failed) 11451ms
   âœ“ Payment Records Contract Tests > POST /api/zakat/payments > should create new payment record with valid data  825ms
   âœ“ Payment Records Contract Tests > POST /api/zakat/payments > should create payment record with minimal data  708ms
   âœ“ Payment Records Contract Tests > POST /api/zakat/payments > should return 400 for invalid amount  678ms
   âœ“ Payment Records Contract Tests > POST /api/zakat/payments > should return 400 for missing required fields  631ms
   âœ“ Payment Records Contract Tests > POST /api/zakat/payments > should return 401 for unauthorized request  622ms
   âœ“ Payment Records Contract Tests > GET /api/zakat/payments > should return paginated list of payments  684ms
   âœ“ Payment Records Contract Tests > GET /api/zakat/payments > should filter payments by year  671ms
   âœ“ Payment Records Contract Tests > GET /api/zakat/payments > should support pagination  680ms
   âœ“ Payment Records Contract Tests > GET /api/zakat/payments > should return 401 for unauthorized request  694ms
   âœ“ Payment Records Contract Tests > PUT /api/zakat/payments/:id > should update payment record  671ms
   âœ“ Payment Records Contract Tests > PUT /api/zakat/payments/:id > should return 404 for non-existent payment  678ms
   âœ“ Payment Records Contract Tests > PUT /api/zakat/payments/:id > should return 401 for unauthorized request  626ms
   Ã— Payment Records Contract Tests > DELETE /api/zakat/payments/:id > should soft delete payment record 660ms
     â†’ expected undefined to be false // Object.is equality
   âœ“ Payment Records Contract Tests > DELETE /api/zakat/payments/:id > should return 404 for non-existent payment  640ms
   âœ“ Payment Records Contract Tests > DELETE /api/zakat/payments/:id > should return 401 for unauthorized request  655ms
   Ã— Payment Records Contract Tests > Receipt URL Generation > should generate valid receipt URL 678ms
     â†’ expected '/api/zakat/receipts/eyJhbGciOiJIUzI1Nâ€¦' to match /^\/api\/receipts\//api\
   âœ“ Payment Records Contract Tests > Receipt URL Generation > should allow access to receipt via generated URL  648ms
stdout | tests/integration/invalidOperations.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1bbd4ca05681ed4c.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1bbd4ca05681ed4c.db

stdout | tests/integration/unlockEdit.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/invalidOperations.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 364.861 ms - -[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmkcg00030gx53qptmlx9 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmkcg00030gx53qptmlx9 for user cmldqmkb000000gx5ug2o6aqn 

[0mPOST /api/nisab-year-records [32m201[0m 26.935 ms - 805[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
CREATE RESPONSE STATUS: [33m201[39m
CREATE RESPONSE BODY: {
  "success": true,
  "data": {
    "id": "cmldqmkcg00030gx53qptmlx9",
    "userId": "cmldqmkb000000gx5ug2o6aqn",
    "hawlStartDate": "2025-02-08T12:47:02.260Z",
    "hawlStartDateHijri": "1444-06-08",
    "hawlCompletionDate": "2026-01-29T12:47:02.260Z",
    "hawlCompletionDateHijri": "1445-06-08",
    "nisabThresholdAtStart": 0,
    "nisabBasis": "GOLD",
    "totalWealth": 10000,
    "totalLiabilities": 0,
    "zakatableWealth": 10000,
    "zakatAmount": 250,
    "methodologyUsed": "standard",
    "assetBreakdown": "hj8sk6/jJPBWXJCQ:omk=:4ZN/FZDQOY7+wfbFO/IlFA==",
    "calculationDetails": "{}",
    "status": "DRAFT",
    "finalizedAt": null,
    "userNotes": null,
    "calculationDate": "2026-02-08T12:47:02.271Z",
    "gregorianYear": 2026,
    "gregorianMonth": 2,
    "gregorianDay": 8,
    "hijriYear": 1444,
    "hijriMonth": 6,
    "hijriDay": 8,
    "isPrimary": false,
    "createdAt": "2026-02-08T12:47:02.273Z",
    "updatedAt": "2026-02-08T12:47:02.273Z"
  }
}

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmkcg00030gx53qptmlx9 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmkcg00030gx53qptmlx9 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmkcg00030gx53qptmlx9/finalize [32m200[0m 30.404 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmkcg00030gx53qptmlx9 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmkcg00030gx53qptmlx9 with reason: Need to correct asse... 

[0mPOST /api/nisab-year-records/cmldqmkcg00030gx53qptmlx9/unlock [32m200[0m 20.837 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmkf9000a0gx5kl7jjaon 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmkf9000a0gx5kl7jjaon for user cmldqmkb000000gx5ug2o6aqn 

[0mPOST /api/nisab-year-records [32m201[0m 17.023 ms - 803[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmkf9000a0gx5kl7jjaon 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmkf9000a0gx5kl7jjaon with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmkf9000a0gx5kl7jjaon/finalize [32m200[0m 14.560 ms - 821[0m
[0mPOST /api/nisab-year-records/cmldqmkf9000a0gx5kl7jjaon/unlock [33m400[0m 0.967 ms - 100[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmkh2000f0gx5583fv8xp 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmkh2000f0gx5583fv8xp for user cmldqmkb000000gx5ug2o6aqn 

[0mPOST /api/nisab-year-records [32m201[0m 44.193 ms - 805[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmkh2000f0gx5583fv8xp 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmkh2000f0gx5583fv8xp with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmkh2000f0gx5583fv8xp/finalize [32m200[0m 23.165 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmkh2000f0gx5583fv8xp 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmkh2000f0gx5583fv8xp with reason: Correcting asset val... 

[0mPOST /api/nisab-year-records/cmldqmkh2000f0gx5583fv8xp/unlock [32m200[0m 15.814 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldqmkh2000f0gx5583fv8xp 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldqmkh2000f0gx5583fv8xp 

[0mPUT /api/nisab-year-records/cmldqmkh2000f0gx5583fv8xp [32m200[0m 15.036 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmkkk000o0gx5gs7zcyt9 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmkkk000o0gx5gs7zcyt9 for user cmldqmkb000000gx5ug2o6aqn 

[0mPOST /api/nisab-year-records [32m201[0m 17.470 ms - 805[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmkkk000o0gx5gs7zcyt9 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmkkk000o0gx5gs7zcyt9 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmkkk000o0gx5gs7zcyt9/finalize [32m200[0m 14.217 ms - 823[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmkkk000o0gx5gs7zcyt9 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmkkk000o0gx5gs7zcyt9 with reason: Discovered missing l... 

[0mPOST /api/nisab-year-records/cmldqmkkk000o0gx5gs7zcyt9/unlock [32m200[0m 15.843 ms - 822[0m
[0mGET /api/nisab-year-records/cmldqmkkk000o0gx5gs7zcyt9/audit [32m200[0m 8.132 ms - -[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmkmr000v0gx5md5qcg0a 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmkmr000v0gx5md5qcg0a for user cmldqmkb000000gx5ug2o6aqn 

[0mPOST /api/nisab-year-records [32m201[0m 17.032 ms - 805[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmkmr000v0gx5md5qcg0a 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmkmr000v0gx5md5qcg0a with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmkmr000v0gx5md5qcg0a/finalize [32m200[0m 14.659 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmkmr000v0gx5md5qcg0a 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmkmr000v0gx5md5qcg0a with reason: Correcting calculati... 

[0mPOST /api/nisab-year-records/cmldqmkmr000v0gx5md5qcg0a/unlock [32m200[0m 17.005 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldqmkmr000v0gx5md5qcg0a 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldqmkmr000v0gx5md5qcg0a 

[0mPUT /api/nisab-year-records/cmldqmkmr000v0gx5md5qcg0a [32m200[0m 15.468 ms - 820[0m
[0mGET /api/nisab-year-records/cmldqmkmr000v0gx5md5qcg0a/audit [32m200[0m 4.804 ms - -[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmkpd00140gx59vl917x5 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmkpd00140gx59vl917x5 for user cmldqmkb000000gx5ug2o6aqn 

[0mPOST /api/nisab-year-records [32m201[0m 16.912 ms - 803[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmkpd00140gx59vl917x5 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmkpd00140gx59vl917x5 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmkpd00140gx59vl917x5/finalize [32m200[0m 15.989 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmkpd00140gx59vl917x5 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmkpd00140gx59vl917x5 with reason: Correcting valuation... 

[0mPOST /api/nisab-year-records/cmldqmkpd00140gx59vl917x5/unlock [32m200[0m 15.127 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldqmkpd00140gx59vl917x5 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldqmkpd00140gx59vl917x5 

[0mPUT /api/nisab-year-records/cmldqmkpd00140gx59vl917x5 [32m200[0m 14.997 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmkpd00140gx59vl917x5 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmkpd00140gx59vl917x5 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmkpd00140gx59vl917x5/finalize [32m200[0m 15.631 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmks7001f0gx5jj2nvz27 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmks7001f0gx5jj2nvz27 for user cmldqmkb000000gx5ug2o6aqn 

[0mPOST /api/nisab-year-records [32m201[0m 15.909 ms - 803[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmks7001f0gx5jj2nvz27 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmks7001f0gx5jj2nvz27 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmks7001f0gx5jj2nvz27/finalize [32m200[0m 15.853 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmks7001f0gx5jj2nvz27 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmks7001f0gx5jj2nvz27 with reason: Fixing data entry mi... 

[0mPOST /api/nisab-year-records/cmldqmks7001f0gx5jj2nvz27/unlock [32m200[0m 16.093 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldqmks7001f0gx5jj2nvz27 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldqmks7001f0gx5jj2nvz27 

[0mPUT /api/nisab-year-records/cmldqmks7001f0gx5jj2nvz27 [32m200[0m 14.182 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmks7001f0gx5jj2nvz27 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmks7001f0gx5jj2nvz27 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmks7001f0gx5jj2nvz27/finalize [32m200[0m 14.955 ms - 821[0m
[0mGET /api/nisab-year-records/cmldqmks7001f0gx5jj2nvz27/audit [32m200[0m 4.119 ms - -[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should NOT allow unlocking DRAFT record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should NOT allow unlocking DRAFT record
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmkv7001q0gx5qx22xyfk 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should NOT allow unlocking DRAFT record
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmkv7001q0gx5qx22xyfk for user cmldqmkb000000gx5ug2o6aqn 

[0mPOST /api/nisab-year-records [32m201[0m 17.964 ms - 804[0m
[0mPOST /api/nisab-year-records/cmldqmkv7001q0gx5qx22xyfk/unlock [33m409[0m 4.181 ms - 90[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmkwh001t0gx5wxxsiycf 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmkwh001t0gx5wxxsiycf for user cmldqmkb000000gx5ug2o6aqn 

[0mPOST /api/nisab-year-records [32m201[0m 17.673 ms - 805[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmkwh001t0gx5wxxsiycf 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmkwh001t0gx5wxxsiycf with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmkwh001t0gx5wxxsiycf/finalize [32m200[0m 15.661 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmkwh001t0gx5wxxsiycf 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmkwh001t0gx5wxxsiycf with reason: Correcting error due... 

[0mPOST /api/nisab-year-records/cmldqmkwh001t0gx5wxxsiycf/unlock [32m200[0m 16.599 ms - 820[0m
[0mGET /api/nisab-year-records/cmldqmkwh001t0gx5wxxsiycf/audit [32m200[0m 4.926 ms - -[0m
 â¯ tests/integration/unlockEdit.test.ts (9 tests | 1 failed) 1205ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason 107ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters 55ms
   Ã— Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record 135ms
     â†’ expected +0 to be 12000 // Object.is equality
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason 81ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary 92ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit 103ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail 107ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should NOT allow unlocking DRAFT record 45ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail 76ms
stdout | tests/integration/statusTransitions.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f4f8c987e82952a4.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f4f8c987e82952a4.db

stdout | tests/integration/invalidOperations.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/statusTransitions.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 369.086 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 323.824 ms - -[0m
[0mGET /api/nisab-year-records [33m401[0m 0.842 ms - 94[0m
[0mGET /api/nisab-year-records [33m401[0m 1.070 ms - 91[0m
[0mGET /api/nisab-year-records [33m401[0m 1.935 ms - 91[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from accessing another user's records
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from accessing another user's records
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmlze00060gxwoshebzi4 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from accessing another user's records
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmlze00060gxwoshebzi4 for user cmldqmloe00000gxww8ti7ir4 

[0mPOST /api/nisab-year-records [32m201[0m 22.930 ms - 805[0m
[0mGET /api/nisab-year-records/cmldqmlze00060gxwoshebzi4 [33m404[0m 6.156 ms - 66[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from modifying another user's records
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from modifying another user's records
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmm0h00090gxwwxk3dmyk 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from modifying another user's records
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmm0h00090gxwwxk3dmyk for user cmldqmloe00000gxww8ti7ir4 

[0mPOST /api/nisab-year-records [32m201[0m 19.931 ms - 803[0m
[0mPUT /api/nisab-year-records/cmldqmm0h00090gxwwxk3dmyk [33m404[0m 4.028 ms - 66[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from deleting another user's records
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from deleting another user's records
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmm1c000c0gxw8l2dl6bo 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from deleting another user's records
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmm1c000c0gxw8l2dl6bo for user cmldqmloe00000gxww8ti7ir4 

[0mPOST /api/nisab-year-records [32m201[0m 15.729 ms - 803[0m
[0mDELETE /api/nisab-year-records/cmldqmm1c000c0gxw8l2dl6bo [33m404[0m 4.710 ms - 66[0m
[0mPOST /api/nisab-year-records [33m400[0m 0.907 ms - 82[0m
[0mPOST /api/nisab-year-records [33m400[0m 0.824 ms - 90[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject invalid Hawl completion date (not 354 days)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject invalid Hawl completion date (not 354 days)
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmm2a000f0gxw3leyd209 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject invalid Hawl completion date (not 354 days)
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmm2a000f0gxw3leyd209 for user cmldqmloe00000gxww8ti7ir4 

[0mPOST /api/nisab-year-records [32m201[0m 16.227 ms - 806[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject negative wealth values
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject negative wealth values
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmm2v000i0gxwge2c8t6n 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject negative wealth values
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmm2v000i0gxwge2c8t6n for user cmldqmloe00000gxww8ti7ir4 

[0mPOST /api/nisab-year-records [32m201[0m 16.834 ms - 805[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject Zakat amount not equal to 2.5% of zakatable wealth
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject Zakat amount not equal to 2.5% of zakatable wealth
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmm3f000l0gxwauxsiok9 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject Zakat amount not equal to 2.5% of zakatable wealth
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmm3f000l0gxwauxsiok9 for user cmldqmloe00000gxww8ti7ir4 

[0mPOST /api/nisab-year-records [32m201[0m 16.855 ms - 805[0m
[0mGET /api/nisab-year-records/nonexistent_id_12345 [33m404[0m 2.307 ms - 66[0m
[0mPOST /api/nisab-year-records/fake_id/finalize [33m404[0m 2.741 ms - 66[0m
[0mPOST /api/nisab-year-records/fake_id/unlock [33m400[0m 1.160 ms - 81[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject finalization before Hawl completion without override
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject finalization before Hawl completion without override
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmm4d000o0gxwnxsu6gcz 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject finalization before Hawl completion without override
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmm4d000o0gxwnxsu6gcz for user cmldqmloe00000gxww8ti7ir4 

[0mPOST /api/nisab-year-records [32m201[0m 18.372 ms - 805[0m
[0mPOST /api/nisab-year-records/cmldqmm4d000o0gxwnxsu6gcz/finalize [33m409[0m 4.224 ms - 115[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmm54000r0gxwdfalncyi 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmm54000r0gxwdfalncyi for user cmldqmloe00000gxww8ti7ir4 

[0mPOST /api/nisab-year-records [32m201[0m 17.282 ms - 805[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmm54000r0gxwdfalncyi 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmm54000r0gxwdfalncyi with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmm54000r0gxwdfalncyi/finalize [32m200[0m 19.292 ms - 821[0m
[0mPOST /api/nisab-year-records/cmldqmm54000r0gxwdfalncyi/unlock [33m400[0m 0.753 ms - 81[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmm6e000w0gxwmp1nf06w 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmm6e000w0gxwmp1nf06w for user cmldqmloe00000gxww8ti7ir4 

[0mPOST /api/nisab-year-records [32m201[0m 17.759 ms - 803[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmm6e000w0gxwmp1nf06w 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmm6e000w0gxwmp1nf06w with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmm6e000w0gxwmp1nf06w/finalize [32m200[0m 17.172 ms - 821[0m
[0mPOST /api/nisab-year-records/cmldqmm6e000w0gxwmp1nf06w/unlock [33m400[0m 0.803 ms - 81[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Edge Cases > should handle very large wealth values
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Edge Cases > should handle very large wealth values
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmm7l00110gxwj9ch83my 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Edge Cases > should handle very large wealth values
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmm7l00110gxwj9ch83my for user cmldqmloe00000gxww8ti7ir4 

[0mPOST /api/nisab-year-records [32m201[0m 15.735 ms - 831[0m
[0mPOST /api/nisab-year-records [33m400[0m 3.068 ms - 145[0m
[0mPOST /api/nisab-year-records [31m500[0m 2.334 ms - 49[0m
 â¯ tests/integration/invalidOperations.test.ts (20 tests | 11 failed) 1087ms
   âœ“ Integration: Invalid Operations and Error Handling > Authentication Errors > should reject requests without auth token 6ms
   âœ“ Integration: Invalid Operations and Error Handling > Authentication Errors > should reject requests with invalid token 4ms
   âœ“ Integration: Invalid Operations and Error Handling > Authentication Errors > should reject requests with expired token 5ms
   Ã— Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from accessing another user's records 41ms
     â†’ expected 404 to be 403 // Object.is equality
   Ã— Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from modifying another user's records 31ms
     â†’ expected 404 to be 403 // Object.is equality
   Ã— Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from deleting another user's records 27ms
     â†’ expected 404 to be 403 // Object.is equality
   âœ“ Integration: Invalid Operations and Error Handling > Validation Errors > should reject creation with missing required fields 4ms
   âœ“ Integration: Invalid Operations and Error Handling > Validation Errors > should reject invalid nisabBasis value 4ms
   Ã— Integration: Invalid Operations and Error Handling > Validation Errors > should reject invalid Hawl completion date (not 354 days) 19ms
     â†’ expected 201 to be 400 // Object.is equality
   Ã— Integration: Invalid Operations and Error Handling > Validation Errors > should reject negative wealth values 20ms
     â†’ expected 201 to be 400 // Object.is equality
   Ã— Integration: Invalid Operations and Error Handling > Validation Errors > should reject Zakat amount not equal to 2.5% of zakatable wealth 20ms
     â†’ expected 201 to be 400 // Object.is equality
   âœ“ Integration: Invalid Operations and Error Handling > Not Found Errors > should return 404 for non-existent record 5ms
   Ã— Integration: Invalid Operations and Error Handling > Not Found Errors > should return 400 when finalizing non-existent record 6ms
     â†’ expected 404 to be 400 // Object.is equality
   âœ“ Integration: Invalid Operations and Error Handling > Not Found Errors > should return 400 when unlocking non-existent record 4ms
   Ã— Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject finalization before Hawl completion without override 28ms
     â†’ expected 409 to be 400 // Object.is equality
   Ã— Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason 46ms
     â†’ expected 'unlockReason is required' to contain 'reason'
   Ã— Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short 44ms
     â†’ expected 'unlockReason is required' to contain '10 characters'
   âœ“ Integration: Invalid Operations and Error Handling > Edge Cases > should handle very large wealth values 18ms
   Ã— Integration: Invalid Operations and Error Handling > Edge Cases > should handle concurrent edits to same record 6ms
     â†’ Cannot read properties of undefined (reading 'id')
   âœ“ Integration: Invalid Operations and Error Handling > Edge Cases > should handle malformed JSON in request body 5ms
stdout | src/__tests__/integration/encryption-admin.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-269bcef0912e9db1.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-269bcef0912e9db1.db

stdout | tests/integration/statusTransitions.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/integration/encryption-admin.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 361.825 ms - -[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmmze00030gyo1com0ui3 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmmze00030gyo1com0ui3 for user cmldqmmxz00000gyoa4a4iq0p 

[0mPOST /api/nisab-year-records [32m201[0m 29.522 ms - 805[0m
[0mPOST /api/assets [31m500[0m 15158.349 ms - 567[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmmze00030gyo1com0ui3 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmmze00030gyo1com0ui3 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmmze00030gyo1com0ui3/finalize [32m200[0m 31.294 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmn1e00080gyoofdr7c0o 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmn1e00080gyoofdr7c0o for user cmldqmmxz00000gyoa4a4iq0p 

[0mPOST /api/nisab-year-records [32m201[0m 19.449 ms - 803[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmn1e00080gyoofdr7c0o 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmn1e00080gyoofdr7c0o with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmn1e00080gyoofdr7c0o/finalize [32m200[0m 18.110 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmn1e00080gyoofdr7c0o 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmn1e00080gyoofdr7c0o with reason: Valid reason for unl... 

[0mPOST /api/nisab-year-records/cmldqmn1e00080gyoofdr7c0o/unlock [32m200[0m 14.598 ms - 820[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmn31000f0gyow8i2nn03 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmn31000f0gyow8i2nn03 for user cmldqmmxz00000gyoa4a4iq0p 

[0mPOST /api/nisab-year-records [32m201[0m 16.054 ms - 803[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmn31000f0gyow8i2nn03 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmn31000f0gyow8i2nn03 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmn31000f0gyow8i2nn03/finalize [32m200[0m 16.476 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmn31000f0gyow8i2nn03 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmn31000f0gyow8i2nn03 with reason: Unlocking for necess... 

[0mPOST /api/nisab-year-records/cmldqmn31000f0gyow8i2nn03/unlock [32m200[0m 14.267 ms - 820[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmn31000f0gyow8i2nn03 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmn31000f0gyow8i2nn03 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmn31000f0gyow8i2nn03/finalize [32m200[0m 19.332 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow DRAFT â†’ UNLOCKED transition
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow DRAFT â†’ UNLOCKED transition
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmn57000o0gyony6lthux 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow DRAFT â†’ UNLOCKED transition
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmn57000o0gyony6lthux for user cmldqmmxz00000gyoa4a4iq0p 

[0mPOST /api/nisab-year-records [32m201[0m 16.898 ms - 803[0m
[0mPOST /api/nisab-year-records/cmldqmn57000o0gyony6lthux/unlock [33m409[0m 5.965 ms - 90[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmn60000r0gyork2nm312 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmn60000r0gyork2nm312 for user cmldqmmxz00000gyoa4a4iq0p 

[0mPOST /api/nisab-year-records [32m201[0m 16.869 ms - 803[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmn60000r0gyork2nm312 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmn60000r0gyork2nm312 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmn60000r0gyork2nm312/finalize [32m200[0m 14.647 ms - 821[0m
[0mPUT /api/nisab-year-records/cmldqmn60000r0gyork2nm312 [33m400[0m 0.996 ms - 113[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmn77000w0gyoma2kz28e 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmn77000w0gyoma2kz28e for user cmldqmmxz00000gyoa4a4iq0p 

[0mPOST /api/nisab-year-records [32m201[0m 18.744 ms - 805[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmn77000w0gyoma2kz28e 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmn77000w0gyoma2kz28e with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmn77000w0gyoma2kz28e/finalize [32m200[0m 15.685 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmn77000w0gyoma2kz28e 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmn77000w0gyoma2kz28e with reason: Unlocking for correc... 

[0mPOST /api/nisab-year-records/cmldqmn77000w0gyoma2kz28e/unlock [32m200[0m 13.462 ms - 820[0m
[0mPUT /api/nisab-year-records/cmldqmn77000w0gyoma2kz28e [33m400[0m 0.726 ms - 113[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow direct status field updates
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow direct status field updates
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmn8r00130gyohkjbtjzm 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow direct status field updates
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmn8r00130gyohkjbtjzm for user cmldqmmxz00000gyoa4a4iq0p 

[0mPOST /api/nisab-year-records [32m201[0m 15.639 ms - 805[0m
[0mPUT /api/nisab-year-records/cmldqmn8r00130gyohkjbtjzm [33m400[0m 0.809 ms - 113[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmn9d00160gyofopo3uso 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmn9d00160gyofopo3uso for user cmldqmmxz00000gyoa4a4iq0p 

[0mPOST /api/nisab-year-records [32m201[0m 16.094 ms - 805[0m
[0mGET /api/nisab-year-records/cmldqmn9d00160gyofopo3uso [32m200[0m 4.938 ms - 1013[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmn9d00160gyofopo3uso 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmn9d00160gyofopo3uso with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmn9d00160gyofopo3uso/finalize [32m200[0m 14.683 ms - 821[0m
[0mGET /api/nisab-year-records/cmldqmn9d00160gyofopo3uso [32m200[0m 2.121 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqmn9d00160gyofopo3uso 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqmn9d00160gyofopo3uso with reason: Correction needed af... 

[0mPOST /api/nisab-year-records/cmldqmn9d00160gyofopo3uso/unlock [32m200[0m 14.808 ms - 820[0m
[0mGET /api/nisab-year-records/cmldqmn9d00160gyofopo3uso [32m200[0m 2.686 ms - 820[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmnbb001d0gyo4i9fhzis 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmnbb001d0gyo4i9fhzis for user cmldqmmxz00000gyoa4a4iq0p 

[0mPOST /api/nisab-year-records [32m201[0m 21.108 ms - 805[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmnbb001d0gyo4i9fhzis 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmnbb001d0gyo4i9fhzis with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmnbb001d0gyo4i9fhzis/finalize [32m200[0m 18.671 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmnbb001d0gyo4i9fhzis 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmnbb001d0gyo4i9fhzis with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmnbb001d0gyo4i9fhzis/finalize [32m200[0m 37.287 ms - 821[0m
 â¯ tests/integration/statusTransitions.test.ts (9 tests | 1 failed) 894ms
   âœ“ Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition 74ms
   âœ“ Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition 62ms
   âœ“ Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization) 77ms
   âœ“ Integration: Status Transition Validation > Invalid Transitions > should NOT allow DRAFT â†’ UNLOCKED transition 29ms
   âœ“ Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition 43ms
   âœ“ Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition 57ms
   âœ“ Integration: Status Transition Validation > Invalid Transitions > should NOT allow direct status field updates 21ms
   âœ“ Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations 68ms
   Ã— Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes 67ms
     â†’ expected 0 to be greater than or equal to 1
stdout | tests/integration/finalization.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c4fdecdc1f38791e.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c4fdecdc1f38791e.db

stdout | src/__tests__/integration/encryption-admin.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/finalization.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 348.777 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 304.596 ms - -[0m
[0mPOST /api/admin/encryption/scan [32m200[0m 7.909 ms - 28[0m
[0mGET /api/admin/encryption/issues [32m200[0m 3.571 ms - 28[0m
 â¯ src/__tests__/integration/encryption-admin.test.ts (2 tests | 2 failed) 743ms
   Ã— Admin Encryption Remediation API > scan creates remediation for prev-key encrypted payment 16ms
     â†’ expected 0 to be greater than or equal to 1
   Ã— Admin Encryption Remediation API > retry with correct previous key resolves remediation and re-encrypts 9ms
     â†’ expected undefined to be truthy
stdout | tests/integration/hawlDetection.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a935ace4d98d1704.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a935ace4d98d1704.db

stdout | tests/integration/finalization.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetection.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 361.711 ms - -[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmpbo00030g08rkqp32n7 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmpbo00030g08rkqp32n7 for user cmldqmpac00000g0807y6zxrz 

[0mPOST /api/nisab-year-records [32m201[0m 23.665 ms - 805[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmpbo00030g08rkqp32n7 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmpbo00030g08rkqp32n7 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmpbo00030g08rkqp32n7/finalize [32m200[0m 29.937 ms - 821[0m
[0mPUT /api/nisab-year-records/cmldqmpbo00030g08rkqp32n7 [33m409[0m 5.693 ms - 94[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT finalize before Hawl completion date without override
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT finalize before Hawl completion date without override
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmpe300080g08nrpq017g 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT finalize before Hawl completion date without override
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmpe300080g08nrpq017g for user cmldqmpac00000g0807y6zxrz 

[0mPOST /api/nisab-year-records [32m201[0m 18.858 ms - 803[0m
[0mPOST /api/nisab-year-records/cmldqmpe300080g08nrpq017g/finalize [33m409[0m 2.751 ms - 115[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should allow early finalization with override flag
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should allow early finalization with override flag
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmpeu000b0g089fmnr0ne 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should allow early finalization with override flag
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmpeu000b0g089fmnr0ne for user cmldqmpac00000g0807y6zxrz 

[0mPOST /api/nisab-year-records [32m201[0m 15.472 ms - 805[0m
[0mPOST /api/nisab-year-records/cmldqmpeu000b0g089fmnr0ne/finalize [33m409[0m 3.532 ms - 115[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should record FINALIZED event in audit trail
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should record FINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmpfk000e0g082lqgbl9y 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should record FINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmpfk000e0g082lqgbl9y for user cmldqmpac00000g0807y6zxrz 

[0mPOST /api/nisab-year-records [32m201[0m 17.149 ms - 805[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should record FINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmpfk000e0g082lqgbl9y 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should record FINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmpfk000e0g082lqgbl9y with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmpfk000e0g082lqgbl9y/finalize [32m200[0m 16.981 ms - 821[0m
[0mGET /api/nisab-year-records/cmldqmpfk000e0g082lqgbl9y/audit-trail [33m404[0m 2.336 ms - 199[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should prevent deletion of FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should prevent deletion of FINALIZED record
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmpgt000j0g08j2neww4r 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should prevent deletion of FINALIZED record
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmpgt000j0g08j2neww4r for user cmldqmpac00000g0807y6zxrz 

[0mPOST /api/nisab-year-records [32m201[0m 17.748 ms - 803[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should prevent deletion of FINALIZED record
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmpgt000j0g08j2neww4r 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should prevent deletion of FINALIZED record
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmpgt000j0g08j2neww4r with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmpgt000j0g08j2neww4r/finalize [32m200[0m 15.553 ms - 821[0m
[0mDELETE /api/nisab-year-records/cmldqmpgt000j0g08j2neww4r [33m409[0m 2.640 ms - 137[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should lock all financial values on finalization
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should lock all financial values on finalization
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmpi1000o0g080ibzvv6n 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should lock all financial values on finalization
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmpi1000o0g080ibzvv6n for user cmldqmpac00000g0807y6zxrz 

[0mPOST /api/nisab-year-records [32m201[0m 15.763 ms - 805[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should lock all financial values on finalization
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmpi1000o0g080ibzvv6n 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should lock all financial values on finalization
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmpi1000o0g080ibzvv6n with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmpi1000o0g080ibzvv6n/finalize [32m200[0m 14.722 ms - 821[0m
[0mGET /api/nisab-year-records/cmldqmpi1000o0g080ibzvv6n [32m200[0m 3.790 ms - 821[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmpj8000t0g084c7h7v4t 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmpj8000t0g084c7h7v4t for user cmldqmpac00000g0807y6zxrz 

[0mPOST /api/nisab-year-records [32m201[0m 16.242 ms - 805[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmpj8000t0g084c7h7v4t 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmpj8000t0g084c7h7v4t with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmpj8000t0g084c7h7v4t/finalize [32m200[0m 14.527 ms - 821[0m
[0mPOST /api/nisab-year-records/cmldqmpj8000t0g084c7h7v4t/finalize [33m409[0m 2.647 ms - 96[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should include finalizedAt timestamp
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should include finalizedAt timestamp
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmpkb000y0g08mztkqtrn 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should include finalizedAt timestamp
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmpkb000y0g08mztkqtrn for user cmldqmpac00000g0807y6zxrz 

[0mPOST /api/nisab-year-records [32m201[0m 15.904 ms - 805[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should include finalizedAt timestamp
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqmpkb000y0g08mztkqtrn 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should include finalizedAt timestamp
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqmpkb000y0g08mztkqtrn with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqmpkb000y0g08mztkqtrn/finalize [32m200[0m 16.501 ms - 821[0m
 â¯ tests/integration/finalization.test.ts (8 tests | 7 failed) 748ms
   Ã— Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date 90ms
     â†’ expected 409 to be 403 // Object.is equality
   Ã— Integration: Finalization Workflow > should NOT finalize before Hawl completion date without override 28ms
     â†’ expected 409 to be 400 // Object.is equality
   Ã— Integration: Finalization Workflow > should allow early finalization with override flag 25ms
     â†’ expected 409 to be 200 // Object.is equality
   Ã— Integration: Finalization Workflow > should record FINALIZED event in audit trail 45ms
     â†’ expected 404 to be 200 // Object.is equality
   Ã— Integration: Finalization Workflow > should prevent deletion of FINALIZED record 44ms
     â†’ expected 409 to be 403 // Object.is equality
   Ã— Integration: Finalization Workflow > should lock all financial values on finalization 42ms
     â†’ expected +0 to be 11000 // Object.is equality
   Ã— Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record 40ms
     â†’ expected 409 to be 400 // Object.is equality
   âœ“ Integration: Finalization Workflow > should include finalizedAt timestamp 38ms
stdout | tests/integration/hawlInterruption.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-603c48bd24529696.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-603c48bd24529696.db

stdout | tests/integration/hawlInterruption.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetection.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 345.870 ms - -[0m
[0mPOST /api/assets [32m201[0m 13.321 ms - 506[0m
[0mGET /api/nisab-year-records/status [32m200[0m 4.991 ms - 16[0m
[0mPOST /api/assets [32m201[0m 11.274 ms - 504[0m
[0mGET /api/nisab-year-records/status [32m200[0m 3.138 ms - 16[0m
[0mPOST /api/assets [32m201[0m 12.324 ms - 498[0m
[0mGET /api/nisab-year-records/status [32m200[0m 2.567 ms - 16[0m
[0mPOST /api/assets [32m201[0m 10.663 ms - 502[0m
[0mGET /api/nisab-year-records/status [32m200[0m 3.837 ms - 16[0m
[0mPOST /api/assets [32m201[0m 11.606 ms - 496[0m
[0mGET /api/nisab-year-records/status [32m200[0m 2.777 ms - 16[0m
[0mGET /api/nisab-year-records/undefined [33m404[0m 5.351 ms - 66[0m
[0mPOST /api/assets [32m201[0m 8.963 ms - 498[0m
[0mGET /api/nisab-year-records/status [32m200[0m 3.418 ms - 16[0m
[0mPOST /api/assets [32m201[0m 11.115 ms - 495[0m
[0mGET /api/nisab-year-records/status [32m200[0m 2.313 ms - 16[0m
[0mGET /api/nisab-year-records/undefined [33m404[0m 2.186 ms - 66[0m
 â¯ tests/integration/hawlDetection.test.ts (6 tests | 6 failed) 584ms
   Ã— Integration: Nisab Achievement Detection > should detect Nisab achievement and create DRAFT record 58ms
     â†’ expected false to be true // Object.is equality
   Ã— Integration: Nisab Achievement Detection > should not create duplicate Hawl if active DRAFT exists 27ms
     â†’ expected false to be true // Object.is equality
   Ã— Integration: Nisab Achievement Detection > should use gold-based Nisab if gold threshold is lower 26ms
     â†’ expected false to be true // Object.is equality
   Ã— Integration: Nisab Achievement Detection > should lock Nisab threshold value at Hawl start 34ms
     â†’ expected undefined to be defined
   Ã— Integration: Nisab Achievement Detection > should calculate Hawl completion date as 354 days from start 25ms
     â†’ expected NaN to be 354 // Object.is equality
   Ã— Integration: Nisab Achievement Detection > should include Hijri date equivalents 32ms
     â†’ .toMatch() expects to receive a string, but got undefined
stdout | tests/contract/nisabYearRecords.post.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-e0d2921df9892e2a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-e0d2921df9892e2a.db

 â¯ tests/integration/liveTracking.test.ts (8 tests | 6 failed) 21157ms
   âœ“ Integration: Live Wealth Tracking > should update DRAFT record when asset is added 34ms
   Ã— Integration: Live Wealth Tracking > should update DRAFT record when asset value is modified 11ms
     â†’ Cannot read properties of undefined (reading 'id')
   Ã— Integration: Live Wealth Tracking > should update DRAFT record when asset is deleted 12ms
     â†’ Cannot read properties of undefined (reading 'id')
   Ã— Integration: Live Wealth Tracking > should recalculate Zakat amount when wealth changes 31ms
     â†’ expected NaN to be close to NaN, received difference is NaN, but expected 0.005
   âœ“ Integration: Live Wealth Tracking > should handle non-zakatable assets correctly 32ms
   Ã— Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation) 5001ms
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
   Ã— Integration: Live Wealth Tracking > should provide asset breakdown by category 549ms
     â†’ expected undefined to be defined
   Ã— Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation 5001ms
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
stdout | tests/integration/hawlInterruption.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/unit/EncryptionService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-714428750c700dfd.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-714428750c700dfd.db

stdout | tests/contract/nisabYearRecords.post.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 â¯ ../tests/unit/EncryptionService.test.ts (29 tests | 5 failed) 334ms
   âœ“ Implementation Task T023: EncryptionService > Core Encryption/Decryption > should encrypt and decrypt data successfully 5ms
   âœ“ Implementation Task T023: EncryptionService > Core Encryption/Decryption > should generate different encrypted values for the same plaintext 1ms
   Ã— Implementation Task T023: EncryptionService > Core Encryption/Decryption > should throw error for empty plaintext 14ms
     â†’ promise resolved "'FbqOu5anetkL1vs7::ZclXDF7pr9uvOEiC+KRâ€¦'" instead of rejecting
   Ã— Implementation Task T023: EncryptionService > Core Encryption/Decryption > should throw error for empty key 1ms
     â†’ You must provide a Promise to expect() when using .rejects, not 'object'.
   âœ“ Implementation Task T023: EncryptionService > Core Encryption/Decryption > should throw error for invalid encrypted data format 2ms
   âœ“ Implementation Task T023: EncryptionService > Object Encryption/Decryption > should encrypt and decrypt objects successfully 1ms
   âœ“ Implementation Task T023: EncryptionService > Object Encryption/Decryption > should handle complex nested objects 1ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should generate secure random keys 0ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should derive keys from passwords using PBKDF2 145ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should generate different keys for different salts 143ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should generate cryptographically secure salts 0ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should reject empty password for key derivation 0ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should reject empty salt for key derivation 0ms
   âœ“ Implementation Task T023: EncryptionService > Hashing and Verification > should create consistent SHA-256 hashes 1ms
   âœ“ Implementation Task T023: EncryptionService > Hashing and Verification > should create different hashes for different data 0ms
   âœ“ Implementation Task T023: EncryptionService > Hashing and Verification > should verify hashes correctly 0ms
   âœ“ Implementation Task T023: EncryptionService > Hashing and Verification > should handle empty data in hash verification 0ms
   âœ“ Implementation Task T023: EncryptionService > Hashing and Verification > should throw error for empty data hashing 0ms
   âœ“ Implementation Task T023: EncryptionService > Islamic Compliance Features > should encrypt asset data with integrity checks 1ms
   Ã— Implementation Task T023: EncryptionService > Islamic Compliance Features > should validate asset data integrity 4ms
     â†’ promise resolved "{ type: 'gold', value: 50000, â€¦(2) }" instead of rejecting
   âœ“ Implementation Task T023: EncryptionService > Islamic Compliance Features > should include timestamp in encrypted asset data 1ms
   âœ“ Implementation Task T023: EncryptionService > Security Features > should detect encrypted data format 0ms
   âœ“ Implementation Task T023: EncryptionService > Security Features > should normalize keys correctly 0ms
   Ã— Implementation Task T023: EncryptionService > Security Features > should validate encryption configuration 5ms
     â†’ expected false to be true // Object.is equality
   âœ“ Implementation Task T023: EncryptionService > Security Features > should handle key length variations 1ms
   Ã— Implementation Task T023: EncryptionService > Error Handling > should provide meaningful error messages 1ms
     â†’ promise resolved "'D5VXmmi/nfoNYRuU::FrATa0iu4gH/EhOcaU3â€¦'" instead of rejecting
   âœ“ Implementation Task T023: EncryptionService > Error Handling > should handle malformed encrypted data gracefully 1ms
   âœ“ Implementation Task T023: EncryptionService > Performance and Scalability > should handle large data encryption efficiently 1ms
   âœ“ Implementation Task T023: EncryptionService > Performance and Scalability > should handle multiple concurrent encryptions 0ms
stdout | tests/contract/nisabYearRecords.put.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-58b98a43d4e6cbaf.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-58b98a43d4e6cbaf.db

stdout | tests/contract/nisabYearRecords.put.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.post.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 1609.539 ms - -[0m
[0mPOST /api/assets [32m201[0m 79.490 ms - 506[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create DRAFT record with required fields
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 139.871 ms - 495[0m
[0mGET /api/nisab-year-records/status [32m200[0m 4.379 ms - 16[0m
[0mGET /api/assets [32m200[0m 3.668 ms - 678[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create DRAFT record with required fields
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmsq900010g2kgcviaq5s 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create DRAFT record with required fields
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmsq900010g2kgcviaq5s for user cmldqmsmj00000g2ksx5vywdq 

[0mPOST /api/nisab-year-records [32m201[0m 290.517 ms - 795[0m
stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should allow new Hawl to start after interruption if wealth rises again
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmrn600000g1s47eyq8j6 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create record with silver nisab basis
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.put.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should allow new Hawl to start after interruption if wealth rises again
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmrn600000g1s47eyq8j6 

stdout | tests/contract/nisabYearRecords.put.test.ts
JWT_SECRET (jwt.ts): supersecret

[0mPOST /api/assets [32m201[0m 426.931 ms - 498[0m
stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should not interrupt if wealth temporarily fluctuates but stays above Nisab
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should not interrupt if wealth temporarily fluctuates but stays above Nisab
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create record with silver nisab basis
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmt6000040g2k7xreut2d 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create record with silver nisab basis
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmt6000040g2k7xreut2d for user cmldqmsmj00000g2ksx5vywdq 

[0mPOST /api/assets [32m201[0m 239.595 ms - 497[0m
[0mPOST /api/nisab-year-records [32m201[0m 648.641 ms - 797[0m
stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should not interrupt if wealth temporarily fluctuates but stays above Nisab
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmrn600000g1s47eyq8j6 

[0mPOST /api/assets [32m201[0m 456.724 ms - 497[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate nisabThresholdAtStart if not provided
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mGET /api/nisab-year-records/status [32m200[0m 10.821 ms - 16[0m
stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update userNotes on DRAFT record
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldqmtga00020g4k12bng9ol 

stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update userNotes on DRAFT record
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldqmtga00020g4k12bng9ol 

stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should record interruption in audit trail
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqmrn600000g1s47eyq8j6 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate nisabThresholdAtStart if not provided
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmu1900070g2k0250kb1y 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate nisabThresholdAtStart if not provided
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmu1900070g2k0250kb1y for user cmldqmsmj00000g2ksx5vywdq 

[0mPUT /api/nisab-year-records/cmldqmtga00020g4k12bng9ol [32m200[0m 484.150 ms - -[0m
[0mPOST /api/nisab-year-records [32m201[0m 40.879 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept user-provided nisabThresholdAtStart
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should record interruption in audit trail
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should record interruption in audit trail
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should record interruption in audit trail
[HawlTrackingService] INFO: User cmldqmrn600000g1s47eyq8j6 reached Nisab 459.27. Starting Hawl. 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept user-provided nisabThresholdAtStart
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmu2p000a0g2ka24lphhj 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept user-provided nisabThresholdAtStart
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmu2p000a0g2ka24lphhj for user cmldqmsmj00000g2ksx5vywdq 

[0mPOST /api/nisab-year-records [32m201[0m 27.745 ms - 795[0m
stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should record interruption in audit trail
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should record interruption in audit trail
[HawlTrackingService] INFO: User cmldqmrn600000g1s47eyq8j6 wealth 0 dropped below Nisab 459.27. Interrupting Hawl. 

stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update totalLiabilities on DRAFT record
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldqmu2v00060g4k4664znb5 

stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update totalLiabilities on DRAFT record
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldqmu2v00060g4k4664znb5 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept optional userNotes field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPUT /api/nisab-year-records/cmldqmu2v00060g4k4664znb5 [32m200[0m 30.170 ms - -[0m
[0mPOST /api/assets [32m201[0m 54.695 ms - 495[0m
[0mGET /api/nisab-year-records/status [32m200[0m 5.109 ms - 16[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept optional userNotes field
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmu49000d0g2ku0y3s4x2 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept optional userNotes field
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmu49000d0g2ku0y3s4x2 for user cmldqmsmj00000g2ksx5vywdq 

[0mPOST /api/nisab-year-records [32m201[0m 28.706 ms - 825[0m
[0mGET /api/assets [32m200[0m 3.844 ms - 678[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate hawlCompletionDate (354 days after start)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should clear Hawl completion date on interruption
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlInterruption.test.ts > Integration: Hawl Interruption > should clear Hawl completion date on interruption
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update UNLOCKED record
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldqmu4m000a0g4kum401epc 

stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldqmu4m000a0g4kum401epc 

[0mPUT /api/nisab-year-records/cmldqmu4m000a0g4kum401epc [32m200[0m 29.505 ms - -[0m
[0mPOST /api/assets [32m201[0m 22.308 ms - 498[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate hawlCompletionDate (354 days after start)
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmu5m000g0g2kv0trgrh5 

[0mGET /api/nisab-year-records/status [32m200[0m 3.916 ms - 16[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate hawlCompletionDate (354 days after start)
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmu5m000g0g2kv0trgrh5 for user cmldqmsmj00000g2ksx5vywdq 

[0mPOST /api/nisab-year-records [32m201[0m 36.196 ms - 795[0m
[0mPOST /api/nisab-year-records [33m400[0m 1.902 ms - 82[0m
[0mPOST /api/nisab-year-records [33m400[0m 2.266 ms - 90[0m
[0mPUT /api/nisab-year-records/cmldqmu6i000e0g4kvkjivhls [33m409[0m 23.553 ms - 94[0m
 â¯ tests/integration/hawlInterruption.test.ts (6 tests | 6 failed) 3719ms
   Ã— Integration: Hawl Interruption > should detect Hawl interruption when wealth drops below Nisab 92ms
     â†’ Cannot read properties of undefined (reading 'id')
   Ã— Integration: Hawl Interruption > should archive interrupted DRAFT record 286ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Integration: Hawl Interruption > should allow new Hawl to start after interruption if wealth rises again 556ms
     â†’ Cannot read properties of undefined (reading 'id')
   Ã— Integration: Hawl Interruption > should not interrupt if wealth temporarily fluctuates but stays above Nisab 932ms
     â†’ expected false to be true // Object.is equality
   Ã— Integration: Hawl Interruption > should record interruption in audit trail 124ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Integration: Hawl Interruption > should clear Hawl completion date on interruption 50ms
     â†’ expected undefined to be defined
[0mPOST /api/nisab-year-records [33m400[0m 2.020 ms - 90[0m
[0mPOST /api/nisab-year-records [33m400[0m 1.881 ms - 91[0m
[0mPOST /api/nisab-year-records [33m400[0m 1.079 ms - 97[0m
[0mPUT /api/nisab-year-records/00000000-0000-0000-0000-000000000000 [33m404[0m 6.123 ms - 66[0m
[0mPOST /api/nisab-year-records [33m401[0m 0.613 ms - 94[0m
[0mPOST /api/nisab-year-records [33m401[0m 0.990 ms - 91[0m
[0mPUT /api/nisab-year-records/some-id [33m401[0m 0.748 ms - 94[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should create record with authenticated user ID
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

 â¯ tests/contract/nisabYearRecords.put.test.ts (6 tests | 1 failed) 1234ms
   âœ“ PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update userNotes on DRAFT record  814ms
   Ã— PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update totalLiabilities on DRAFT record 63ms
     â†’ expected '0' to be '1500' // Object.is equality
   âœ“ PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update UNLOCKED record 67ms
   âœ“ PUT /api/nisab-year-records/:id - Contract Tests > Update Restriction Validation > should reject updates to FINALIZED records 56ms
   âœ“ PUT /api/nisab-year-records/:id - Contract Tests > Error Cases > should return 404 for non-existent record 13ms
   âœ“ PUT /api/nisab-year-records/:id - Contract Tests > Error Cases > should return 401 without auth token 6ms
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should create record with authenticated user ID
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmu8s000j0g2k3fui53me 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should create record with authenticated user ID
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmu8s000j0g2k3fui53me for user cmldqmsmj00000g2ksx5vywdq 

[0mPOST /api/nisab-year-records [32m201[0m 20.991 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should return correct response structure
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should return correct response structure
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmu9q000m0g2koj4xsg2m 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should return correct response structure
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmu9q000m0g2koj4xsg2m for user cmldqmsmj00000g2ksx5vywdq 

[0mPOST /api/nisab-year-records [32m201[0m 19.754 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should include Hijri dates in response
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should include Hijri dates in response
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmuan000p0g2kyjom68yb 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should include Hijri dates in response
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmuan000p0g2kyjom68yb for user cmldqmsmj00000g2ksx5vywdq 

[0mPOST /api/nisab-year-records [32m201[0m 18.979 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should encrypt sensitive fields in database
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should encrypt sensitive fields in database
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmubk000s0g2k3360l1z0 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should encrypt sensitive fields in database
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmubk000s0g2k3360l1z0 for user cmldqmsmj00000g2ksx5vywdq 

[0mPOST /api/nisab-year-records [32m201[0m 29.916 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should set correct initial status to DRAFT
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should set correct initial status to DRAFT
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldqmucn000v0g2k8e277j71 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should set correct initial status to DRAFT
[NisabYearRecordService] INFO: Nisab Year Record created: cmldqmucn000v0g2k8e277j71 for user cmldqmsmj00000g2ksx5vywdq 

[0mPOST /api/nisab-year-records [32m201[0m 24.414 ms - 795[0m
 â¯ tests/contract/nisabYearRecords.post.test.ts (18 tests | 2 failed) 2277ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create DRAFT record with required fields  588ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create record with silver nisab basis  1109ms
   Ã— POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate nisabThresholdAtStart if not provided 65ms
     â†’ expected 0 to be greater than 0
   Ã— POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept user-provided nisabThresholdAtStart 58ms
     â†’ expected +0 to be 5687.2 // Object.is equality
   âœ“ POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept optional userNotes field 49ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate hawlCompletionDate (354 days after start) 51ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Request Validation > should return 400 when hawlStartDate is missing 12ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Request Validation > should return 400 when nisabBasis is missing 12ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Request Validation > should return 400 when nisabBasis is invalid 15ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Request Validation > should return 400 when hawlStartDate is invalid format 9ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Request Validation > should return 400 when nisabThresholdAtStart is negative 6ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should return 401 without auth token 6ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should return 401 with invalid token 5ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should create record with authenticated user ID 31ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should return correct response structure 35ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should include Hijri dates in response 28ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should encrypt sensitive fields in database 41ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should set correct initial status to DRAFT 35ms
stdout | tests/contract/nisabYearRecords.getById.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a22f0f3eb3fe82e8.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a22f0f3eb3fe82e8.db

stdout | ../tests/contract/nisabYearRecords.finalize.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b9e969392e18d5e4.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b9e969392e18d5e4.db

stdout | ../tests/contract/nisabYearRecords.get.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-38db9b1fffae58cf.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-38db9b1fffae58cf.db

stdout | tests/contract/nisabYearRecords.getById.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.finalize.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.get.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.getById.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.getById.test.ts
JWT_SECRET (jwt.ts): supersecret

[0mGET /api/nisab-year-records/cmldqmw9k00020g5etglpac02 [32m200[0m 18.717 ms - -[0m
[0mGET /api/nisab-year-records/cmldqmw9k00020g5etglpac02 [32m200[0m 6.873 ms - -[0m
[0mGET /api/nisab-year-records/00000000-0000-0000-0000-000000000000 [33m404[0m 11.990 ms - 66[0m
[0mGET /api/nisab-year-records/cmldqmw9k00020g5etglpac02 [33m401[0m 0.414 ms - 94[0m
[0mGET /api/nisab-year-records/cmldqmw9k00020g5etglpac02 [33m404[0m 3.403 ms - 66[0m
stdout | ../tests/contract/nisabYearRecords.finalize.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mGET /api/nisab-year-records/cmldqmw9k00020g5etglpac02 [32m200[0m 6.389 ms - -[0m
[0mGET /api/nisab-year-records/cmldqmw9k00020g5etglpac02 [32m200[0m 3.619 ms - -[0m
stdout | ../tests/contract/nisabYearRecords.get.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 â¯ tests/contract/nisabYearRecords.getById.test.ts (7 tests | 1 failed) 196ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Successful Retrieval > should return 200 with complete record data 54ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Successful Retrieval > should include live tracking for DRAFT records 14ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Error Cases > should return 404 for non-existent record ID 19ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Error Cases > should return 401 without auth token 4ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Error Cases > should return 404 when accessing another user's record 23ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Response Schema Validation > should return correct response structure 14ms
   Ã— GET /api/nisab-year-records/:id - Contract Tests > Response Schema Validation > should decrypt sensitive fields for display 13ms
     â†’ expected 'number' to be 'string' // Object.is equality
[0mPOST /api/nisab-year-records/cmldqmwg300020g5ljb4mzfqa/finalize [33m401[0m 12.497 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldqmwgc00040g5lcueg9r62/finalize [33m401[0m 1.320 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldqmwgc00040g5lcueg9r62/finalize [33m401[0m 0.897 ms - 91[0m
[0mPOST /api/nisab-year-records/nonexistent-id/finalize [33m401[0m 0.678 ms - 91[0m
[0mGET /api/nisab-year-records [32m200[0m 18.581 ms - 820[0m
[0mPOST /api/nisab-year-records/cmldqmwg300020g5ljb4mzfqa/finalize [33m401[0m 0.629 ms - 94[0m
[0mPOST /api/nisab-year-records/cmldqmwg300020g5ljb4mzfqa/finalize [33m401[0m 0.827 ms - 91[0m
[0mGET /api/nisab-year-records?status=DRAFT [32m200[0m 4.850 ms - 820[0m
[0mGET /api/nisab-year-records?year=2025 [32m200[0m 4.672 ms - 820[0m
 â¯ ../tests/contract/nisabYearRecords.finalize.test.ts (6 tests | 5 failed) 135ms
   Ã— POST /api/nisab-year-records/:id/finalize > should finalize a DRAFT record when Hawl is complete 43ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/finalize > should not finalize when Hawl is incomplete 9ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/finalize > should allow override with acknowledgePremature flag 8ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/finalize > should return 404 for non-existent record 6ms
     â†’ expected 401 to be 404 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/finalize > should return 401 for unauthenticated request 7ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   âœ“ POST /api/nisab-year-records/:id/finalize > should create audit trail entry for finalization 5ms
[0mGET /api/nisab-year-records [33m401[0m 0.416 ms - 94[0m
[0mGET /api/nisab-year-records?status=FINALIZED&year=1900 [32m200[0m 3.622 ms - 86[0m
 â¯ ../tests/contract/nisabYearRecords.get.test.ts (5 tests | 5 failed) 143ms
   Ã— GET /api/nisab-year-records > should return 200 with all records for authenticated user 52ms
     â†’ expected false to be true // Object.is equality
   Ã— GET /api/nisab-year-records > should filter records by status=DRAFT 15ms
     â†’ expected { records: [ { â€¦(28) } ], â€¦(4) } to deeply equal ArrayContaining{â€¦}
   Ã— GET /api/nisab-year-records > should filter records by year parameter 12ms
     â†’ actual value must be number or bigint, received "undefined"
   Ã— GET /api/nisab-year-records > should return 401 for unauthenticated request 5ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   Ã— GET /api/nisab-year-records > should return empty array when no records match filter 8ms
     â†’ expected { records: [], total: +0, â€¦(3) } to deeply equal []
stdout | ../tests/contract/nisabYearRecords.put.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-eb6115d2101a4abd.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-eb6115d2101a4abd.db

stdout | ../tests/contract/nisabYearRecords.unlock.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f5b1f7df667a0bea.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f5b1f7df667a0bea.db

stdout | ../tests/contract/nisabYearRecords.delete.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-64528b3cd2d269e6.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-64528b3cd2d269e6.db

stdout | ../tests/contract/nisabYearRecords.put.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.unlock.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.delete.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.put.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPUT /api/nisab-year-records/cmldqmygt00020g7onktw954v [33m401[0m 16.641 ms - 91[0m
stdout | ../tests/contract/nisabYearRecords.delete.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPUT /api/nisab-year-records/cmldqmygt00020g7onktw954v [33m401[0m 1.231 ms - 91[0m
[0mPUT /api/nisab-year-records/cmldqmygt00020g7onktw954v [33m401[0m 0.818 ms - 91[0m
[0mPUT /api/nisab-year-records/cmldqmygt00020g7onktw954v [33m401[0m 0.708 ms - 91[0m
[0mPUT /api/nisab-year-records/nonexistent-id [33m401[0m 0.682 ms - 91[0m
stdout | ../tests/contract/nisabYearRecords.unlock.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPUT /api/nisab-year-records/cmldqmygt00020g7onktw954v [33m401[0m 0.670 ms - 94[0m
 â¯ ../tests/contract/nisabYearRecords.put.test.ts (6 tests | 6 failed) 126ms
   Ã— PUT /api/nisab-year-records/:id > should update record fields for DRAFT status 50ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— PUT /api/nisab-year-records/:id > should transition from DRAFT to FINALIZED 6ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— PUT /api/nisab-year-records/:id > should require unlock reason when transitioning to UNLOCKED 6ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— PUT /api/nisab-year-records/:id > should reject invalid status transitions 6ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— PUT /api/nisab-year-records/:id > should return 404 for non-existent record 6ms
     â†’ expected 401 to be 404 // Object.is equality
   Ã— PUT /api/nisab-year-records/:id > should return 401 for unauthenticated request 7ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
[0mDELETE /api/nisab-year-records/cmldqmyle00020g8g7be7blff [33m401[0m 3.929 ms - 91[0m
[0mDELETE /api/nisab-year-records/cmldqmylk00040g8gagw4zz19 [33m401[0m 0.951 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldqmylx00020g89o4dbmppo/unlock [33m401[0m 12.178 ms - 91[0m
[0mDELETE /api/nisab-year-records/nonexistent-id [33m401[0m 0.708 ms - 91[0m
[0mDELETE /api/nisab-year-records/cmldqmyle00020g8g7be7blff [33m401[0m 0.501 ms - 94[0m
[0mDELETE /api/nisab-year-records/cmldqmyle00020g8g7be7blff [33m401[0m 0.435 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldqmylx00020g89o4dbmppo/unlock [33m401[0m 1.377 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldqmylx00020g89o4dbmppo/unlock [33m401[0m 0.814 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldqmylx00020g89o4dbmppo/unlock [33m401[0m 0.796 ms - 91[0m
[0mPOST /api/nisab-year-records/nonexistent-id/unlock [33m401[0m 0.728 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldqmylx00020g89o4dbmppo/unlock [33m401[0m 0.663 ms - 94[0m
 â¯ ../tests/contract/nisabYearRecords.delete.test.ts (5 tests | 4 failed) 113ms
   Ã— DELETE /api/nisab-year-records/:id > should delete a DRAFT record 33ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— DELETE /api/nisab-year-records/:id > should not delete FINALIZED records 6ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— DELETE /api/nisab-year-records/:id > should return 404 for non-existent record 10ms
     â†’ expected 401 to be 404 // Object.is equality
   Ã— DELETE /api/nisab-year-records/:id > should return 401 for unauthenticated request 7ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   âœ“ DELETE /api/nisab-year-records/:id > should not return deleted record in subsequent GET 5ms
[0mPOST /api/nisab-year-records/cmldqmylx00020g89o4dbmppo/unlock [33m401[0m 0.680 ms - 91[0m
 â¯ ../tests/contract/nisabYearRecords.unlock.test.ts (7 tests | 5 failed) 122ms
   Ã— POST /api/nisab-year-records/:id/unlock > should unlock a FINALIZED record with valid reason 44ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/unlock > should reject unlock reason shorter than 10 characters 7ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/unlock > should reject unlock without reason 7ms
     â†’ expected 401 to be 400 // Object.is equality
   âœ“ POST /api/nisab-year-records/:id/unlock > should create audit trail entry with unlock reason 6ms
   Ã— POST /api/nisab-year-records/:id/unlock > should return 404 for non-existent record 6ms
     â†’ expected 401 to be 404 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/unlock > should return 401 for unauthenticated request 7ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   âœ“ POST /api/nisab-year-records/:id/unlock > should return encrypted unlock reason in audit trail 4ms
stdout | ../tests/unit/encryption.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-99227ba04c6b1bc3.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-99227ba04c6b1bc3.db

stdout | ../tests/contract/nisabYearRecords.getById.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-4277a02c960f9a71.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-4277a02c960f9a71.db

stdout | ../tests/contract/nisabYearRecords.post.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-91b25bd359315fe1.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-91b25bd359315fe1.db

 â¯ ../tests/unit/encryption.test.ts (29 tests | 2 failed | 1 skipped) 112ms
   âœ“ EncryptionService > Constructor and Initialization > should have encryption key configured 2ms
   âœ“ EncryptionService > Constructor and Initialization > should throw error with missing encryption key 1ms
   âœ“ EncryptionService > Constructor and Initialization > should throw error with invalid encryption key length 0ms
   â†“ EncryptionService > Constructor and Initialization > should create singleton instance
   âœ“ EncryptionService > Basic Encryption/Decryption > should encrypt and decrypt text data 3ms
   âœ“ EncryptionService > Basic Encryption/Decryption > should encrypt and decrypt JSON objects 1ms
   âœ“ EncryptionService > Basic Encryption/Decryption > should encrypt and decrypt arrays 1ms
   Ã— EncryptionService > Basic Encryption/Decryption > should handle empty strings 13ms
     â†’ expected '{"encryptedData":"","iv":"abda003a25câ€¦' to be '' // Object.is equality
   âœ“ EncryptionService > Basic Encryption/Decryption > should handle null and undefined values in objects 1ms
   âœ“ EncryptionService > Security Properties > should generate different IV for each encryption 1ms
   âœ“ EncryptionService > Security Properties > should produce different ciphertext for identical inputs 1ms
   âœ“ EncryptionService > Security Properties > should handle sensitive financial data correctly 1ms
   âœ“ EncryptionService > Security Properties > should use AES-256-GCM algorithm 3ms
   âœ“ EncryptionService > Error Handling > should throw error for invalid encrypted data format 1ms
   âœ“ EncryptionService > Error Handling > should throw error for invalid IV format 1ms
   âœ“ EncryptionService > Error Handling > should throw error for missing encrypted data 0ms
   Ã— EncryptionService > Error Handling > should throw error for missing IV 4ms
     â†’ expected [Function] to throw an error
   âœ“ EncryptionService > Error Handling > should handle JSON parsing errors gracefully 1ms
   âœ“ EncryptionService > Data Types and Edge Cases > should handle very long strings 1ms
   âœ“ EncryptionService > Data Types and Edge Cases > should handle unicode characters 0ms
   âœ“ EncryptionService > Data Types and Edge Cases > should handle special characters and symbols 0ms
   âœ“ EncryptionService > Data Types and Edge Cases > should handle complex nested objects 0ms
   âœ“ EncryptionService > Data Types and Edge Cases > should handle numeric precision correctly 0ms
   âœ“ EncryptionService > Performance and Memory > should encrypt/decrypt within reasonable time limits 6ms
   âœ“ EncryptionService > Performance and Memory > should not leak memory with repeated operations 65ms
   âœ“ EncryptionService > Islamic Compliance Data Protection > should properly encrypt Zakat calculation data 1ms
   âœ“ EncryptionService > Islamic Compliance Data Protection > should encrypt user profile data securely 1ms
   âœ“ EncryptionService > Backwards Compatibility > should maintain consistent encryption format 1ms
   âœ“ EncryptionService > Backwards Compatibility > should decrypt data encrypted with same algorithm 0ms
stdout | tests/unit/services/hawlTrackingService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c93b5dd84a6164ea.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c93b5dd84a6164ea.db

stdout | tests/unit/services/hawlTrackingService.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > detectNisabAchievement > should process users and create DRAFT records if Nisab reached
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > detectNisabAchievement > should process users and create DRAFT records if Nisab reached
[HawlTrackingService] INFO: Nisab detection complete: 0 DRAFT records created 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > handleWealthChange > should start Hawl if wealth >= Nisab and no active Hawl
[HawlTrackingService] INFO: Handling wealth change for user user1 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > handleWealthChange > should interrupt Hawl if wealth < Nisab and active Hawl exists
[HawlTrackingService] INFO: Handling wealth change for user user1 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > handleWealthChange > should do nothing if wealth < Nisab and no active Hawl
[HawlTrackingService] INFO: Handling wealth change for user user1 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > handleWealthChange > should do nothing if wealth >= Nisab and active Hawl exists
[HawlTrackingService] INFO: Handling wealth change for user user1 

 â¯ tests/unit/services/hawlTrackingService.test.ts (9 tests | 3 failed) 79ms
   âœ“ HawlTrackingService > calculateHawlCompletionDate > should add 354 days to start date for lunar year 13ms
   âœ“ HawlTrackingService > toHijriDate > should convert Gregorian date to Hijri format 2ms
   Ã— HawlTrackingService > detectNisabAchievement > should process users and create DRAFT records if Nisab reached 28ms
     â†’ expected +0 to be 1 // Object.is equality
   âœ“ HawlTrackingService > isHawlComplete > should return true if 354 days have passed 5ms
   âœ“ HawlTrackingService > isHawlComplete > should return false if 354 days have not passed 9ms
   Ã— HawlTrackingService > handleWealthChange > should start Hawl if wealth >= Nisab and no active Hawl 7ms
     â†’ expected "spy" to be called at least once
   Ã— HawlTrackingService > handleWealthChange > should interrupt Hawl if wealth < Nisab and active Hawl exists 6ms
     â†’ expected "spy" to be called with arguments: [ { where: { id: 'record1' } } ][90m

Number of calls: [1m0[22m
[39m
   âœ“ HawlTrackingService > handleWealthChange > should do nothing if wealth < Nisab and no active Hawl 3ms
   âœ“ HawlTrackingService > handleWealthChange > should do nothing if wealth >= Nisab and active Hawl exists 3ms
stdout | ../tests/contract/nisabYearRecords.getById.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.post.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/unit/zakatService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-52110fbea2c9527b.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-52110fbea2c9527b.db

stdout | ../tests/unit/zakatService.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 â¯ ../tests/unit/zakatService.test.ts (27 tests | 7 failed) 47ms
   âœ“ Comprehensive ZakatService Methodology Tests > Nisab Calculations by Method > Hanafi method uses silver nisab exclusively 2ms
   âœ“ Comprehensive ZakatService Methodology Tests > Nisab Calculations by Method > Shafi'i method uses dual minimum nisab 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Nisab Calculations by Method > Standard method uses minimum with specific basis tracking 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Nisab Calculations by Method > Custom method allows configurable nisab approach 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Edge Case Tests > Nisab Boundary Conditions > should handle assets exactly at nisab threshold 2ms
   âœ“ Comprehensive ZakatService Methodology Tests > Edge Case Tests > Nisab Boundary Conditions > should handle assets just below nisab threshold 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Edge Case Tests > Nisab Boundary Conditions > should handle assets just above nisab threshold 0ms
   Ã— Comprehensive ZakatService Methodology Tests > Edge Case Tests > Debt Deduction Tests > should apply comprehensive debt deduction for Hanafi method 16ms
     â†’ expected 'conservative' to be 'comprehensive' // Object.is equality
   Ã— Comprehensive ZakatService Methodology Tests > Edge Case Tests > Debt Deduction Tests > should apply conservative debt deduction for Shafi'i method 2ms
     â†’ expected 'comprehensive' to be 'conservative' // Object.is equality
   âœ“ Comprehensive ZakatService Methodology Tests > Edge Case Tests > Debt Deduction Tests > should handle zero debt scenario 1ms
   Ã— Comprehensive ZakatService Methodology Tests > Edge Case Tests > Business Asset Inclusion Tests > should include business assets comprehensively in Hanafi method 4ms
     â†’ expected [ 'Hanafi methodology applied' ] to include 'Comprehensive business asset inclusion'
   âœ“ Comprehensive ZakatService Methodology Tests > Edge Case Tests > Business Asset Inclusion Tests > should categorize business assets detailed for Shafi'i method 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Cross-Method Validation and Consistency > should produce logically consistent results across all methods 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Cross-Method Validation and Consistency > should demonstrate Hanafi vs Standard nisab differences 0ms
   Ã— Comprehensive ZakatService Methodology Tests > Cross-Method Validation and Consistency > should validate method-specific source citations 1ms
     â†’ expected [ Array(1) ] to include 'Al-Hidayah by al-Marghinani'
   âœ“ Comprehensive ZakatService Methodology Tests > Cross-Method Validation and Consistency > should ensure all methods handle same asset categories 1ms
   Ã— Comprehensive ZakatService Methodology Tests > Method-Specific Rule Validation > should apply Hanafi-specific rules correctly 1ms
     â†’ expected [ 'Hanafi methodology applied' ] to include 'Comprehensive business asset inclusion'
   Ã— Comprehensive ZakatService Methodology Tests > Method-Specific Rule Validation > should apply Shafi'i-specific rules correctly 2ms
     â†’ expected 'silver' to be 'dual_minimum' // Object.is equality
   Ã— Comprehensive ZakatService Methodology Tests > Method-Specific Rule Validation > should apply Standard method (AAOIFI) rules correctly 1ms
     â†’ expected [ Array(1) ] to include 'AAOIFI FAS 9'
   âœ“ Comprehensive ZakatService Methodology Tests > Custom Method Configuration Tests > should handle custom nisab values 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Custom Method Configuration Tests > should validate custom method configuration requirements 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Performance and Error Handling Tests > should handle large asset portfolios efficiently 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Performance and Error Handling Tests > should handle invalid method gracefully 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Performance and Error Handling Tests > should handle empty asset list 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Performance and Error Handling Tests > should handle extreme price scenarios 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Integration and Comprehensive Scenarios > should handle complete zakat calculation scenario 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Integration and Comprehensive Scenarios > should provide consistent calculation breakdown structure 1ms
stdout | src/__tests__/calendarService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2ebe427f66d39809.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2ebe427f66d39809.db

 â¯ src/__tests__/calendarService.test.ts (37 tests | 1 failed) 31ms
   âœ“ CalendarService > gregorianToHijri conversion > should convert known Gregorian dates to Hijri dates accurately 3ms
   âœ“ CalendarService > gregorianToHijri conversion > should convert January 1, 2024 to a valid Hijri date 1ms
   âœ“ CalendarService > gregorianToHijri conversion > should convert October 9, 2025 (current date) to valid Hijri 0ms
   âœ“ CalendarService > gregorianToHijri conversion > should handle year boundary conversions correctly 1ms
   âœ“ CalendarService > gregorianToHijri conversion > should handle month boundary conversions correctly 1ms
   âœ“ CalendarService > gregorianToHijri conversion > should return valid month names 1ms
   Ã— CalendarService > getCurrentIslamicDate > should return current Hijri date 9ms
     â†’ expected undefined to be truthy
   âœ“ CalendarService > formatHijriDate > should format Hijri date correctly 0ms
   âœ“ CalendarService > formatHijriDate > should format all month names correctly 1ms
   âœ“ CalendarService > formatHijriDate > should handle different day values 0ms
   âœ“ CalendarService > isHijriLeapYear > should correctly identify leap years in 30-year cycle 1ms
   âœ“ CalendarService > isHijriLeapYear > should work for years beyond first cycle 0ms
   âœ“ CalendarService > isHijriLeapYear > should handle year 0 0ms
   âœ“ CalendarService > getDaysInHijriMonth > should return 30 days for odd months 0ms
   âœ“ CalendarService > getDaysInHijriMonth > should return 29 days for even months (except month 12 in leap years) 0ms
   âœ“ CalendarService > getDaysInHijriMonth > should return 29 days for month 12 in leap years 0ms
   âœ“ CalendarService > getDaysInHijriMonth > should return 30 days for month 12 in non-leap years 0ms
   âœ“ CalendarService > getDaysInHijriMonth > should handle all 12 months correctly 0ms
   âœ“ CalendarService > getLunarYearAdjustment > should return correct lunar year adjustment factor 0ms
   âœ“ CalendarService > getLunarYearAdjustment > should be less than 1 (lunar year is shorter) 1ms
   âœ“ CalendarService > getCalendarInfo > should return complete calendar calculation information 0ms
   âœ“ CalendarService > getCalendarInfo > should include valid Hijri date components 1ms
   âœ“ CalendarService > getCalendarInfo > should return lunar adjustment factor by default 0ms
   âœ“ CalendarService > calculateZakatYearPeriod > should calculate lunar year period correctly 0ms
   âœ“ CalendarService > calculateZakatYearPeriod > should calculate solar year period correctly 0ms
   âœ“ CalendarService > calculateZakatYearPeriod > should handle leap years correctly for solar calendar 1ms
   âœ“ CalendarService > calculateZakatYearPeriod > should calculate different end dates for lunar vs solar 0ms
   âœ“ CalendarService > Edge cases and error handling > should handle very old dates 0ms
   âœ“ CalendarService > Edge cases and error handling > should handle future dates 0ms
   âœ“ CalendarService > Edge cases and error handling > should handle Islamic epoch date 0ms
   âœ“ CalendarService > should handle midnight dates 0ms
   âœ“ CalendarService > should handle end of day dates 0ms
   âœ“ CalendarService > Zakat calculation integration > should provide correct adjustment factor for zakat calculations 0ms
   âœ“ CalendarService > Zakat calculation integration > should calculate next zakat date correctly 1ms
   âœ“ CalendarService > Performance and consistency > should return consistent results for same date 0ms
   âœ“ CalendarService > Performance and consistency > should handle rapid sequential calls 1ms
   âœ“ CalendarService > Performance and consistency > should complete conversion in reasonable time 0ms
stdout | src/__tests__/MetalPriceScraperService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-bdfa2d70b13605bf.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-bdfa2d70b13605bf.db

stdout | ../tests/contract/nisabYearRecords.getById.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.post.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mGET /api/nisab-year-records/cmldqn0r000020galt3gpcx9u [33m401[0m 4.111 ms - 91[0m
[0mGET /api/nisab-year-records/cmldqn0r000020galt3gpcx9u [33m401[0m 0.934 ms - 91[0m
[0mGET /api/nisab-year-records/cmldqn0r000020galt3gpcx9u [33m401[0m 0.513 ms - 91[0m
[0mGET /api/nisab-year-records/nonexistent-id [33m401[0m 0.452 ms - 91[0m
[0mGET /api/nisab-year-records/cmldqn0r000020galt3gpcx9u [33m401[0m 0.584 ms - 94[0m
[0mGET /api/nisab-year-records/cmldqn0r000020galt3gpcx9u [33m401[0m 0.357 ms - 116[0m
 â¯ src/__tests__/MetalPriceScraperService.test.ts (7 tests | 2 failed) 33ms
   âœ“ MetalPriceScraperService > scrapeGoldPrice > should extract gold price from page title 12ms
   âœ“ MetalPriceScraperService > scrapeGoldPrice > should extract gold price from body as fallback 2ms
   âœ“ MetalPriceScraperService > scrapeGoldPrice > should throw error if price cannot be found 3ms
   Ã— MetalPriceScraperService > scrapeSilverPrice > should extract silver price from gram format in title 8ms
     â†’ Could not find silver price on https://www.livepriceofgold.com/silver-price/us.html. Check if page structure changed.
   Ã— MetalPriceScraperService > scrapeSilverPrice > should convert ounce price if gram price missing 2ms
     â†’ Could not find silver price on https://www.livepriceofgold.com/silver-price/us.html. Check if page structure changed.
   âœ“ MetalPriceScraperService > scrapeSilverPrice > should ignore high values (gold price) in body and throw or find correct silver price 2ms
   âœ“ MetalPriceScraperService > scrapeSilverPrice > should throw error if only high value (gold) is found 1ms
 â¯ ../tests/contract/nisabYearRecords.getById.test.ts (6 tests | 6 failed) 121ms
   Ã— GET /api/nisab-year-records/:id > should return 200 with record details 37ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— GET /api/nisab-year-records/:id > should include audit trail in response 7ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— GET /api/nisab-year-records/:id > should include live tracking fields for DRAFT records 7ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— GET /api/nisab-year-records/:id > should return 404 for non-existent record 5ms
     â†’ expected 401 to be 404 // Object.is equality
   Ã— GET /api/nisab-year-records/:id > should return 401 for unauthenticated request 7ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   Ã— GET /api/nisab-year-records/:id > should not return records of other users 11ms
     â†’ expected 401 to be 404 // Object.is equality
[0mPOST /api/nisab-year-records [33m401[0m 11.987 ms - 91[0m
[0mPOST /api/nisab-year-records [33m401[0m 3.191 ms - 91[0m
[0mPOST /api/nisab-year-records [33m401[0m 0.795 ms - 91[0m
[0mPOST /api/nisab-year-records [33m401[0m 0.679 ms - 91[0m
[0mPOST /api/nisab-year-records [33m401[0m 0.761 ms - 94[0m
[0mPOST /api/nisab-year-records [33m401[0m 0.672 ms - 91[0m
 â¯ ../tests/contract/nisabYearRecords.post.test.ts (6 tests | 6 failed) 110ms
   Ã— POST /api/nisab-year-records > should create a new DRAFT record with valid data 44ms
     â†’ expected 401 to be 201 // Object.is equality
   Ã— POST /api/nisab-year-records > should reject request without required hawlStartDate 9ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— POST /api/nisab-year-records > should reject request without required nisabBasis 6ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— POST /api/nisab-year-records > should reject invalid nisabBasis value 5ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— POST /api/nisab-year-records > should return 401 for unauthenticated request 7ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   Ã— POST /api/nisab-year-records > should calculate nisabThresholdAtStart if not provided 5ms
     â†’ expected 401 to be 201 // Object.is equality
stdout | ../tests/contract/assets-put.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f1cf6866ed0ad25a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f1cf6866ed0ad25a.db

stdout | ../tests/unit/islamic-calculation.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6fd7d477d0150078.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6fd7d477d0150078.db

 â¯ ../tests/contract/assets-put.test.ts (12 tests | 12 skipped) 11ms
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should require authentication
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should update asset with valid data and return standardized response
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should handle asset not found
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should handle unauthorized access to other users assets
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should validate asset value when provided
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should validate currency format when provided
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should validate description length when provided
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should validate notes length when provided
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should not allow changing asset type
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should handle partial updates
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should handle empty update request
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should validate UUID format for asset ID
stdout | tests/unit/EncryptionServiceAltSeparator.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-024fc0d9be63446c.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-024fc0d9be63446c.db

 â¯ ../tests/unit/islamic-calculation.test.ts (30 tests | 26 failed | 4 skipped) 25ms
   â†“ IslamicCalculationService > Nisab Threshold Calculations > should calculate correct gold nisab threshold
   â†“ IslamicCalculationService > Nisab Threshold Calculations > should calculate correct silver nisab threshold
   â†“ IslamicCalculationService > Nisab Threshold Calculations > should use lower of gold and silver nisab for cash calculations
   â†“ IslamicCalculationService > Nisab Threshold Calculations > should handle different currency conversions
   Ã— IslamicCalculationService > Zakat Rate Calculations > should apply 2.5% rate for cash and cash equivalents 8ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Zakat Rate Calculations > should apply 2.5% rate for gold 1ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Zakat Rate Calculations > should apply 2.5% rate for silver 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Zakat Rate Calculations > should apply 2.5% rate for business assets 1ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Zakat Rate Calculations > should not apply zakat to property for personal use 1ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Zakat Rate Calculations > should handle cryptocurrency as cash equivalent 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Methodology-Specific Calculations > Hanafi Methodology > should use specific nisab calculations for Hanafi school 4ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Methodology-Specific Calculations > Hanafi Methodology > should apply Hanafi rules for mixed assets 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Methodology-Specific Calculations > Shafi Methodology > should use Shafi-specific rules for calculations 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Methodology-Specific Calculations > Maliki Methodology > should apply Maliki school interpretations 1ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Methodology-Specific Calculations > Hanbali Methodology > should follow Hanbali jurisprudence rules 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Lunar Calendar Considerations > should calculate correct lunar year completion 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Lunar Calendar Considerations > should handle incomplete lunar year 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Lunar Calendar Considerations > should adjust for Hijri calendar differences 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Complex Asset Calculations > should handle mixed asset portfolio calculation 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Complex Asset Calculations > should exclude non-zakatable business assets 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Complex Asset Calculations > should handle debt deductions correctly 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Edge Cases and Error Handling > should handle zero or negative asset values 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Edge Cases and Error Handling > should handle assets below nisab threshold 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Edge Cases and Error Handling > should validate input data types 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Edge Cases and Error Handling > should handle very large numbers correctly 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Edge Cases and Error Handling > should maintain precision with decimal calculations 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Historical Accuracy Validation > should match traditional Islamic scholarship calculations 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Historical Accuracy Validation > should validate against contemporary Islamic finance standards 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Performance and Optimization > should complete calculations within reasonable time 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Performance and Optimization > should cache nisab calculations for performance 0ms
     â†’ IslamicCalculationService is not a constructor
 â¯ tests/unit/EncryptionServiceAltSeparator.test.ts (2 tests | 1 failed) 19ms
   âœ“ EncryptionService alternative separator handling > should decrypt encrypted payloads where separator has been replaced with `.=`, and isEncrypted should detect it 4ms
   Ã— EncryptionService alternative separator handling > PaymentRecordService should decrypt fields that use ".=" separator 7ms
     â†’ expected 20 to be close to 12.34, received difference is 7.66, but expected 0.005
stdout | ../tests/integration/assetRefresh.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9d73c78ce28a54b9.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9d73c78ce28a54b9.db

stdout | ../tests/integration/asset-management-enhancements.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-24492720a77fe598.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-24492720a77fe598.db

stdout | ../tests/integration/asset-management.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b4f69eef885717b0.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b4f69eef885717b0.db

stdout | ../tests/integration/errorHandling.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-99604bf852a5f411.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-99604bf852a5f411.db

stdout | ../tests/integration/finalization.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c06c11db12f24a2a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c06c11db12f24a2a.db

stdout | ../tests/integration/hawlDetectionAssets.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a9a951389dec7fcf.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a9a951389dec7fcf.db

stdout | ../tests/integration/assetRefresh.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/integration/hawlInterruption.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-28d3a875b0985757.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-28d3a875b0985757.db

stdout | ../tests/integration/liveWealth.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-26ca6410b081442b.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-26ca6410b081442b.db

stdout | ../tests/integration/nisabAchievement.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c7a382e040958339.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c7a382e040958339.db

stdout | ../tests/integration/statusTransitions.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-79f9c0e3dd439d1d.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-79f9c0e3dd439d1d.db

stdout | ../tests/integration/unlockEditRefinalize.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-00d88d8bab20ae75.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-00d88d8bab20ae75.db

stdout | ../tests/integration/user-registration.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-097e2f14d5eef46e.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-097e2f14d5eef46e.db

stdout | ../tests/performance/api-performance.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-df4cfb3e9d4e9534.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-df4cfb3e9d4e9534.db

stdout | ../tests/unit/data-migration.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-d7be256af5f18566.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-d7be256af5f18566.db

stdout | ../tests/integration/assetRefresh.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/unit/zakat-engine.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5a7b2d5a4fbe31eb.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5a7b2d5a4fbe31eb.db

stdout | ../tests/unit/components/AuditTrailView.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-df6563050ce85a0a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-df6563050ce85a0a.db

 â¯ ../tests/integration/assetRefresh.test.ts (8 tests | 8 skipped) 4ms
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return current assets for DRAFT record
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for UNLOCKED record
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 404 for non-existent record
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 403 when accessing another user's record
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should handle assets deleted after record creation
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should require authentication
stdout | ../tests/unit/components/FinalizationModal.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-90a0c5c6d3f5d93f.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-90a0c5c6d3f5d93f.db

stdout | ../tests/unit/components/HawlProgressIndicator.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-3e0fba5259f941dc.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-3e0fba5259f941dc.db

stdout | ../tests/unit/components/NisabComparisonWidget.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6f562c2994848f9a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6f562c2994848f9a.db

stdout | ../tests/unit/components/UnlockReasonDialog.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-38d69384009e0f76.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-38d69384009e0f76.db

stdout | ../tests/unit/security/payment-security-audit.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-fca069d277350cb6.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-fca069d277350cb6.db

stdout | ../tests/unit/services/auditTrailService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9eb2e463b97f7a2d.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9eb2e463b97f7a2d.db

stdout | ../tests/unit/services/hawlTrackingService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-99e1acb712f7baf3.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-99e1acb712f7baf3.db

stdout | ../tests/unit/services/nisabCalculationService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2750d3cb0591f499.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2750d3cb0591f499.db

stdout | ../tests/unit/services/nisabYearRecordService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-690a9f32a11f0b6c.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-690a9f32a11f0b6c.db

stdout | ../tests/unit/services/wealthAggregationService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2b17caa3c784f25c.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2b17caa3c784f25c.db

stdout | tests/integration/hawlDetectionAssets.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-749a06ad298398d8.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-749a06ad298398d8.db

stdout | tests/integration/assetRefresh.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2833a4ed0898fb3d.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2833a4ed0898fb3d.db

stdout | tests/integration/hawlDetectionAssets.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/auth-register.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-e5d72037b4ba0421.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-e5d72037b4ba0421.db

stdout | tests/integration/assetRefresh.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionAssets.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/assetRefresh.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should register user with valid data and return standardized response
Database cleaned in beforeEach

[0mPOST /api/auth/register [32m201[0m 387.768 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 384.432 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 367.312 ms - -[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate required fields
Database cleaned in beforeEach

[0mPOST /api/auth/register [33m400[0m 2.471 ms - 243[0m
[0mPOST /api/auth/register [33m400[0m 1.275 ms - 382[0m
[0mPOST /api/auth/register [33m400[0m 1.269 ms - 183[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate email format
Database cleaned in beforeEach

[0mPOST /api/auth/register [33m400[0m 1.403 ms - 197[0m
[0mPOST /api/auth/register [33m400[0m 0.952 ms - 192[0m
[0mPOST /api/auth/register [33m400[0m 1.080 ms - 203[0m
[0mPOST /api/auth/register [33m400[0m 0.976 ms - 202[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate password strength requirements
Database cleaned in beforeEach

[0mPOST /api/auth/register [33m400[0m 1.091 ms - 312[0m
[0mPOST /api/auth/register [33m400[0m 0.957 ms - 227[0m
[0mPOST /api/auth/register [33m400[0m 0.812 ms - 227[0m
[0mPOST /api/auth/register [33m400[0m 0.866 ms - 230[0m
[0mPOST /api/auth/register [33m400[0m 0.763 ms - 231[0m
[0mPOST /api/auth/register [33m400[0m 0.681 ms - 231[0m
[0mPOST /api/auth/register [33m400[0m 0.718 ms - 228[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate password confirmation match
Database cleaned in beforeEach

[0mPOST /api/auth/register [33m400[0m 0.891 ms - 206[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate name fields format
Database cleaned in beforeEach

[0mPOST /api/auth/register [33m400[0m 0.821 ms - 183[0m
[0mPOST /api/auth/register [33m400[0m 0.933 ms - -[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should handle duplicate email registration
Database cleaned in beforeEach

[0mPOST /api/auth/login [32m200[0m 321.324 ms - -[0m
[0mPOST /api/assets [32m201[0m 20.913 ms - 506[0m
[0mPOST /api/assets [32m201[0m 28.673 ms - 500[0m
[0mPOST /api/assets [32m201[0m 33.636 ms - 503[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create DRAFT record with assetBreakdown populated when Nisab achieved
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create DRAFT record with assetBreakdown populated when Nisab achieved
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create DRAFT record with assetBreakdown populated when Nisab achieved
[HawlTrackingService] INFO: Created DRAFT record for user cmldqn6cg00000gu4cpvxmwii, wealth: 10500, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create DRAFT record with assetBreakdown populated when Nisab achieved
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

[0mPOST /api/auth/login [32m200[0m 327.148 ms - -[0m
[0mPOST /api/assets [32m201[0m 18.316 ms - 503[0m
[0mPOST /api/assets [32m201[0m 26.769 ms - 508[0m
[0mPOST /api/assets [32m201[0m 11.287 ms - 510[0m
[0mGET /api/nisab-year-records/cmldqn6s300080guzw8a2av0a/assets/refresh [32m200[0m 14.232 ms - 662[0m
[0mPOST /api/auth/register [32m201[0m 337.563 ms - -[0m
[0mPOST /api/auth/register [33m409[0m 3.019 ms - 105[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should normalize email to lowercase
Database cleaned in beforeEach

[0mPOST /api/auth/register [32m201[0m 345.334 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 328.987 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn6cg00000gu4cpvxmwii 

[0mPOST /api/auth/register [32m201[0m 336.925 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn6cg00000gu4cpvxmwii 

stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate optional fields when provided
Database cleaned in beforeEach

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn6cg00000gu4cpvxmwii 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn6gt00000guzoa854vwc 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn6gt00000guzoa854vwc 

[0mPOST /api/auth/login [32m200[0m 362.293 ms - -[0m
stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn6gt00000guzoa854vwc 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 10.179 ms - 506[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[HawlTrackingService] INFO: Created DRAFT record for user cmldqn6yp000d0gu4jkgbsqno, wealth: 7500.5, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 364.140 ms - -[0m
[0mGET /api/nisab-year-records/cmldqn7dg000f0guzpckj6dze/assets/refresh [33m400[0m 2.716 ms - 96[0m
[0mPOST /api/auth/register [32m201[0m 338.614 ms - -[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should create user audit log entry
Database cleaned in beforeEach

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for UNLOCKED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for UNLOCKED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/register [32m201[0m 344.020 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 331.499 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 326.752 ms - -[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should handle registration rate limiting
Database cleaned in beforeEach

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn6yp000d0gu4jkgbsqno 

[0mPOST /api/auth/login [32m200[0m 437.632 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 604.632 ms - -[0m
[0mGET /api/nisab-year-records/cmldqn84h000k0guzzaiw2hqy/assets/refresh [33m400[0m 4.224 ms - 96[0m
[0mPOST /api/auth/register [32m201[0m 1498.070 ms - -[0m
[0mPOST /api/assets [32m201[0m 385.581 ms - 495[0m
[0mPOST /api/assets [32m201[0m 146.346 ms - 515[0m
[0mPOST /api/assets [32m201[0m 230.472 ms - 495[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[HawlTrackingService] INFO: Created DRAFT record for user cmldqn7kn000m0gu445gzoiub, wealth: 8000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

[0mPOST /api/auth/register [32m201[0m 357.151 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 428.041 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn7kn000m0gu445gzoiub 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn7kn000m0gu445gzoiub 

[0mPOST /api/auth/login [32m200[0m 333.388 ms - -[0m
[0mGET /api/nisab-year-records/clxxxxxxxxxxxxxxxxxxxxxxxx/assets/refresh [33m404[0m 6.944 ms - 66[0m
[0mPOST /api/auth/register [32m201[0m 349.754 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/register [32m201[0m 363.659 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn7kn000m0gu445gzoiub 

[0mPOST /api/auth/register [32m201[0m 331.946 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 330.775 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 327.265 ms - -[0m
[0mPOST /api/assets [32m201[0m 9.519 ms - 499[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[HawlTrackingService] INFO: Created DRAFT record for user cmldqn9gi000z0gu4ghtgdzpq, wealth: 10000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 322.316 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 342.984 ms - -[0m
[0mPOST /api/auth/register [33m429[0m 0.335 ms - 140[0m
 âœ“ ../tests/contract/auth-register.test.ts (11 tests) 7095ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should register user with valid data and return standardized response  416ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should handle duplicate email registration  348ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should normalize email to lowercase  341ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should validate optional fields when provided  344ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should create user audit log entry  331ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should handle registration rate limiting  2980ms
[0mPOST /api/auth/register [32m201[0m 335.666 ms - -[0m
stdout | ../tests/contract/assets-delete.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9eda12cfd1489bbd.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9eda12cfd1489bbd.db

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqn9gi000z0gu4ghtgdzpq 

[0mPOST /api/auth/register [32m201[0m 336.530 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 348.576 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[HawlTrackingService] INFO: Nisab detection complete: 0 DRAFT records created 

[0mPOST /api/auth/login [32m200[0m 326.306 ms - -[0m
[0mGET /api/nisab-year-records/cmldqnah2000v0guztav2emvg/assets/refresh [33m403[0m 2.281 ms - 101[0m
[0mPOST /api/auth/register [32m201[0m 343.918 ms - -[0m
stdout | ../tests/contract/assets-delete.test.ts > Contract Test: DELETE /api/assets/:id
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 335.217 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 337.725 ms - -[0m
[0mPOST /api/assets [32m201[0m 8.447 ms - 504[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with assets below Nisab
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with assets below Nisab
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with assets below Nisab
[HawlTrackingService] INFO: Nisab detection complete: 0 DRAFT records created 

[0mPOST /api/auth/login [32m200[0m 337.349 ms - -[0m
[0mPOST /api/assets [32m201[0m 12.449 ms - 498[0m
[0mPOST /api/assets [32m201[0m 19.908 ms - 500[0m
[0mGET /api/nisab-year-records/cmldqnb1700140guz1jn1j72w/assets/refresh [32m200[0m 6.260 ms - 263[0m
[0mPOST /api/auth/register [32m201[0m 361.233 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 336.600 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqnalb001d0gu4ksw2no7a 

[0mPOST /api/auth/login [32m200[0m 333.988 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 9.679 ms - 505[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[HawlTrackingService] INFO: Created DRAFT record for user cmldqnb5n001k0gu49p3zitp0, wealth: 10000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqnaqe000w0guzvfzrxa2f 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqnaqe000w0guzvfzrxa2f 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 388.503 ms - -[0m
stdout | ../tests/contract/assets-delete.test.ts > Contract Test: DELETE /api/assets/:id
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/assets [32m201[0m 92.142 ms - 495[0m
[0mPOST /api/assets [32m201[0m 10.976 ms - 505[0m
[0mPOST /api/assets [32m201[0m 11.428 ms - 503[0m
[0mPOST /api/assets [32m201[0m 9.655 ms - 495[0m
[0mGET /api/nisab-year-records/cmldqnbqm001h0guzq1rwn562/assets/refresh [32m200[0m 8.369 ms - 638[0m
[0mPOST /api/auth/register [32m201[0m 343.548 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqnb5n001k0gu49p3zitp0 

[0mPOST /api/auth/register [32m201[0m 369.974 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 327.440 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 324.453 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 10.679 ms - 496[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[HawlTrackingService] INFO: Created DRAFT record for user cmldqnbri001t0gu4bakz8hs0, wealth: 10000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[HawlTrackingService] INFO: Nisab detection complete: 0 DRAFT records created 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqnbba00150guzir79qzdm 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqnbba00150guzir79qzdm 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqnbba00150guzir79qzdm 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqnbba00150guzir79qzdm 

[0mPOST /api/auth/login [32m200[0m 322.383 ms - -[0m
[0mPOST /api/assets [32m201[0m 14.904 ms - 524[0m
[0mDELETE /api/assets/cmldqnc9n00040gwuewmdolk5 [33m401[0m 0.717 ms - 94[0m
[0mPOST /api/assets [32m201[0m 9.198 ms - 530[0m
[0mDELETE /api/assets/cmldqncaa00060gwurkkjm8fx [32m200[0m 9.644 ms - 811[0m
[0mDELETE /api/assets/12345678-1234-4123-a123-123456789012 [33m404[0m 3.249 ms - 150[0m
[0mDELETE /api/assets/cmldqnc9n00040gwuewmdolk5 [33m403[0m 0.327 ms - 89[0m
[0mDELETE /api/assets/invalid-uuid [33m400[0m 0.823 ms - 237[0m
[0mPOST /api/assets [32m201[0m 8.452 ms - 537[0m
[0mDELETE /api/assets/cmldqncbn00080gwuj4lwembb [32m200[0m 7.403 ms - 818[0m
[0mGET /api/assets/cmldqncbn00080gwuj4lwembb [33m404[0m 1.836 ms - 150[0m
[0mPOST /api/assets [32m201[0m 10.710 ms - 530[0m
[0mPOST /api/auth/register [32m201[0m 349.068 ms - -[0m
[0mDELETE /api/assets/cmldqnccb000a0gwu1pe658vw [32m200[0m 10.983 ms - 811[0m
[0mPOST /api/assets [32m201[0m 9.056 ms - 529[0m
[0mDELETE /api/assets/cmldqncd4000c0gwuneix4nr4 [32m200[0m 7.142 ms - 810[0m
[0mPOST /api/assets [32m201[0m 9.811 ms - 530[0m
[0mDELETE /api/assets/cmldqncdp000e0gwuecbehquc?force=true [32m200[0m 8.885 ms - 765[0m
[0mPOST /api/assets [32m201[0m 7.892 ms - 532[0m
[0mDELETE /api/assets/cmldqncee000g0gwulm0qgkhn [32m200[0m 6.851 ms - 813[0m
[0mPOST /api/assets [32m201[0m 10.266 ms - 535[0m
[0mDELETE /api/assets/cmldqncez000i0gwu13s4wma3 [32m200[0m 10.063 ms - 816[0m
[0mDELETE /api/assets/cmldqncez000i0gwu13s4wma3 [33m404[0m 11.470 ms - 150[0m
 âœ“ ../tests/contract/assets-delete.test.ts (12 tests | 1 skipped) 2839ms
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqnbri001t0gu4bakz8hs0 

stdout | ../tests/contract/auth-login.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-dea5b2dc4bac0ee9.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-dea5b2dc4bac0ee9.db

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 340.399 ms - -[0m
[0mPOST /api/assets [32m201[0m 8.174 ms - 505[0m
[0mPOST /api/assets [32m201[0m 7.992 ms - 501[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[HawlTrackingService] INFO: Created DRAFT record for user cmldqncc100220gu4vlpotsta, wealth: 7000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

[0mPOST /api/auth/register [32m201[0m 327.449 ms - -[0m
stdout | ../tests/contract/auth-login.test.ts > Contract Test: POST /api/auth/login
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqncc100220gu4vlpotsta 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqncc100220gu4vlpotsta 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 352.561 ms - -[0m
[0mPOST /api/assets [32m201[0m 10.071 ms - 502[0m
[0mPOST /api/assets [32m201[0m 10.079 ms - 503[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[HawlTrackingService] INFO: Created DRAFT record for user cmldqncwu002d0gu4vxjg1dga, wealth: 7000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

[0mPOST /api/auth/register [32m201[0m 309.582 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqncwu002d0gu4vxjg1dga 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldqncwu002d0gu4vxjg1dga 

[0mPOST /api/auth/login [32m200[0m 322.402 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 8.649 ms - 502[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[HawlTrackingService] INFO: Created DRAFT record for user cmldqndkb002o0gu4s9ke6i0y, wealth: 10000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

 âœ“ tests/integration/hawlDetectionAssets.test.ts (11 tests) 10154ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create DRAFT record with assetBreakdown populated when Nisab achieved  864ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot  792ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot  2435ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field  757ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets  720ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with assets below Nisab  731ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection  783ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved  741ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value  771ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date  859ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure  697ms
stdout | ../tests/contract/auth-login.test.ts > Contract Test: POST /api/auth/login
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/calendar.contract.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-97c8125080767f79.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-97c8125080767f79.db

[0mPOST /api/auth/register [32m201[0m 373.072 ms - -[0m
stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 333.140 ms - -[0m
[0mPOST /api/auth/login [33m401[0m 2.028 ms - 103[0m
[0mPOST /api/auth/login [33m400[0m 1.270 ms - 198[0m
[0mPOST /api/auth/login [33m400[0m 0.896 ms - 155[0m
[0mPOST /api/auth/login [33m400[0m 0.896 ms - 186[0m
[0mPOST /api/auth/login [33m401[0m 1.911 ms - 103[0m
 âœ“ ../tests/contract/auth-login.test.ts (5 tests) 2554ms
   âœ“ Contract Test: POST /api/auth/login > POST /api/auth/login > should accept valid login credentials and return standardized response  743ms
stdout | ../tests/contract/methodology-config.contract.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b2c7aa4a5a54f0c0.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b2c7aa4a5a54f0c0.db

stdout | ../tests/contract/methodology-config.contract.test.ts > Methodology Configuration Contract Tests
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 325.318 ms - -[0m
[0mPOST /api/calendar/convert [32m200[0m 3.087 ms - 210[0m
[0mPOST /api/calendar/convert [32m200[0m 1.375 ms - 210[0m
[0mPOST /api/calendar/convert [33m400[0m 0.852 ms - 111[0m
[0mPOST /api/calendar/convert [33m400[0m 4.702 ms - 93[0m
[0mPOST /api/calendar/convert [33m400[0m 1.224 ms - 114[0m
[0mPOST /api/calendar/convert [33m401[0m 0.512 ms - 94[0m
[0mPOST /api/calendar/zakat-year [32m200[0m 1.274 ms - 284[0m
[0mPOST /api/calendar/zakat-year [32m200[0m 1.304 ms - 150[0m
[0mPOST /api/calendar/zakat-year [33m400[0m 1.054 ms - 107[0m
[0mPOST /api/calendar/zakat-year [33m400[0m 0.960 ms - 101[0m
[0mPOST /api/calendar/zakat-year [33m401[0m 0.527 ms - 94[0m
[0mGET /api/calendar/preference [32m200[0m 5.226 ms - 43[0m
[0mGET /api/calendar/preference [33m401[0m 0.448 ms - 94[0m
stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests > PUT /api/calendar/preference > should update calendar preference to HIJRI
Update Calendar/Methodology Request: {
  userId: [32m'cmldqnftz00000gyhomi8o21j'[39m,
  body: { preferredCalendar: [32m'HIJRI'[39m }
}

[0mPUT /api/calendar/preference [32m200[0m 7.378 ms - 98[0m
[0mGET /api/calendar/preference [32m200[0m 2.246 ms - 39[0m
stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests > PUT /api/calendar/preference > should update calendar preference to GREGORIAN
Update Calendar/Methodology Request: {
  userId: [32m'cmldqnftz00000gyhomi8o21j'[39m,
  body: { preferredCalendar: [32m'GREGORIAN'[39m }
}

[0mPUT /api/calendar/preference [32m200[0m 11.142 ms - 102[0m
[0mPUT /api/calendar/preference [33m400[0m 1.125 ms - 101[0m
stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests > PUT /api/calendar/preference > should reject invalid calendar preference
Update Calendar/Methodology Request: {
  userId: [32m'cmldqnftz00000gyhomi8o21j'[39m,
  body: { preferredCalendar: [32m'INVALID'[39m }
}

[0mPUT /api/calendar/preference [33m400[0m 1.013 ms - 146[0m
stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests > PUT /api/calendar/preference > should reject missing calendarPreference
Update Calendar/Methodology Request: { userId: [32m'cmldqnftz00000gyhomi8o21j'[39m, body: {} }

[0mPUT /api/calendar/preference [33m401[0m 1.525 ms - 94[0m
[0mPOST /api/auth/login [31m500[0m 5423.005 ms - 96[0m
stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

 âœ“ ../tests/contract/calendar.contract.test.ts (18 tests) 2641ms
stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | ../tests/contract/methodology-config.contract.test.ts > Methodology Configuration Contract Tests
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/performance-testing.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9b77aa3e3978f6ed.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9b77aa3e3978f6ed.db

[0mPOST /api/auth/register [32m201[0m 353.688 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 381.374 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 307.095 ms - -[0m
[0mGET /api/nisab-year-records/some-id/assets/refresh [33m401[0m 0.362 ms - 94[0m
 â¯ tests/integration/assetRefresh.test.ts (9 tests | 1 failed) 13745ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return current assets for DRAFT record  844ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record  726ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for UNLOCKED record  1940ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 404 for non-existent record  722ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 403 when accessing another user's record  1353ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should handle assets deleted after record creation  751ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets  903ms
   Ã— Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly 5788ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should require authentication  709ms
[0mPOST /api/auth/login [32m200[0m 310.154 ms - -[0m
[0mGET /api/methodologies [32m200[0m 6.969 ms - -[0m
[0mGET /api/methodologies [33m401[0m 0.630 ms - 94[0m
[0mGET /api/methodologies/STANDARD [32m200[0m 1.750 ms - -[0m
[0mGET /api/methodologies/UNKNOWN [33m404[0m 2.443 ms - 87[0m
[0mPUT /api/methodologies/STANDARD [33m400[0m 2.678 ms - 94[0m
[0mGET /api/methodologies/UNKNOWN [33m404[0m 1.951 ms - 87[0m
[0mPOST /api/methodologies/custom [32m201[0m 9.706 ms - 178[0m
[0mPUT /api/methodologies/cmldqngwk00040gztwudpcf8s [32m200[0m 9.191 ms - 180[0m
[0mPUT /api/methodologies/STANDARD [33m400[0m 1.805 ms - 172[0m
[0mPUT /api/methodologies/INVALID_ID [33m404[0m 2.412 ms - 97[0m
[0mPOST /api/methodologies/custom [32m201[0m 7.559 ms - 235[0m
[0mPOST /api/methodologies/custom [33m400[0m 1.079 ms - 287[0m
[0mPOST /api/methodologies/custom [32m201[0m 9.584 ms - 178[0m
[0mDELETE /api/methodologies/cmldqngy100080gzt5zkb1xl5 [32m200[0m 6.751 ms - 68[0m
[0mGET /api/methodologies/cmldqngy100080gzt5zkb1xl5 [33m404[0m 2.038 ms - 105[0m
[0mDELETE /api/methodologies/STANDARD [33m400[0m 1.053 ms - 94[0m
 âœ“ ../tests/contract/methodology-config.contract.test.ts (13 tests) 2652ms
stdout | src/__tests__/integration/assets.eligibility.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-121305e686fc33ce.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-121305e686fc33ce.db

stdout | src/__tests__/authController.isVerified.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-16a7aa6d238ab99d.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-16a7aa6d238ab99d.db

stdout | src/__tests__/integration/assets.eligibility.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 âœ“ src/__tests__/performance-testing.test.ts (22 tests) 1409ms
   âœ“ Performance Testing and Optimization - T155 > API Performance > should validate API response times  514ms
stdout | src/__tests__/authController.isVerified.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/integration/assets.api.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8057a814072d78ca.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8057a814072d78ca.db

stdout | src/__tests__/integration/assets.api.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/integration/assets.eligibility.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/authController.isVerified.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 387.280 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 379.711 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 322.215 ms - -[0m
[0mPOST /api/assets [32m201[0m 21.032 ms - 505[0m
[0mGET /api/assets [32m200[0m 6.099 ms - 693[0m
[0mPUT /api/assets/cmldqnja600040g15gcev8nsk [32m200[0m 11.548 ms - 506[0m
[0mGET /api/assets [32m200[0m 3.252 ms - 691[0m
 âœ“ src/__tests__/integration/assets.eligibility.test.ts (1 test) 817ms
   âœ“ Integration: Asset eligibility and passive modifier > creates a passive asset, then disables eligibility and verifies summary excludes it  815ms
stdout | src/__tests__/integration/assets.api.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 358.180 ms - -[0m
[0mGET /api/auth/me [32m200[0m 4.453 ms - 554[0m
[0mPOST /api/auth/login [33m401[0m 1.963 ms - 103[0m
stdout | src/__tests__/authController.isVerified.test.ts > AuthController isVerified Response > Admin verification flow > should update isVerified status when admin verifies user
Skipping admin test - no admin user available

 âœ“ src/__tests__/authController.isVerified.test.ts (4 tests) 803ms
   âœ“ AuthController isVerified Response > POST /auth/register > should return isVerified field in response  407ms
   âœ“ AuthController isVerified Response > POST /auth/login > should return isVerified field in response  369ms
stdout | src/__tests__/integration/analytics-api.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-323ee4682431d9c7.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-323ee4682431d9c7.db

[0mPOST /api/auth/register [32m201[0m 395.249 ms - -[0m
stdout | tests/integration/hawlDetectionJob.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-05a117f400ff7805.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-05a117f400ff7805.db

stdout | tests/integration/hawlDetectionJob.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 341.644 ms - -[0m
[0mPOST /api/assets [32m201[0m 15.355 ms - 513[0m
 âœ“ src/__tests__/integration/assets.api.test.ts (1 test) 795ms
   âœ“ Integration: Auth and Assets API > should register, login, and create an asset successfully  792ms
stdout | src/__tests__/integration/analytics-api.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.unlock.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-98928d5cb733ec33.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-98928d5cb733ec33.db

stdout | tests/contract/nisabYearRecords.unlock.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/integration/analytics-api.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionJob.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionJob.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 391.485 ms - -[0m
[0mGET /api/analytics/summary [32m200[0m 39.362 ms - 841[0m
[0mGET /api/analytics/summary?year=2024 [32m200[0m 24.695 ms - 841[0m
[0mGET /api/analytics/summary?includeTrends=true [32m200[0m 27.244 ms - -[0m
[0mGET /api/analytics/metrics [32m200[0m 45.478 ms - -[0m
[0mGET /api/analytics/metrics?metricTypes=wealth_trend,zakat_trend [32m200[0m 22.550 ms - 763[0m
[0mGET /api/analytics/trends [32m200[0m 22.680 ms - 780[0m
[0mGET /api/analytics/trends?period=6months [32m200[0m 29.463 ms - 779[0m
[0mGET /api/analytics/comparison [32m200[0m 18.220 ms - 421[0m
[0mPOST /api/auth/register [32m201[0m 397.868 ms - -[0m
[0mGET /api/analytics/comparison?period1=2025&period2=2026 [32m200[0m 14.508 ms - 416[0m
[0mPOST /api/analytics/cache/clear [32m200[0m 12.385 ms - 65[0m
 âœ“ src/__tests__/integration/analytics-api.test.ts (10 tests) 721ms
[0mPOST /api/assets [32m201[0m 16.580 ms - 496[0m
stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should reconcile wealth drift in DRAFT records
[hawlDetectionJob] INFO: Starting Hawl detection & reconciliation job 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should reconcile wealth drift in DRAFT records
[hawlDetectionJob] INFO: Processing 1 users 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should reconcile wealth drift in DRAFT records
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should reconcile wealth drift in DRAFT records
[AuditTrailService] INFO: Audit event recorded: NISAB_ACHIEVED for record cmldqnlvx00060g4058wl7d4l 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should reconcile wealth drift in DRAFT records
[hawlDetectionJob] INFO: SAFETY NET: Started missed Hawl for user cmldqnlto00000g40akx5xpgb 
[hawlDetectionJob] INFO: Hawl detection job complete: 1 users, 1 reconciled, 1 achievements, 0 interruptions, 0 completions, 0 errors, 39ms 

stdout | tests/contract/nisabYearRecords.unlock.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/assets [32m201[0m 10.292 ms - 495[0m
stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should detect missed Nisab achievement (Safety Net)
[hawlDetectionJob] INFO: Starting Hawl detection & reconciliation job 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should detect missed Nisab achievement (Safety Net)
[hawlDetectionJob] INFO: Processing 1 users 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should detect missed Nisab achievement (Safety Net)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should detect missed Nisab achievement (Safety Net)
[hawlDetectionJob] INFO: SAFETY NET: Detected missed Nisab achievement for user cmldqnlto00000g40akx5xpgb 
[hawlDetectionJob] INFO: Hawl detection job complete: 1 users, 0 reconciled, 1 achievements, 0 interruptions, 0 completions, 0 errors, 10ms 

 âœ“ tests/integration/hawlDetectionJob.test.ts (2 tests) 564ms
stdout | tests/contract/nisabYearRecords.unlock.test.ts
JWT_SECRET (jwt.ts): supersecret

stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Successful Unlock > should unlock FINALIZED record with valid reason
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqnm0l00020g4z8hfuv3pd 

stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Successful Unlock > should unlock FINALIZED record with valid reason
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqnm0l00020g4z8hfuv3pd with reason: Need to correct tota... 

[0mPOST /api/nisab-year-records/cmldqnm0l00020g4z8hfuv3pd/unlock [32m200[0m 43.618 ms - -[0m
stdout | tests/performance/wealthAggregation.performance.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b2500065df3bee37.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b2500065df3bee37.db

stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Successful Unlock > should create audit trail entry with unlock reason
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqnm3200060g4zu58tifft 

stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Successful Unlock > should create audit trail entry with unlock reason
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqnm3200060g4zu58tifft with reason: Discovered uncounted... 

[0mPOST /api/nisab-year-records/cmldqnm3200060g4zu58tifft/unlock [32m200[0m 30.413 ms - -[0m
[0mPOST /api/nisab-year-records/cmldqnm4l000a0g4zj0b56695/unlock [33m400[0m 1.184 ms - 81[0m
[0mPOST /api/nisab-year-records/cmldqnm5d000c0g4zcmzngh6k/unlock [33m400[0m 1.099 ms - 100[0m
[0mPOST /api/nisab-year-records/cmldqnm63000e0g4zwherk530/unlock [33m409[0m 4.666 ms - 90[0m
stdout | tests/contract/nisabYearRecords.get.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b54f1797a022344f.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b54f1797a022344f.db

[0mPOST /api/nisab-year-records/cmldqnm6w000g0g4z9hqrfh7n/unlock [33m409[0m 4.204 ms - 93[0m
[0mPOST /api/nisab-year-records/00000000-0000-0000-0000-000000000000/unlock [33m404[0m 3.219 ms - 66[0m
[0mPOST /api/nisab-year-records/some-id/unlock [33m401[0m 0.535 ms - 94[0m
stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should calculate wealth for 500 assets in < 100ms

âœ“ Wealth calculation: 10ms for 500 assets

[0mPOST /api/nisab-year-records/cmldqnm7t000i0g4zg37mybcg/unlock [33m404[0m 3.325 ms - 66[0m
stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Response Schema Validation > should return correct response structure
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldqnm90000l0g4zhqhrwji2 

stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Response Schema Validation > should return correct response structure
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldqnm90000l0g4zhqhrwji2 with reason: Correction needed fo... 

[0mPOST /api/nisab-year-records/cmldqnm90000l0g4zhqhrwji2/unlock [32m200[0m 17.500 ms - -[0m
stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should maintain consistent performance across 10 runs

âœ“ Average: 7.70ms
  Min: 5ms, Max: 13ms

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should handle incremental load (50, 100, 250, 500 assets)

ðŸ“Š Performance scaling:

 âœ“ tests/contract/nisabYearRecords.unlock.test.ts (10 tests) 391ms
stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should handle incremental load (50, 100, 250, 500 assets)
  50 assets: 2ms (target: <50ms)

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should handle incremental load (50, 100, 250, 500 assets)
  100 assets: 3ms (target: <75ms)

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should handle incremental load (50, 100, 250, 500 assets)
  250 assets: 5ms (target: <90ms)

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should handle incremental load (50, 100, 250, 500 assets)
  500 assets: 6ms (target: <100ms)

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should efficiently query with userId + isActive index

âœ“ Indexed query: 6ms (excellent performance)

 âœ“ tests/performance/wealthAggregation.performance.test.ts (4 tests) 445ms
stdout | tests/contract/nisabYearRecords.finalize.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b1cae29c827201f9.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b1cae29c827201f9.db

stdout | tests/contract/nisabYearRecords.delete.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6f6d04a037235f6f.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6f6d04a037235f6f.db

stdout | tests/contract/nisabYearRecords.get.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.finalize.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.delete.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.get.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.get.test.ts
JWT_SECRET (jwt.ts): supersecret

[0mGET /api/nisab-year-records [32m200[0m 14.838 ms - 86[0m
[0mGET /api/nisab-year-records [32m200[0m 7.656 ms - -[0m
[0mGET /api/nisab-year-records?status=DRAFT [32m200[0m 5.426 ms - -[0m
[0mGET /api/nisab-year-records?status=FINALIZED [32m200[0m 10.457 ms - -[0m
[0mGET /api/nisab-year-records?year=2025 [32m200[0m 3.844 ms - -[0m
[0mGET /api/nisab-year-records?status=ALL [32m200[0m 3.467 ms - -[0m
[0mGET /api/nisab-year-records [33m401[0m 0.516 ms - 94[0m
[0mGET /api/nisab-year-records [33m401[0m 0.813 ms - 91[0m
stdout | tests/contract/nisabYearRecords.finalize.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mGET /api/nisab-year-records [32m200[0m 3.238 ms - 86[0m
[0mGET /api/nisab-year-records/cmldqno8g000f0g6c1tsjfoau [32m200[0m 16.642 ms - -[0m
stdout | tests/contract/nisabYearRecords.finalize.test.ts
JWT_SECRET (jwt.ts): supersecret

 âœ“ tests/contract/nisabYearRecords.get.test.ts (10 tests) 309ms
stdout | tests/contract/nisabYearRecords.finalize.test.ts > POST /api/nisab-year-records/:id/finalize - Contract Tests > Successful Finalization > should finalize DRAFT record when Hawl is complete
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqnoaq00020g75nym6tib5 

stdout | tests/contract/nisabYearRecords.finalize.test.ts > POST /api/nisab-year-records/:id/finalize - Contract Tests > Successful Finalization > should finalize DRAFT record when Hawl is complete
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqnoaq00020g75nym6tib5 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqnoaq00020g75nym6tib5/finalize [32m200[0m 49.253 ms - -[0m
[0mPOST /api/nisab-year-records/cmldqnodd00060g75s28v9y9w/finalize [33m409[0m 9.607 ms - 115[0m
stdout | tests/contract/nisabYearRecords.finalize.test.ts > POST /api/nisab-year-records/:id/finalize - Contract Tests > Successful Finalization > should allow finalization with override flag even when Hawl early
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldqnodd00060g75s28v9y9w 

stdout | tests/contract/nisabYearRecords.finalize.test.ts > POST /api/nisab-year-records/:id/finalize - Contract Tests > Successful Finalization > should allow finalization with override flag even when Hawl early
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldqnodd00060g75s28v9y9w with Zakat 0 

[0mPOST /api/nisab-year-records/cmldqnodd00060g75s28v9y9w/finalize [32m200[0m 27.827 ms - -[0m
[0mPOST /api/nisab-year-records/cmldqnofa000a0g75olgyiepq/finalize [33m409[0m 3.718 ms - 115[0m
stdout | tests/contract/nisabYearRecords.delete.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/nisab-year-records/cmldqnofv000c0g75j945nrow/finalize [33m409[0m 4.374 ms - 115[0m
[0mPOST /api/nisab-year-records/cmldqnogp000e0g75j1tnclkc/finalize [33m409[0m 3.178 ms - 96[0m
[0mPOST /api/nisab-year-records/00000000-0000-0000-0000-000000000000/finalize [33m404[0m 2.741 ms - 66[0m
[0mPOST /api/nisab-year-records/some-id/finalize [33m401[0m 0.425 ms - 94[0m
 âœ“ tests/contract/nisabYearRecords.finalize.test.ts (7 tests) 286ms
stdout | tests/contract/nisabYearRecords.delete.test.ts
JWT_SECRET (jwt.ts): supersecret

stdout | ../tests/unit/JWTService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2a83063bbf778ce7.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2a83063bbf778ce7.db

stdout | tests/contract/nisabYearRecords.delete.test.ts > DELETE /api/nisab-year-records/:id - Contract Tests > Successful Deletion > should delete DRAFT record
[NisabYearRecordService] INFO: Nisab Year Record deleted: cmldqnojc00020g7w6mpbguxw 

[0mDELETE /api/nisab-year-records/cmldqnojc00020g7w6mpbguxw [32m200[0m 20.168 ms - 56[0m
 âœ“ ../tests/unit/JWTService.test.ts (25 tests) 41ms
stdout | tests/contract/nisabYearRecords.delete.test.ts > DELETE /api/nisab-year-records/:id - Contract Tests > Successful Deletion > should allow delete of UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record deleted: cmldqnokt00040g7w5mzvwdlj 

[0mDELETE /api/nisab-year-records/cmldqnokt00040g7w5mzvwdlj [32m200[0m 12.456 ms - 56[0m
[0mDELETE /api/nisab-year-records/cmldqnolo00060g7wdjomgffa [33m409[0m 9.575 ms - 137[0m
[0mDELETE /api/nisab-year-records/cmldqnoms00080g7wwbnjfl5h [33m409[0m 2.441 ms - 137[0m
[0mDELETE /api/nisab-year-records/00000000-0000-0000-0000-000000000000 [33m404[0m 3.310 ms - 66[0m
[0mDELETE /api/nisab-year-records/some-id [33m401[0m 0.377 ms - 94[0m
[0mDELETE /api/nisab-year-records/cmldqnonv000a0g7wk0rdgxps [33m404[0m 2.802 ms - 66[0m
 âœ“ tests/contract/nisabYearRecords.delete.test.ts (7 tests) 235ms
stdout | src/__tests__/calculation-history-basic.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-32631353be7ae0c6.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-32631353be7ae0c6.db

 âœ“ src/__tests__/calculation-history-basic.test.ts (3 tests) 41ms
stdout | src/services/__tests__/AssetService.categoryNormalization.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-90bde4f0102c98b2.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-90bde4f0102c98b2.db

stdout | src/__tests__/unit/AnalyticsService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-e6df7a2526435618.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-e6df7a2526435618.db

stdout | src/services/__tests__/AssetService.categoryNormalization.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/unit/ValidationMiddleware.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-868a0321d3a2b55e.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-868a0321d3a2b55e.db

 âœ“ src/services/__tests__/AssetService.categoryNormalization.test.ts (2 tests) 21ms
 âœ“ src/__tests__/unit/AnalyticsService.test.ts (26 tests) 32ms
 âœ“ ../tests/unit/ValidationMiddleware.test.ts (20 tests) 35ms
stdout | src/__tests__/calculation-history.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-82017ccd9e49816a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-82017ccd9e49816a.db

stdout | tests/unit/services/auditTrailService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-cca7cacd9fff9b62.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-cca7cacd9fff9b62.db

stdout | tests/unit/services/auditTrailService.test.ts > AuditTrailService > recordEvent > should record CREATED event for new Nisab Year Record
[AuditTrailService] INFO: Audit event recorded: CREATED for record record1 

 âœ“ src/__tests__/calculation-history.test.ts (31 tests) 23ms
 âœ“ tests/unit/services/auditTrailService.test.ts (4 tests) 24ms
stdout | src/__tests__/unit/ReminderService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-03ed305d7a08caa8.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-03ed305d7a08caa8.db

 âœ“ src/__tests__/unit/ReminderService.test.ts (32 tests) 24ms
stdout | src/__tests__/methodology-documentation.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c5998337e8419f8f.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c5998337e8419f8f.db

stdout | src/__tests__/unit/AnnualSummaryService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-976207c501522f4a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-976207c501522f4a.db

stdout | src/__tests__/methodology-documentation.test.ts > User Documentation for Methodologies - T156 > Documentation Structure and Content > should have comprehensive methodology guide documentation
CWD: /home/chuwi_agent/workspace/zakapp/server
Docs Path: /home/chuwi_agent/workspace/zakapp/client/public/docs/methodology-guide.md
Exists: [33mtrue[39m

stdout | src/__tests__/methodology-documentation.test.ts > User Documentation for Methodologies - T156 > Documentation Validation Summary > should meet all T156 requirements
âœ… T156 Requirement: methodologyExplanations - Met
âœ… T156 Requirement: selectionGuidance - Met
âœ… T156 Requirement: comparisonCharts - Met
âœ… T156 Requirement: practicalExamples - Met
âœ… T156 Requirement: comprehensiveContent - Met
âœ… T156 Requirement: userFriendly - Met
âœ… T156 Requirement: accurate - Met
âœ… T156 Requirement: completeGuide - Met
ðŸŽ¯ T156 Completion Rate: 100%

 âœ“ src/__tests__/methodology-documentation.test.ts (23 tests) 17ms
 âœ“ src/__tests__/unit/AnnualSummaryService.test.ts (23 tests) 28ms
stdout | src/__tests__/methodology-selection-guide.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-748f6c31bbe687dc.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-748f6c31bbe687dc.db

stdout | src/__tests__/methodology-selection-guide.test.ts > T158: Methodology Selection Guide > Summary and Validation > should meet all T158 requirements
âœ… T158 Requirement: decisionTree - Met
âœ… T158 Requirement: regionalRecommendations - Met
âœ… T158 Requirement: assetConsiderations - Met
âœ… T158 Requirement: quiz - Met
âœ… T158 Requirement: additionalResources - Met
âœ… T158 Requirement: clearAndHelpful - Met
âœ… T158 Requirement: logicalProcess - Met
âœ… T158 Requirement: beginnerAccessible - Met
âœ… T158 Requirement: scholarConsultation - Met

stdout | src/__tests__/methodology-selection-guide.test.ts > T158: Methodology Selection Guide

ðŸŽ¯ T158 Completion Summary:
ðŸ“„ Guide Length: 3891 words
ðŸ“‹ Major Sections: 14
âœ… Decision Tree: Included
ðŸŒ Regional Recommendations: 7 regions covered
ðŸ’¼ Asset Type Guidance: 5 categories covered
â“ Interactive Quiz: 5 questions with profile matching
ðŸŽ“ Educational Content: Comprehensive methodology explanations
ðŸ“š Additional Resources: Scholar consultation and tools
ðŸ”° Beginner Friendly: Clear language and step-by-step guidance
ðŸ‘¨â€ðŸ« Scholar Consultation: Encouraged throughout guide

ðŸ† T158 Status: COMPLETE - Comprehensive methodology selection guide created

 âœ“ src/__tests__/methodology-selection-guide.test.ts (25 tests) 25ms
stdout | src/__tests__/unit/CalendarConversionService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-0df92f9ba2a884ba.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-0df92f9ba2a884ba.db

stdout | src/__tests__/SyncService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9e5a9e38acdaed55.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9e5a9e38acdaed55.db

stdout | src/__tests__/utils/schemaCheck.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-bcce8a528aa96ed6.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-bcce8a528aa96ed6.db

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Ensuring CouchDB user: user_test_user 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Ensure CouchDB user: user_test_user (Synced Credentials) 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Creating database: zakapp_test_user_assets 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Created database: zakapp_test_user_assets 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Creating database: zakapp_test_user_liabilities 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Created database: zakapp_test_user_liabilities 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Creating database: zakapp_test_user_nisab_year_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Created database: zakapp_test_user_nisab_year_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Creating database: zakapp_test_user_payment_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Created database: zakapp_test_user_payment_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Creating database: zakapp_test_user_user_settings 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Created database: zakapp_test_user_user_settings 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should handle existing user by updating with revision
[SyncService] INFO: Ensuring CouchDB user: user_test_user 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should handle existing user by updating with revision
[SyncService] INFO: CouchDB user exists: user_test_user (rev: 1-old) 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should handle existing user by updating with revision
[SyncService] INFO: Ensure CouchDB user: user_test_user (Synced Credentials) 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should delete all user databases and the user document
[SyncService] INFO: Deleting CouchDB user and data for: user_test_user 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Deleting CouchDB user and data for: user_test_user 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Database already gone: zakapp_test_user_assets 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Database already gone: zakapp_test_user_liabilities 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Database already gone: zakapp_test_user_nisab_year_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Database already gone: zakapp_test_user_payment_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Database already gone: zakapp_test_user_user_settings 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: CouchDB user already gone: user_test_user 

 âœ“ src/__tests__/SyncService.test.ts (4 tests) 16ms
 âœ“ src/__tests__/utils/schemaCheck.test.ts (5 tests) 14ms
stdout | src/__tests__/unit/ComparisonService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1f0c57a4fa1b188c.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1f0c57a4fa1b188c.db

stdout | tests/unit/services/wealthAggregationService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-974bd4b215875d6d.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-974bd4b215875d6d.db

 âœ“ tests/unit/services/wealthAggregationService.test.ts (6 tests) 19ms
 âœ“ src/__tests__/unit/ComparisonService.test.ts (23 tests) 29ms
stdout | src/__tests__/unit/PaymentService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-995dc9ae95c0b4eb.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-995dc9ae95c0b4eb.db

stdout | src/services/__tests__/NisabService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ac12b9a87b5d8fda.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ac12b9a87b5d8fda.db

 âœ“ src/__tests__/unit/PaymentService.test.ts (6 tests) 13ms
stdout | tests/unit/services/nisabCalculationService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ad9f5e81aeb2e79f.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ad9f5e81aeb2e79f.db

 âœ“ src/__tests__/unit/CalendarConversionService.test.ts (20 tests) 17ms
 âœ“ src/services/__tests__/NisabService.test.ts (6 tests) 12ms
stdout | tests/unit/services/nisabCalculationService.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/unit/services/nisabCalculationService.test.ts > NisabCalculationService > calculateNisabThreshold > should use fallback prices if API fetch fails
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

 âœ“ tests/unit/services/nisabCalculationService.test.ts (4 tests) 14ms
stdout | tests/unit/services/nisabYearRecordService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-70c7a161ea03b173.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-70c7a161ea03b173.db

stdout | src/services/__tests__/AssetService.update.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-73184574147c1d4e.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-73184574147c1d4e.db

stdout | src/__tests__/integration/assets.passive.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5b92c0b9e35a9a69.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5b92c0b9e35a9a69.db

 âœ“ src/__tests__/integration/assets.passive.test.ts (5 tests) 5ms
stdout | tests/unit/services/nisabYearRecordService.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/services/__tests__/AssetService.update.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 âœ“ src/services/__tests__/AssetService.update.test.ts (2 tests) 10ms
stdout | tests/unit/services/nisabYearRecordService.test.ts > NisabYearRecordService > createRecord > should create a new DRAFT Nisab Year Record
[NisabYearRecordService] INFO: Nisab Year Record created: record1 for user user1 

 âœ“ tests/unit/services/nisabYearRecordService.test.ts (4 tests) 13ms
stdout | ../tests/unit/stableId.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6f7c49bd630d1628.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6f7c49bd630d1628.db

 âœ“ ../tests/unit/stableId.test.ts (3 tests) 7ms
stdout | src/services/__tests__/EncryptionService.decryption-tolerance.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-bc28132d8c1a9c91.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-bc28132d8c1a9c91.db

stdout | src/__tests__/utils/assetModifiers.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6565d0cfb2de62a0.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6565d0cfb2de62a0.db

 âœ“ src/services/__tests__/EncryptionService.decryption-tolerance.test.ts (3 tests) 12ms
 âœ“ src/__tests__/utils/assetModifiers.test.ts (8 tests) 15ms
stdout | src/services/__tests__/WealthAggregationService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-912f270dc28a4a47.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-912f270dc28a4a47.db

 âœ“ src/services/__tests__/WealthAggregationService.test.ts (1 test) 5ms

 Test Files  59 failed | 43 passed (102)
      Tests  149 failed | 666 passed | 34 skipped (849)
   Start at  12:46:44
   Duration  74.55s (transform 2.58s, setup 926ms, collect 79.74s, tests 106.53s, environment 26ms, prepare 9.95s)

