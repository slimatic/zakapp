
> zakapp@0.9.2 test
> npm run test:server && npm run test:client && npm run test:cli tests/contract/auth-register.test.ts --reporter=json


> zakapp@0.9.2 test:server
> cd server && npm test


> zakapp-server@0.9.2 test
> vitest run


 RUN  v3.2.4 /home/chuwi_agent/workspace/zakapp/server

[globalSetup] Preparing test database schema...
Prisma schema loaded from prisma/schema.prisma
Datasource "db": SQLite database "base.db" at "file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/base.db"

The database is already in sync with the Prisma schema.

Running generate... (Use --skip-generate to skip the generators)
[2K[1A[2K[GRunning generate... - Prisma Client
[2K[1A[2K[Gâœ” Generated Prisma Client (v6.19.2) to ./node_modules/@prisma/client in 286ms

[globalSetup] Base test database schema created.
[globalSetup] Test database schema is ready.
stdout | tests/integration/liveTracking.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6587d8b6da31390b.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6587d8b6da31390b.db

stdout | ../tests/contract/payment-records.contract.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-59d3fc16a8be3d7b.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-59d3fc16a8be3d7b.db

stdout | ../tests/contract/auth-register.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-160ac08e212cf05b.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-160ac08e212cf05b.db

stdout | ../tests/contract/payment-records.contract.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/liveTracking.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/liveTracking.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/payment-records.contract.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should register user with valid data and return standardized response
Database cleaned in beforeEach

[0mPOST /api/auth/register [32m201[0m 384.538 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 385.144 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 384.023 ms - -[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate required fields
Database cleaned in beforeEach

[0mPOST /api/assets [32m201[0m 16.518 ms - 503[0m
[0mPOST /api/auth/register [33m400[0m 2.690 ms - 243[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/register [33m400[0m 1.408 ms - 382[0m
[0mPOST /api/auth/register [33m400[0m 1.780 ms - 183[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate email format
Database cleaned in beforeEach

[0mPOST /api/auth/register [33m400[0m 1.421 ms - 197[0m
[0mPOST /api/auth/register [33m400[0m 1.124 ms - 192[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwl6f00050gdopqcithx5 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwl6f00050gdopqcithx5 for user cmldpwl4100000gdol6qex9de 

[0mPOST /api/auth/register [33m400[0m 1.811 ms - 203[0m
[0mPOST /api/nisab-year-records [32m201[0m 29.720 ms - 797[0m
[0mPOST /api/auth/register [33m400[0m 1.080 ms - 202[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate password strength requirements
Database cleaned in beforeEach

[0mGET /api/nisab-year-records/status [32m200[0m 7.755 ms - 222[0m
[0mPOST /api/auth/register [33m400[0m 1.210 ms - 312[0m
[0mPOST /api/auth/register [33m400[0m 1.524 ms - 227[0m
[0mPOST /api/auth/register [33m400[0m 2.475 ms - 227[0m
[0mPOST /api/auth/register [33m400[0m 0.911 ms - 230[0m
[0mGET /api/nisab-year-records/cmldpwl6f00050gdopqcithx5 [32m200[0m 12.550 ms - -[0m
[0mPOST /api/auth/register [33m400[0m 1.022 ms - 231[0m
[0mPOST /api/auth/register [33m400[0m 0.805 ms - 231[0m
[0mPOST /api/auth/register [33m400[0m 1.180 ms - 228[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate password confirmation match
Database cleaned in beforeEach

[0mPOST /api/auth/register [33m400[0m 1.567 ms - 206[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate name fields format
Database cleaned in beforeEach

[0mPOST /api/assets [32m201[0m 14.362 ms - 503[0m
[0mGET /api/nisab-year-records/cmldpwl6f00050gdopqcithx5 [32m200[0m 5.248 ms - -[0m
[0mPOST /api/assets [33m400[0m 0.835 ms - 191[0m
[0mPOST /api/assets [32m201[0m 12.611 ms - 506[0m
[0mGET /api/nisab-year-records/cmldpwl6f00050gdopqcithx5 [32m200[0m 3.895 ms - -[0m
[0mPOST /api/assets [32m201[0m 10.254 ms - 506[0m
[0mGET /api/nisab-year-records/cmldpwl6f00050gdopqcithx5 [32m200[0m 4.694 ms - -[0m
[0mGET /api/nisab-year-records/cmldpwl6f00050gdopqcithx5 [32m200[0m 5.791 ms - -[0m
[0mPOST /api/assets [32m201[0m 7.658 ms - 515[0m
[0mGET /api/nisab-year-records/cmldpwl6f00050gdopqcithx5 [32m200[0m 3.297 ms - -[0m
[0mPOST /api/assets [32m201[0m 119.434 ms - 497[0m
[0mPOST /api/auth/login [32m200[0m 348.129 ms - -[0m
[0mPOST /api/assets [32m201[0m 118.096 ms - 497[0m
[0mPOST /api/assets [32m201[0m 99.219 ms - 498[0m
[0mPOST /api/zakat/payments [33m400[0m 7.709 ms - 209[0m
[0mPOST /api/assets [32m201[0m 128.963 ms - 497[0m
[0mPOST /api/assets [32m201[0m 110.831 ms - 498[0m
[0mPOST /api/assets [32m201[0m 150.062 ms - 497[0m
[0mPOST /api/assets [32m201[0m 121.904 ms - 498[0m
[0mPOST /api/assets [32m201[0m 162.176 ms - 497[0m
[0mPOST /api/assets [32m201[0m 159.664 ms - 497[0m
[0mPOST /api/assets [32m201[0m 136.377 ms - 498[0m
[0mPOST /api/assets [32m201[0m 172.033 ms - 497[0m
[0mPOST /api/assets [32m201[0m 148.722 ms - 498[0m
[0mPOST /api/assets [32m201[0m 183.464 ms - 497[0m
[0mPOST /api/assets [32m201[0m 160.439 ms - 498[0m
[0mPOST /api/assets [32m201[0m 195.277 ms - 498[0m
[0mPOST /api/assets [32m201[0m 172.957 ms - 498[0m
[0mPOST /api/auth/register [32m201[0m 355.078 ms - -[0m
[0mPOST /api/assets [32m201[0m 209.230 ms - 498[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should handle duplicate email registration
Database cleaned in beforeEach

[0mPOST /api/assets [32m201[0m 184.756 ms - 498[0m
[0mPOST /api/assets [32m201[0m 218.162 ms - 498[0m
[0mPOST /api/assets [32m201[0m 197.193 ms - 498[0m
[0mPOST /api/assets [32m201[0m 229.357 ms - 498[0m
[0mPOST /api/assets [32m201[0m 204.579 ms - 498[0m
[0mPOST /api/assets [32m201[0m 237.621 ms - 498[0m
[0mPOST /api/assets [32m201[0m 214.354 ms - 498[0m
[0mPOST /api/assets [32m201[0m 247.462 ms - 498[0m
[0mPOST /api/assets [32m201[0m 223.232 ms - 498[0m
[0mPOST /api/assets [32m201[0m 260.271 ms - 498[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

[0mPOST /api/assets [32m201[0m 241.914 ms - 498[0m
[0mPOST /api/assets [32m201[0m 240.413 ms - 498[0m
[0mPOST /api/assets [32m201[0m 233.517 ms - 498[0m
[0mPOST /api/assets [32m201[0m 245.482 ms - 498[0m
[0mPOST /api/assets [32m201[0m 240.287 ms - 498[0m
[0mPOST /api/assets [32m201[0m 253.684 ms - 498[0m
[0mPOST /api/assets [32m201[0m 251.657 ms - 498[0m
[0mPOST /api/assets [32m201[0m 264.734 ms - 498[0m
[0mPOST /api/assets [32m201[0m 262.821 ms - 498[0m
[0mPOST /api/assets [32m201[0m 345.919 ms - 497[0m
[0mPOST /api/assets [32m201[0m 272.782 ms - 498[0m
[0mPOST /api/assets [32m201[0m 276.826 ms - 498[0m
[0mPOST /api/assets [32m201[0m 279.503 ms - 498[0m
[0mPOST /api/assets [32m201[0m 280.902 ms - 498[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

[0mPOST /api/assets [32m201[0m 300.855 ms - 498[0m
[0mPOST /api/assets [32m201[0m 300.716 ms - 498[0m
[0mPOST /api/assets [32m201[0m 296.397 ms - 498[0m
[0mPOST /api/assets [32m201[0m 298.621 ms - 498[0m
[0mPOST /api/assets [32m201[0m 303.799 ms - 498[0m
[0mPOST /api/assets [32m201[0m 310.579 ms - 498[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

[0mPOST /api/assets [32m201[0m 357.316 ms - 498[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 451.547 ms - 497[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/register [32m201[0m 353.927 ms - -[0m
[0mPOST /api/assets [32m201[0m 464.449 ms - 498[0m
[0mGET /api/nisab-year-records/cmldpwl6f00050gdopqcithx5 [32m200[0m 8.246 ms - -[0m
[0mGET /api/nisab-year-records/cmldpwl6f00050gdopqcithx5 [32m200[0m 5.837 ms - -[0m
[0mGET /api/nisab-year-records/cmldpwl6f00050gdopqcithx5 [32m200[0m 6.120 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 354.248 ms - -[0m
[0mPOST /api/auth/register [33m409[0m 2.626 ms - 105[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should normalize email to lowercase
Database cleaned in beforeEach

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

[0mPOST /api/auth/login [32m200[0m 338.117 ms - -[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

[0mPOST /api/zakat/payments [33m400[0m 9.837 ms - 209[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

[0mPOST /api/auth/register [32m201[0m 345.589 ms - -[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should validate optional fields when provided
Database cleaned in beforeEach

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpwl4100000gdol6qex9de 

[0mPOST /api/auth/register [32m201[0m 609.444 ms - -[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should create user audit log entry
Database cleaned in beforeEach

[0mPOST /api/auth/register [32m201[0m 593.790 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 339.273 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 3.528 ms - 162[0m
[0mPOST /api/auth/register [32m201[0m 351.272 ms - -[0m
stdout | ../tests/contract/auth-register.test.ts > Contract Test: POST /api/auth/register > POST /api/auth/register > should handle registration rate limiting
Database cleaned in beforeEach

[0mPOST /api/auth/register [32m201[0m 341.808 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 376.702 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 332.331 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 2.245 ms - 233[0m
[0mPOST /api/auth/register [32m201[0m 357.087 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 334.914 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 345.658 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 324.932 ms - -[0m
[0mPOST /api/zakat/payments [33m401[0m 0.536 ms - 94[0m
[0mPOST /api/auth/register [32m201[0m 337.783 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 342.218 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 349.197 ms - -[0m
[0mPOST /api/auth/register [33m429[0m 0.415 ms - 140[0m
 â¯ ../tests/contract/auth-register.test.ts (11 tests | 3 failed) 7919ms
   Ã— Contract Test: POST /api/auth/register > POST /api/auth/register > should register user with valid data and return standardized response 453ms
     â†’ expected { â€¦(13) } to have property "createdAt"
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should validate required fields 23ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should validate email format 19ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should validate password strength requirements 36ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should validate password confirmation match 5ms
   Ã— Contract Test: POST /api/auth/register > POST /api/auth/register > should validate name fields format 360ms
     â†’ expected 400 "Bad Request", got 201 "Created"
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should handle duplicate email registration  364ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should normalize email to lowercase  358ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should validate optional fields when provided  601ms
   âœ“ Contract Test: POST /api/auth/register > POST /api/auth/register > should create user audit log entry  356ms
   Ã— Contract Test: POST /api/auth/register > POST /api/auth/register > should handle registration rate limiting 1786ms
     â†’ expected 201 "Created", got 429 "Too Many Requests"
[0mPOST /api/auth/login [32m200[0m 329.188 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 3.265 ms - 209[0m
[0mPOST /api/zakat/payments [33m400[0m 2.561 ms - 209[0m
[0mPOST /api/zakat/payments [33m400[0m 2.824 ms - 209[0m
[0mGET /api/zakat/payments [32m200[0m 3.135 ms - 188[0m
stdout | ../tests/contract/auth-refresh.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2d061e5cd35fd71e.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2d061e5cd35fd71e.db

[0mPOST /api/auth/register [32m201[0m 355.528 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 330.385 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 2.322 ms - 209[0m
[0mPOST /api/zakat/payments [33m400[0m 2.197 ms - 209[0m
[0mPOST /api/zakat/payments [33m400[0m 2.167 ms - 209[0m
[0mGET /api/zakat/payments?year=2024 [32m200[0m 2.302 ms - 188[0m
stdout | ../tests/contract/auth-refresh.test.ts > Contract Test: POST /api/auth/refresh
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 362.808 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 327.835 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 2.864 ms - 209[0m
[0mPOST /api/zakat/payments [33m400[0m 1.966 ms - 209[0m
[0mPOST /api/zakat/payments [33m400[0m 1.721 ms - 209[0m
[0mGET /api/zakat/payments?page=1&limit=2 [32m200[0m 1.583 ms - 187[0m
[0mPOST /api/auth/register [32m201[0m 311.226 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 315.013 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 3.389 ms - 209[0m
[0mPOST /api/zakat/payments [33m400[0m 2.986 ms - 209[0m
[0mPOST /api/zakat/payments [33m400[0m 1.918 ms - 209[0m
[0mGET /api/zakat/payments [33m401[0m 0.286 ms - 94[0m
stdout | ../tests/contract/auth-refresh.test.ts > Contract Test: POST /api/auth/refresh
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 322.188 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 346.407 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 312.754 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 1.486 ms - 209[0m
[0mPOST /api/auth/login [32m200[0m 302.911 ms - -[0m
 â¯ ../tests/contract/auth-refresh.test.ts (13 tests | 13 failed) 2759ms
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should refresh tokens with valid refresh token and return standardized response 2ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should require refresh token in request body 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle invalid refresh token format 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle expired refresh token 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle revoked refresh token 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle non-existent refresh token 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle deactivated user account 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should revoke old refresh token after successful refresh 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should include user info in refresh response 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should validate token rotation security 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle concurrent refresh attempts 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should handle refresh rate limiting 0ms
     â†’ resetAuthState is not a function
   Ã— Contract Test: POST /api/auth/refresh > POST /api/auth/refresh > should create audit log entry for token refresh 0ms
     â†’ resetAuthState is not a function
[0mPOST /api/auth/register [32m201[0m 321.957 ms - -[0m
stdout | ../tests/contract/assets-get.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-547582615405c6dd.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-547582615405c6dd.db

[0mPOST /api/auth/login [32m200[0m 319.083 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 1.803 ms - 209[0m
[0mPOST /api/auth/register [32m201[0m 321.106 ms - -[0m
stdout | ../tests/contract/assets-get.test.ts > Contract Test: GET /api/assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 309.711 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 1.943 ms - 209[0m
[0mPOST /api/auth/register [32m201[0m 314.902 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 308.253 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 1.813 ms - 209[0m
stdout | ../tests/contract/assets-get.test.ts > Contract Test: GET /api/assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 318.087 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 299.084 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 1.549 ms - 209[0m
[0mPOST /api/auth/register [32m201[0m 345.199 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 311.179 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 302.204 ms - -[0m
[0mGET /api/assets [33m401[0m 0.719 ms - 94[0m
[0mGET /api/assets [33m401[0m 0.742 ms - 91[0m
[0mGET /api/assets [33m401[0m 1.423 ms - 91[0m
 â¯ ../tests/contract/assets-get.test.ts (7 tests | 4 failed) 2426ms
   âœ“ Contract Test: GET /api/assets > GET /api/assets > should require authentication 8ms
   Ã— Contract Test: GET /api/assets > GET /api/assets > should return user assets with standardized response format 1ms
     â†’ App or auth token not available
   Ã— Contract Test: GET /api/assets > GET /api/assets > should return encrypted asset data with proper structure 1ms
     â†’ App or auth token not available
   Ã— Contract Test: GET /api/assets > GET /api/assets > should handle empty asset list correctly 4ms
     â†’ expected true to be false // Object.is equality
   âœ“ Contract Test: GET /api/assets > GET /api/assets > should reject invalid JWT tokens 4ms
   âœ“ Contract Test: GET /api/assets > GET /api/assets > should reject expired JWT tokens 5ms
   Ã— Contract Test: GET /api/assets > GET /api/assets > should respect rate limiting 1ms
     â†’ expected true to be false // Object.is equality
stdout | ../tests/contract/assets-post.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-bf464dc66e58cdc0.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-bf464dc66e58cdc0.db

[0mPOST /api/auth/login [32m200[0m 310.858 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 1.911 ms - 209[0m
[0mPOST /api/auth/register [32m201[0m 330.705 ms - -[0m
stdout | ../tests/contract/assets-post.test.ts > Contract Test: POST /api/assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 317.356 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 1.969 ms - 209[0m
stdout | tests/integration/liveTracking.test.ts > Integration: Live Wealth Tracking
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/register [32m201[0m 345.385 ms - -[0m
[0mPOST /api/assets [31m500[0m 9359.930 ms - 236[0m
[0mPOST /api/auth/login [32m200[0m 313.092 ms - -[0m
[0mPOST /api/zakat/payments [33m400[0m 2.160 ms - 209[0m
 â¯ ../tests/contract/payment-records.contract.test.ts (17 tests | 17 failed) 11820ms
   Ã— Payment Records Contract Tests > POST /api/zakat/payments > should create new payment record with valid data 788ms
     â†’ expected 201 "Created", got 400 "Bad Request"
   Ã— Payment Records Contract Tests > POST /api/zakat/payments > should create payment record with minimal data 726ms
     â†’ expected 201 "Created", got 400 "Bad Request"
   Ã— Payment Records Contract Tests > POST /api/zakat/payments > should return 400 for invalid amount 976ms
     â†’ expected { code: 'VALIDATION_ERROR', â€¦(2) } to be 'VALIDATION_ERROR' // Object.is equality
   Ã— Payment Records Contract Tests > POST /api/zakat/payments > should return 400 for missing required fields 691ms
     â†’ expected { code: 'VALIDATION_ERROR', â€¦(2) } to be 'VALIDATION_ERROR' // Object.is equality
   Ã— Payment Records Contract Tests > POST /api/zakat/payments > should return 401 for unauthorized request 673ms
     â†’ expected { code: 'UNAUTHORIZED', â€¦(1) } to be 'UNAUTHORIZED' // Object.is equality
   Ã— Payment Records Contract Tests > GET /api/zakat/payments > should return paginated list of payments 710ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment Records Contract Tests > GET /api/zakat/payments > should filter payments by year 715ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment Records Contract Tests > GET /api/zakat/payments > should support pagination 718ms
     â†’ expected false to be true // Object.is equality
   Ã— Payment Records Contract Tests > GET /api/zakat/payments > should return 401 for unauthorized request 655ms
     â†’ expected { code: 'UNAUTHORIZED', â€¦(1) } to be 'UNAUTHORIZED' // Object.is equality
   Ã— Payment Records Contract Tests > PUT /api/zakat/payments/:id > should update payment record 646ms
     â†’ expected 201 "Created", got 400 "Bad Request"
   Ã— Payment Records Contract Tests > PUT /api/zakat/payments/:id > should return 404 for non-existent payment 651ms
     â†’ expected 201 "Created", got 400 "Bad Request"
   Ã— Payment Records Contract Tests > PUT /api/zakat/payments/:id > should return 401 for unauthorized request 646ms
     â†’ expected 201 "Created", got 400 "Bad Request"
   Ã— Payment Records Contract Tests > DELETE /api/zakat/payments/:id > should soft delete payment record 634ms
     â†’ expected 201 "Created", got 400 "Bad Request"
   Ã— Payment Records Contract Tests > DELETE /api/zakat/payments/:id > should return 404 for non-existent payment 628ms
     â†’ expected 201 "Created", got 400 "Bad Request"
   Ã— Payment Records Contract Tests > DELETE /api/zakat/payments/:id > should return 401 for unauthorized request 632ms
     â†’ expected 201 "Created", got 400 "Bad Request"
   Ã— Payment Records Contract Tests > Receipt URL Generation > should generate valid receipt URL 659ms
     â†’ expected 201 "Created", got 400 "Bad Request"
   Ã— Payment Records Contract Tests > Receipt URL Generation > should allow access to receipt via generated URL 671ms
     â†’ expected 201 "Created", got 400 "Bad Request"
stdout | src/__tests__/integration/admin-system.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ca788f017cc38cce.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ca788f017cc38cce.db

stdout | ../tests/contract/assets-post.test.ts > Contract Test: POST /api/assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/integration/admin-system.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 373.027 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 305.277 ms - -[0m
 â¯ ../tests/contract/assets-post.test.ts (8 tests | 8 skipped) 2582ms
   â†“ Contract Test: POST /api/assets > POST /api/assets > should require authentication
   â†“ Contract Test: POST /api/assets > POST /api/assets > should create asset with valid data and return standardized response
   â†“ Contract Test: POST /api/assets > POST /api/assets > should validate required fields
   â†“ Contract Test: POST /api/assets > POST /api/assets > should validate asset type enum
   â†“ Contract Test: POST /api/assets > POST /api/assets > should validate currency format (ISO 4217)
   â†“ Contract Test: POST /api/assets > POST /api/assets > should validate minimum asset value
   â†“ Contract Test: POST /api/assets > POST /api/assets > should validate description length limit
   â†“ Contract Test: POST /api/assets > POST /api/assets > should handle all valid asset types
stdout | tests/integration/unlockEdit.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ebcc5658c5925681.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ebcc5658c5925681.db

stdout | src/__tests__/integration/admin-system.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/unlockEdit.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 357.526 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 306.558 ms - -[0m
[0mGET /api/admin/system/status [32m200[0m 32.656 ms - 303[0m
[0mGET /api/admin/system/status/schema [32m200[0m 3.555 ms - 214[0m
[0mPOST /api/auth/register [32m201[0m 317.596 ms - -[0m
stdout | tests/integration/unlockEdit.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 307.839 ms - -[0m
[0mGET /api/admin/system/status [33m403[0m 1.897 ms - 95[0m
 â¯ src/__tests__/integration/admin-system.test.ts (3 tests | 1 failed) 1400ms
   âœ“ Admin System API > GET /api/admin/system/status returns system status 39ms
   Ã— Admin System API > GET /api/admin/system/status/schema returns detailed schema info 12ms
     â†’ expected false to be true // Object.is equality
   âœ“ Admin System API > GET /api/admin/system/status requires admin privileges  638ms
[0mPOST /api/auth/register [32m201[0m 363.672 ms - -[0m
stdout | tests/integration/invalidOperations.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-aaef518fd6b78f48.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-aaef518fd6b78f48.db

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwwvt00030gjje9lks8f5 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwwvt00030gjje9lks8f5 for user cmldpwwu300000gjj6m08xxlw 

[0mPOST /api/nisab-year-records [32m201[0m 27.979 ms - 805[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
CREATE RESPONSE STATUS: [33m201[39m
CREATE RESPONSE BODY: {
  "success": true,
  "data": {
    "id": "cmldpwwvt00030gjje9lks8f5",
    "userId": "cmldpwwu300000gjj6m08xxlw",
    "hawlStartDate": "2025-02-08T12:27:05.452Z",
    "hawlStartDateHijri": "1444-06-08",
    "hawlCompletionDate": "2026-01-29T12:27:05.452Z",
    "hawlCompletionDateHijri": "1445-06-08",
    "nisabThresholdAtStart": 0,
    "nisabBasis": "GOLD",
    "totalWealth": 10000,
    "totalLiabilities": 0,
    "zakatableWealth": 10000,
    "zakatAmount": 250,
    "methodologyUsed": "standard",
    "assetBreakdown": "FZ2mLkMZUn8Vqwof:Dgs=:lBWX0zDZ2UKJ+u4E9DpYJQ==",
    "calculationDetails": "{}",
    "status": "DRAFT",
    "finalizedAt": null,
    "userNotes": null,
    "calculationDate": "2026-02-08T12:27:05.465Z",
    "gregorianYear": 2026,
    "gregorianMonth": 2,
    "gregorianDay": 8,
    "hijriYear": 1444,
    "hijriMonth": 6,
    "hijriDay": 8,
    "isPrimary": false,
    "createdAt": "2026-02-08T12:27:05.466Z",
    "updatedAt": "2026-02-08T12:27:05.466Z"
  }
}

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwwvt00030gjje9lks8f5 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwwvt00030gjje9lks8f5 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwwvt00030gjje9lks8f5/finalize [32m200[0m 24.027 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpwwvt00030gjje9lks8f5 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpwwvt00030gjje9lks8f5 with reason: Need to correct asse... 

[0mPOST /api/nisab-year-records/cmldpwwvt00030gjje9lks8f5/unlock [32m200[0m 17.795 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwwyi000a0gjju94j48hx 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwwyi000a0gjju94j48hx for user cmldpwwu300000gjj6m08xxlw 

[0mPOST /api/nisab-year-records [32m201[0m 18.956 ms - 803[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwwyi000a0gjju94j48hx 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwwyi000a0gjju94j48hx with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwwyi000a0gjju94j48hx/finalize [32m200[0m 16.073 ms - 821[0m
[0mPOST /api/nisab-year-records/cmldpwwyi000a0gjju94j48hx/unlock [33m400[0m 0.991 ms - 100[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwx0d000f0gjjg3q0cwvb 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwx0d000f0gjjg3q0cwvb for user cmldpwwu300000gjj6m08xxlw 

[0mPOST /api/nisab-year-records [32m201[0m 20.079 ms - 805[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwx0d000f0gjjg3q0cwvb 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwx0d000f0gjjg3q0cwvb with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwx0d000f0gjjg3q0cwvb/finalize [32m200[0m 17.573 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpwx0d000f0gjjg3q0cwvb 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpwx0d000f0gjjg3q0cwvb with reason: Correcting asset val... 

[0mPOST /api/nisab-year-records/cmldpwx0d000f0gjjg3q0cwvb/unlock [32m200[0m 15.777 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldpwx0d000f0gjjg3q0cwvb 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldpwx0d000f0gjjg3q0cwvb 

[0mPUT /api/nisab-year-records/cmldpwx0d000f0gjjg3q0cwvb [32m200[0m 14.807 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwx34000o0gjj1dj29i06 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwx34000o0gjj1dj29i06 for user cmldpwwu300000gjj6m08xxlw 

[0mPOST /api/nisab-year-records [32m201[0m 19.903 ms - 805[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwx34000o0gjj1dj29i06 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwx34000o0gjj1dj29i06 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwx34000o0gjj1dj29i06/finalize [32m200[0m 17.496 ms - 823[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpwx34000o0gjj1dj29i06 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpwx34000o0gjj1dj29i06 with reason: Discovered missing l... 

[0mPOST /api/nisab-year-records/cmldpwx34000o0gjj1dj29i06/unlock [32m200[0m 16.097 ms - 822[0m
[0mGET /api/nisab-year-records/cmldpwx34000o0gjj1dj29i06/audit [32m200[0m 7.863 ms - -[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwx5j000v0gjjdyamny0a 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwx5j000v0gjjdyamny0a for user cmldpwwu300000gjj6m08xxlw 

[0mPOST /api/nisab-year-records [32m201[0m 18.334 ms - 805[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwx5j000v0gjjdyamny0a 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwx5j000v0gjjdyamny0a with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwx5j000v0gjjdyamny0a/finalize [32m200[0m 19.497 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpwx5j000v0gjjdyamny0a 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpwx5j000v0gjjdyamny0a with reason: Correcting calculati... 

[0mPOST /api/nisab-year-records/cmldpwx5j000v0gjjdyamny0a/unlock [32m200[0m 14.909 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldpwx5j000v0gjjdyamny0a 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldpwx5j000v0gjjdyamny0a 

[0mPUT /api/nisab-year-records/cmldpwx5j000v0gjjdyamny0a [32m200[0m 16.709 ms - 820[0m
[0mGET /api/nisab-year-records/cmldpwx5j000v0gjjdyamny0a/audit [32m200[0m 5.169 ms - -[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwx8f00140gjjrgtsocum 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwx8f00140gjjrgtsocum for user cmldpwwu300000gjj6m08xxlw 

[0mPOST /api/nisab-year-records [32m201[0m 16.211 ms - 803[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwx8f00140gjjrgtsocum 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwx8f00140gjjrgtsocum with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwx8f00140gjjrgtsocum/finalize [32m200[0m 15.041 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpwx8f00140gjjrgtsocum 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpwx8f00140gjjrgtsocum with reason: Correcting valuation... 

[0mPOST /api/nisab-year-records/cmldpwx8f00140gjjrgtsocum/unlock [32m200[0m 14.784 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldpwx8f00140gjjrgtsocum 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldpwx8f00140gjjrgtsocum 

[0mPUT /api/nisab-year-records/cmldpwx8f00140gjjrgtsocum [32m200[0m 14.833 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwx8f00140gjjrgtsocum 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwx8f00140gjjrgtsocum with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwx8f00140gjjrgtsocum/finalize [32m200[0m 19.238 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

 â¯ tests/integration/liveTracking.test.ts (8 tests | 5 failed) 16192ms
   âœ“ Integration: Live Wealth Tracking > should update DRAFT record when asset is added 47ms
   Ã— Integration: Live Wealth Tracking > should update DRAFT record when asset value is modified 6ms
     â†’ Cannot read properties of undefined (reading 'id')
   Ã— Integration: Live Wealth Tracking > should update DRAFT record when asset is deleted 16ms
     â†’ Cannot read properties of undefined (reading 'id')
   Ã— Integration: Live Wealth Tracking > should recalculate Zakat amount when wealth changes 30ms
     â†’ expected NaN to be close to NaN, received difference is NaN, but expected 0.005
   âœ“ Integration: Live Wealth Tracking > should handle non-zakatable assets correctly 27ms
   âœ“ Integration: Live Wealth Tracking > should meet performance requirement (<100ms for aggregation)  554ms
   Ã— Integration: Live Wealth Tracking > should provide asset breakdown by category 16ms
     â†’ expected undefined to be defined
   Ã— Integration: Live Wealth Tracking > should update updatedAt timestamp on recalculation 5002ms
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwxbd001f0gjjn46rd65c 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwxbd001f0gjjn46rd65c for user cmldpwwu300000gjj6m08xxlw 

[0mPOST /api/nisab-year-records [32m201[0m 19.298 ms - 803[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwxbd001f0gjjn46rd65c 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwxbd001f0gjjn46rd65c with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwxbd001f0gjjn46rd65c/finalize [32m200[0m 24.064 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpwxbd001f0gjjn46rd65c 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpwxbd001f0gjjn46rd65c with reason: Fixing data entry mi... 

[0mPOST /api/nisab-year-records/cmldpwxbd001f0gjjn46rd65c/unlock [32m200[0m 23.765 ms - 820[0m
stdout | tests/integration/invalidOperations.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldpwxbd001f0gjjn46rd65c 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldpwxbd001f0gjjn46rd65c 

[0mPUT /api/nisab-year-records/cmldpwxbd001f0gjjn46rd65c [32m200[0m 24.498 ms - 820[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwxbd001f0gjjn46rd65c 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwxbd001f0gjjn46rd65c with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwxbd001f0gjjn46rd65c/finalize [32m200[0m 26.285 ms - 821[0m
[0mGET /api/nisab-year-records/cmldpwxbd001f0gjjn46rd65c/audit [32m200[0m 4.456 ms - -[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should NOT allow unlocking DRAFT record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should NOT allow unlocking DRAFT record
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwxfz001q0gjjr804cl8w 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should NOT allow unlocking DRAFT record
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwxfz001q0gjjr804cl8w for user cmldpwwu300000gjj6m08xxlw 

[0mPOST /api/nisab-year-records [32m201[0m 25.297 ms - 804[0m
[0mPOST /api/nisab-year-records/cmldpwxfz001q0gjjr804cl8w/unlock [33m409[0m 10.679 ms - 90[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwxhl001t0gjji1bixf07 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwxhl001t0gjji1bixf07 for user cmldpwwu300000gjj6m08xxlw 

[0mPOST /api/nisab-year-records [32m201[0m 24.490 ms - 805[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwxhl001t0gjji1bixf07 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwxhl001t0gjji1bixf07 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwxhl001t0gjji1bixf07/finalize [32m200[0m 30.388 ms - 821[0m
stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpwxhl001t0gjji1bixf07 

stdout | tests/integration/unlockEdit.test.ts > Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpwxhl001t0gjji1bixf07 with reason: Correcting error due... 

[0mPOST /api/nisab-year-records/cmldpwxhl001t0gjji1bixf07/unlock [32m200[0m 24.987 ms - 820[0m
[0mGET /api/nisab-year-records/cmldpwxhl001t0gjji1bixf07/audit [32m200[0m 7.202 ms - -[0m
stdout | tests/integration/statusTransitions.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5358358a80d86853.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5358358a80d86853.db

 â¯ tests/integration/unlockEdit.test.ts (9 tests | 1 failed) 1322ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should unlock FINALIZED record with valid reason 104ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should require unlock reason with minimum 10 characters 66ms
   Ã— Integration: Unlock-Edit-Refinalize Workflow > should allow editing of UNLOCKED record 100ms
     â†’ expected +0 to be 12000 // Object.is equality
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should record UNLOCKED event in audit trail with reason 88ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should record EDITED events with changes summary 105ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should allow re-finalization after edit 105ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should record REFINALIZED event in audit trail 165ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should NOT allow unlocking DRAFT record 56ms
   âœ“ Integration: Unlock-Edit-Refinalize Workflow > should encrypt unlock reason in audit trail 117ms
stdout | tests/integration/finalization.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8b1e7ff06a6ab4f0.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8b1e7ff06a6ab4f0.db

stdout | tests/integration/statusTransitions.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/finalization.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/invalidOperations.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 380.600 ms - -[0m
stdout | tests/integration/statusTransitions.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 340.561 ms - -[0m
[0mGET /api/nisab-year-records [33m401[0m 0.882 ms - 94[0m
[0mGET /api/nisab-year-records [33m401[0m 1.117 ms - 91[0m
[0mGET /api/nisab-year-records [33m401[0m 1.797 ms - 91[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from accessing another user's records
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from accessing another user's records
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzbn00060gkcptm2kx3l 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from accessing another user's records
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzbn00060gkcptm2kx3l for user cmldpwz0300000gkcr5dwkcmr 

[0mPOST /api/nisab-year-records [32m201[0m 27.493 ms - 805[0m
[0mGET /api/nisab-year-records/cmldpwzbn00060gkcptm2kx3l [33m404[0m 5.485 ms - 66[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from modifying another user's records
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from modifying another user's records
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzcx00090gkcbfrne9c5 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from modifying another user's records
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzcx00090gkcbfrne9c5 for user cmldpwz0300000gkcr5dwkcmr 

[0mPOST /api/nisab-year-records [32m201[0m 32.733 ms - 803[0m
[0mPUT /api/nisab-year-records/cmldpwzcx00090gkcbfrne9c5 [33m404[0m 17.456 ms - 66[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from deleting another user's records
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from deleting another user's records
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzfd000c0gkc67ej7tvy 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from deleting another user's records
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzfd000c0gkc67ej7tvy for user cmldpwz0300000gkcr5dwkcmr 

[0mPOST /api/nisab-year-records [32m201[0m 25.813 ms - 803[0m
[0mDELETE /api/nisab-year-records/cmldpwzfd000c0gkc67ej7tvy [33m404[0m 3.127 ms - 66[0m
[0mPOST /api/nisab-year-records [33m400[0m 0.866 ms - 82[0m
[0mPOST /api/nisab-year-records [33m400[0m 0.960 ms - 90[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject invalid Hawl completion date (not 354 days)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject invalid Hawl completion date (not 354 days)
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzgj000f0gkc4pov5uy0 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject invalid Hawl completion date (not 354 days)
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzgj000f0gkc4pov5uy0 for user cmldpwz0300000gkcr5dwkcmr 

[0mPOST /api/nisab-year-records [32m201[0m 25.630 ms - 806[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject negative wealth values
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject negative wealth values
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzhb000i0gkcd9zl1zgn 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject negative wealth values
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzhb000i0gkcd9zl1zgn for user cmldpwz0300000gkcr5dwkcmr 

[0mPOST /api/nisab-year-records [32m201[0m 22.814 ms - 805[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject Zakat amount not equal to 2.5% of zakatable wealth
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject Zakat amount not equal to 2.5% of zakatable wealth
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzi3000l0gkcdywb5roz 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Validation Errors > should reject Zakat amount not equal to 2.5% of zakatable wealth
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzi3000l0gkcdywb5roz for user cmldpwz0300000gkcr5dwkcmr 

[0mPOST /api/nisab-year-records [32m201[0m 21.189 ms - 805[0m
[0mGET /api/nisab-year-records/nonexistent_id_12345 [33m404[0m 2.737 ms - 66[0m
[0mPOST /api/nisab-year-records/fake_id/finalize [33m404[0m 3.846 ms - 66[0m
[0mPOST /api/nisab-year-records/fake_id/unlock [33m400[0m 1.533 ms - 81[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject finalization before Hawl completion without override
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject finalization before Hawl completion without override
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzj8000o0gkchc069u0t 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject finalization before Hawl completion without override
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzj8000o0gkchc069u0t for user cmldpwz0300000gkcr5dwkcmr 

[0mPOST /api/nisab-year-records [32m201[0m 20.556 ms - 805[0m
[0mPOST /api/nisab-year-records/cmldpwzj8000o0gkchc069u0t/finalize [33m409[0m 4.576 ms - 115[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzjz000r0gkc48vnhjiy 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzjz000r0gkc48vnhjiy for user cmldpwz0300000gkcr5dwkcmr 

[0mPOST /api/nisab-year-records [32m201[0m 22.070 ms - 805[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwzjz000r0gkc48vnhjiy 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwzjz000r0gkc48vnhjiy with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwzjz000r0gkc48vnhjiy/finalize [32m200[0m 24.358 ms - 821[0m
[0mPOST /api/nisab-year-records/cmldpwzjz000r0gkc48vnhjiy/unlock [33m400[0m 0.832 ms - 81[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzlp000w0gkcwxaylxda 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzlp000w0gkcwxaylxda for user cmldpwz0300000gkcr5dwkcmr 

[0mPOST /api/nisab-year-records [32m201[0m 22.757 ms - 803[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwzlp000w0gkcwxaylxda 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwzlp000w0gkcwxaylxda with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwzlp000w0gkcwxaylxda/finalize [32m200[0m 19.677 ms - 821[0m
[0mPOST /api/nisab-year-records/cmldpwzlp000w0gkcwxaylxda/unlock [33m400[0m 0.576 ms - 81[0m
stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Edge Cases > should handle very large wealth values
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Edge Cases > should handle very large wealth values
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzn600110gkcb44hctsy 

stdout | tests/integration/invalidOperations.test.ts > Integration: Invalid Operations and Error Handling > Edge Cases > should handle very large wealth values
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzn600110gkcb44hctsy for user cmldpwz0300000gkcr5dwkcmr 

[0mPOST /api/nisab-year-records [32m201[0m 18.916 ms - 831[0m
[0mPOST /api/nisab-year-records [33m400[0m 5.404 ms - 145[0m
[0mPOST /api/nisab-year-records [31m500[0m 2.590 ms - 49[0m
[0mPOST /api/auth/register [32m201[0m 434.603 ms - -[0m
 â¯ tests/integration/invalidOperations.test.ts (20 tests | 11 failed) 1249ms
   âœ“ Integration: Invalid Operations and Error Handling > Authentication Errors > should reject requests without auth token 7ms
   âœ“ Integration: Invalid Operations and Error Handling > Authentication Errors > should reject requests with invalid token 4ms
   âœ“ Integration: Invalid Operations and Error Handling > Authentication Errors > should reject requests with expired token 6ms
   Ã— Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from accessing another user's records 48ms
     â†’ expected 404 to be 403 // Object.is equality
   Ã— Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from modifying another user's records 77ms
     â†’ expected 404 to be 403 // Object.is equality
   Ã— Integration: Invalid Operations and Error Handling > Authorization Errors > should prevent user from deleting another user's records 44ms
     â†’ expected 404 to be 403 // Object.is equality
   âœ“ Integration: Invalid Operations and Error Handling > Validation Errors > should reject creation with missing required fields 4ms
   âœ“ Integration: Invalid Operations and Error Handling > Validation Errors > should reject invalid nisabBasis value 4ms
   Ã— Integration: Invalid Operations and Error Handling > Validation Errors > should reject invalid Hawl completion date (not 354 days) 29ms
     â†’ expected 201 to be 400 // Object.is equality
   Ã— Integration: Invalid Operations and Error Handling > Validation Errors > should reject negative wealth values 26ms
     â†’ expected 201 to be 400 // Object.is equality
   Ã— Integration: Invalid Operations and Error Handling > Validation Errors > should reject Zakat amount not equal to 2.5% of zakatable wealth 24ms
     â†’ expected 201 to be 400 // Object.is equality
   âœ“ Integration: Invalid Operations and Error Handling > Not Found Errors > should return 404 for non-existent record 7ms
   Ã— Integration: Invalid Operations and Error Handling > Not Found Errors > should return 400 when finalizing non-existent record 7ms
     â†’ expected 404 to be 400 // Object.is equality
   âœ“ Integration: Invalid Operations and Error Handling > Not Found Errors > should return 400 when unlocking non-existent record 5ms
   Ã— Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject finalization before Hawl completion without override 30ms
     â†’ expected 409 to be 400 // Object.is equality
   Ã— Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock without reason 61ms
     â†’ expected 'unlockReason is required' to contain 'reason'
   Ã— Integration: Invalid Operations and Error Handling > Business Logic Errors > should reject unlock with reason too short 51ms
     â†’ expected 'unlockReason is required' to contain '10 characters'
   âœ“ Integration: Invalid Operations and Error Handling > Edge Cases > should handle very large wealth values 22ms
   Ã— Integration: Invalid Operations and Error Handling > Edge Cases > should handle concurrent edits to same record 9ms
     â†’ Cannot read properties of undefined (reading 'id')
   âœ“ Integration: Invalid Operations and Error Handling > Edge Cases > should handle malformed JSON in request body 7ms
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzp500030gl3vwpks1pi 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzp500030gl3vwpks1pi for user cmldpwznj00000gl3pk8waypk 

[0mPOST /api/nisab-year-records [32m201[0m 32.737 ms - 805[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwzp500030gl3vwpks1pi 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwzp500030gl3vwpks1pi with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwzp500030gl3vwpks1pi/finalize [32m200[0m 29.171 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzr500080gl3dje29hyi 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzr500080gl3dje29hyi for user cmldpwznj00000gl3pk8waypk 

[0mPOST /api/nisab-year-records [32m201[0m 19.418 ms - 803[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwzr500080gl3dje29hyi 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwzr500080gl3dje29hyi with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwzr500080gl3dje29hyi/finalize [32m200[0m 17.180 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpwzr500080gl3dje29hyi 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpwzr500080gl3dje29hyi with reason: Valid reason for unl... 

[0mPOST /api/nisab-year-records/cmldpwzr500080gl3dje29hyi/unlock [32m200[0m 23.082 ms - 820[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzt1000f0gl3msxl02y6 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzt1000f0gl3msxl02y6 for user cmldpwznj00000gl3pk8waypk 

[0mPOST /api/nisab-year-records [32m201[0m 17.646 ms - 803[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwzt1000f0gl3msxl02y6 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwzt1000f0gl3msxl02y6 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwzt1000f0gl3msxl02y6/finalize [32m200[0m 19.604 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpwzt1000f0gl3msxl02y6 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpwzt1000f0gl3msxl02y6 with reason: Unlocking for necess... 

[0mPOST /api/nisab-year-records/cmldpwzt1000f0gl3msxl02y6/unlock [32m200[0m 16.746 ms - 820[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwzt1000f0gl3msxl02y6 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization)
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwzt1000f0gl3msxl02y6 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwzt1000f0gl3msxl02y6/finalize [32m200[0m 20.142 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow DRAFT â†’ UNLOCKED transition
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow DRAFT â†’ UNLOCKED transition
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzvf000o0gl350hs2pcw 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow DRAFT â†’ UNLOCKED transition
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzvf000o0gl350hs2pcw for user cmldpwznj00000gl3pk8waypk 

[0mPOST /api/nisab-year-records [32m201[0m 21.457 ms - 803[0m
[0mPOST /api/nisab-year-records/cmldpwzvf000o0gl350hs2pcw/unlock [33m409[0m 6.709 ms - 90[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | src/__tests__/integration/encryption-admin.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-4c69e278ef3e18a4.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-4c69e278ef3e18a4.db

[0mPOST /api/auth/register [32m201[0m 412.957 ms - -[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzwe000r0gl3axhv7rcs 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzwe000r0gl3axhv7rcs for user cmldpwznj00000gl3pk8waypk 

[0mPOST /api/nisab-year-records [32m201[0m 27.098 ms - 803[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwzwe000r0gl3axhv7rcs 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwzwe000r0gl3axhv7rcs with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwzwe000r0gl3axhv7rcs/finalize [32m200[0m 23.099 ms - 821[0m
[0mPUT /api/nisab-year-records/cmldpwzwe000r0gl3axhv7rcs [33m400[0m 0.941 ms - 113[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzxe00030glpvvnh10iq 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzxe00030glpvvnh10iq for user cmldpwzvi00000glpr4ujws8p 

[0mPOST /api/nisab-year-records [32m201[0m 31.038 ms - 805[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzy5000w0gl3w3k5uku4 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzy5000w0gl3w3k5uku4 for user cmldpwznj00000gl3pk8waypk 

[0mPOST /api/nisab-year-records [32m201[0m 26.701 ms - 805[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwzxe00030glpvvnh10iq 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwzxe00030glpvvnh10iq with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwzxe00030glpvvnh10iq/finalize [32m200[0m 29.639 ms - 821[0m
[0mPUT /api/nisab-year-records/cmldpwzxe00030glpvvnh10iq [33m409[0m 7.386 ms - 94[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpwzy5000w0gl3w3k5uku4 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpwzy5000w0gl3w3k5uku4 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpwzy5000w0gl3w3k5uku4/finalize [32m200[0m 23.661 ms - 821[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT finalize before Hawl completion date without override
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT finalize before Hawl completion date without override
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpwzzn00080glp5kxtesr0 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT finalize before Hawl completion date without override
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpwzzn00080glp5kxtesr0 for user cmldpwzvi00000glpr4ujws8p 

[0mPOST /api/nisab-year-records [32m201[0m 25.503 ms - 803[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpwzy5000w0gl3w3k5uku4 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpwzy5000w0gl3w3k5uku4 with reason: Unlocking for correc... 

[0mPOST /api/nisab-year-records/cmldpwzy5000w0gl3w3k5uku4/unlock [32m200[0m 28.121 ms - 820[0m
[0mPOST /api/nisab-year-records/cmldpwzzn00080glp5kxtesr0/finalize [33m409[0m 3.052 ms - 115[0m
[0mPUT /api/nisab-year-records/cmldpwzy5000w0gl3w3k5uku4 [33m400[0m 0.940 ms - 113[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should allow early finalization with override flag
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow direct status field updates
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should allow early finalization with override flag
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx00o000b0glppm0zpk8c 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should allow early finalization with override flag
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx00o000b0glppm0zpk8c for user cmldpwzvi00000glpr4ujws8p 

[0mPOST /api/nisab-year-records [32m201[0m 25.083 ms - 805[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow direct status field updates
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx00t00130gl37p7xqdkl 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > Invalid Transitions > should NOT allow direct status field updates
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx00t00130gl37p7xqdkl for user cmldpwznj00000gl3pk8waypk 

[0mPOST /api/nisab-year-records [32m201[0m 23.944 ms - 805[0m
[0mPUT /api/nisab-year-records/cmldpx00t00130gl37p7xqdkl [33m400[0m 0.756 ms - 113[0m
[0mPOST /api/nisab-year-records/cmldpx00o000b0glppm0zpk8c/finalize [33m409[0m 5.617 ms - 115[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should record FINALIZED event in audit trail
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx01n00160gl3zv1zutt8 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx01n00160gl3zv1zutt8 for user cmldpwznj00000gl3pk8waypk 

[0mPOST /api/nisab-year-records [32m201[0m 23.219 ms - 805[0m
[0mGET /api/nisab-year-records/cmldpx01n00160gl3zv1zutt8 [32m200[0m 4.589 ms - 1013[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should record FINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx01v000e0glpr9pqxg0u 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should record FINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx01v000e0glpr9pqxg0u for user cmldpwzvi00000glpr4ujws8p 

[0mPOST /api/nisab-year-records [32m201[0m 27.860 ms - 805[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpx01n00160gl3zv1zutt8 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpx01n00160gl3zv1zutt8 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpx01n00160gl3zv1zutt8/finalize [32m200[0m 23.032 ms - 821[0m
[0mGET /api/nisab-year-records/cmldpx01n00160gl3zv1zutt8 [32m200[0m 2.376 ms - 821[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should record FINALIZED event in audit trail
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpx01v000e0glpr9pqxg0u 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should record FINALIZED event in audit trail
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpx01v000e0glpr9pqxg0u with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpx01v000e0glpr9pqxg0u/finalize [32m200[0m 26.217 ms - 821[0m
[0mGET /api/nisab-year-records/cmldpx01v000e0glpr9pqxg0u/audit-trail [33m404[0m 2.701 ms - 199[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should prevent deletion of FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpx01n00160gl3zv1zutt8 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpx01n00160gl3zv1zutt8 with reason: Correction needed af... 

[0mPOST /api/nisab-year-records/cmldpx01n00160gl3zv1zutt8/unlock [32m200[0m 25.501 ms - 820[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should prevent deletion of FINALIZED record
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx03r000j0glpf44osl5k 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should prevent deletion of FINALIZED record
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx03r000j0glpf44osl5k for user cmldpwzvi00000glpr4ujws8p 

[0mPOST /api/nisab-year-records [32m201[0m 20.112 ms - 803[0m
[0mGET /api/nisab-year-records/cmldpx01n00160gl3zv1zutt8 [32m200[0m 6.341 ms - 820[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should prevent deletion of FINALIZED record
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpx03r000j0glpf44osl5k 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should prevent deletion of FINALIZED record
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpx03r000j0glpf44osl5k with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpx03r000j0glpf44osl5k/finalize [32m200[0m 19.533 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx04m001d0gl3174l8icq 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx04m001d0gl3174l8icq for user cmldpwznj00000gl3pk8waypk 

[0mPOST /api/nisab-year-records [32m201[0m 25.387 ms - 805[0m
[0mDELETE /api/nisab-year-records/cmldpx03r000j0glpf44osl5k [33m409[0m 3.525 ms - 137[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should lock all financial values on finalization
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should lock all financial values on finalization
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx05f000o0glpzrs2fxfj 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should lock all financial values on finalization
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx05f000o0glpzrs2fxfj for user cmldpwzvi00000glpr4ujws8p 

[0mPOST /api/nisab-year-records [32m201[0m 24.655 ms - 805[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpx04m001d0gl3174l8icq 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpx04m001d0gl3174l8icq with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpx04m001d0gl3174l8icq/finalize [32m200[0m 30.130 ms - 821[0m
stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpx04m001d0gl3174l8icq 

stdout | tests/integration/statusTransitions.test.ts > Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpx04m001d0gl3174l8icq with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpx04m001d0gl3174l8icq/finalize [32m200[0m 49.268 ms - 821[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should lock all financial values on finalization
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpx05f000o0glpzrs2fxfj 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should lock all financial values on finalization
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpx05f000o0glpzrs2fxfj with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpx05f000o0glpzrs2fxfj/finalize [32m200[0m 22.443 ms - 821[0m
[0mGET /api/nisab-year-records/cmldpx05f000o0glpzrs2fxfj [32m200[0m 3.658 ms - 821[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

 â¯ tests/integration/statusTransitions.test.ts (9 tests | 1 failed) 1126ms
   âœ“ Integration: Status Transition Validation > Valid Transitions > should allow DRAFT â†’ FINALIZED transition 77ms
   âœ“ Integration: Status Transition Validation > Valid Transitions > should allow FINALIZED â†’ UNLOCKED transition 70ms
   âœ“ Integration: Status Transition Validation > Valid Transitions > should allow UNLOCKED â†’ FINALIZED transition (re-finalization) 87ms
   âœ“ Integration: Status Transition Validation > Invalid Transitions > should NOT allow DRAFT â†’ UNLOCKED transition 34ms
   âœ“ Integration: Status Transition Validation > Invalid Transitions > should NOT allow FINALIZED â†’ DRAFT transition 63ms
   âœ“ Integration: Status Transition Validation > Invalid Transitions > should NOT allow UNLOCKED â†’ DRAFT transition 94ms
   âœ“ Integration: Status Transition Validation > Invalid Transitions > should NOT allow direct status field updates 31ms
   âœ“ Integration: Status Transition Validation > State Transition Constraints > should maintain status integrity across multiple operations 102ms
   Ã— Integration: Status Transition Validation > State Transition Constraints > should prevent concurrent status changes 88ms
     â†’ expected 0 to be greater than or equal to 1
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx072000t0glpgzarp2kb 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx072000t0glpgzarp2kb for user cmldpwzvi00000glpr4ujws8p 

[0mPOST /api/nisab-year-records [32m201[0m 22.290 ms - 805[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpx072000t0glpgzarp2kb 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpx072000t0glpgzarp2kb with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpx072000t0glpgzarp2kb/finalize [32m200[0m 16.477 ms - 821[0m
[0mPOST /api/nisab-year-records/cmldpx072000t0glpgzarp2kb/finalize [33m409[0m 2.406 ms - 96[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should include finalizedAt timestamp
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should include finalizedAt timestamp
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx08i000y0glpwctac5tw 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should include finalizedAt timestamp
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx08i000y0glpwctac5tw for user cmldpwzvi00000glpr4ujws8p 

[0mPOST /api/nisab-year-records [32m201[0m 22.911 ms - 805[0m
stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should include finalizedAt timestamp
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpx08i000y0glpwctac5tw 

stdout | tests/integration/finalization.test.ts > Integration: Finalization Workflow > should include finalizedAt timestamp
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpx08i000y0glpwctac5tw with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpx08i000y0glpwctac5tw/finalize [32m200[0m 25.224 ms - 821[0m
 â¯ tests/integration/finalization.test.ts (8 tests | 7 failed) 920ms
   Ã— Integration: Finalization Workflow > should finalize DRAFT record after Hawl completion date 91ms
     â†’ expected 409 to be 403 // Object.is equality
   Ã— Integration: Finalization Workflow > should NOT finalize before Hawl completion date without override 37ms
     â†’ expected 409 to be 400 // Object.is equality
   Ã— Integration: Finalization Workflow > should allow early finalization with override flag 42ms
     â†’ expected 409 to be 200 // Object.is equality
   Ã— Integration: Finalization Workflow > should record FINALIZED event in audit trail 69ms
     â†’ expected 404 to be 200 // Object.is equality
   Ã— Integration: Finalization Workflow > should prevent deletion of FINALIZED record 59ms
     â†’ expected 409 to be 403 // Object.is equality
   Ã— Integration: Finalization Workflow > should lock all financial values on finalization 60ms
     â†’ expected +0 to be 11000 // Object.is equality
   Ã— Integration: Finalization Workflow > should NOT allow re-finalization of already FINALIZED record 48ms
     â†’ expected 409 to be 400 // Object.is equality
   âœ“ Integration: Finalization Workflow > should include finalizedAt timestamp 55ms
stdout | tests/integration/hawlInterruption.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5442dcac13bc2413.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5442dcac13bc2413.db

stdout | src/__tests__/integration/encryption-admin.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetection.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-7a09b9f9c4132c85.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-7a09b9f9c4132c85.db

stdout | tests/integration/hawlInterruption.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetection.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/integration/encryption-admin.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 388.385 ms - -[0m
stdout | tests/integration/hawlInterruption.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetection.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 346.279 ms - -[0m
[0mPOST /api/admin/encryption/scan [32m200[0m 8.083 ms - 28[0m
[0mGET /api/admin/encryption/issues [32m200[0m 2.705 ms - 28[0m
 â¯ src/__tests__/integration/encryption-admin.test.ts (2 tests | 2 failed) 831ms
   Ã— Admin Encryption Remediation API > scan creates remediation for prev-key encrypted payment 16ms
     â†’ expected 0 to be greater than or equal to 1
   Ã— Admin Encryption Remediation API > retry with correct previous key resolves remediation and re-encrypts 7ms
     â†’ expected undefined to be truthy
[0mPOST /api/auth/register [32m201[0m 385.150 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 390.306 ms - -[0m
[0mPOST /api/assets [32m201[0m 19.658 ms - 506[0m
[0mPOST /api/assets [32m201[0m 14.651 ms - 506[0m
[0mGET /api/nisab-year-records/status [32m200[0m 4.681 ms - 16[0m
[0mPOST /api/assets [32m201[0m 13.722 ms - 495[0m
stdout | tests/contract/nisabYearRecords.post.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-94d245a9cc7f0c45.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-94d245a9cc7f0c45.db

[0mPOST /api/assets [32m201[0m 11.504 ms - 504[0m
[0mGET /api/nisab-year-records/status [32m200[0m 6.103 ms - 16[0m
[0mGET /api/assets [32m200[0m 3.355 ms - 678[0m
[0mGET /api/nisab-year-records/status [32m200[0m 7.668 ms - 16[0m
[0mPOST /api/assets [32m201[0m 16.023 ms - 498[0m
[0mPOST /api/assets [32m201[0m 12.348 ms - 498[0m
[0mGET /api/nisab-year-records/status [32m200[0m 2.664 ms - 16[0m
[0mPOST /api/assets [32m201[0m 16.046 ms - 497[0m
[0mPOST /api/assets [32m201[0m 12.274 ms - 497[0m
[0mPOST /api/assets [32m201[0m 12.502 ms - 502[0m
[0mGET /api/nisab-year-records/status [32m200[0m 3.266 ms - 16[0m
[0mGET /api/nisab-year-records/status [32m200[0m 5.654 ms - 16[0m
[0mPOST /api/assets [32m201[0m 15.933 ms - 496[0m
[0mPOST /api/assets [32m201[0m 19.691 ms - 495[0m
[0mGET /api/nisab-year-records/status [32m200[0m 4.341 ms - 16[0m
[0mGET /api/nisab-year-records/status [32m200[0m 4.071 ms - 16[0m
[0mGET /api/assets [32m200[0m 2.944 ms - 678[0m
[0mGET /api/nisab-year-records/undefined [33m404[0m 12.171 ms - 66[0m
[0mPOST /api/assets [32m201[0m 12.180 ms - 498[0m
[0mGET /api/nisab-year-records/status [32m200[0m 3.303 ms - 16[0m
[0mPOST /api/assets [32m201[0m 11.663 ms - 498[0m
[0mGET /api/nisab-year-records/status [32m200[0m 2.610 ms - 16[0m
 â¯ tests/integration/hawlInterruption.test.ts (6 tests | 6 failed) 666ms
   Ã— Integration: Hawl Interruption > should detect Hawl interruption when wealth drops below Nisab 31ms
     â†’ Cannot read properties of undefined (reading 'id')
   Ã— Integration: Hawl Interruption > should archive interrupted DRAFT record 46ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Integration: Hawl Interruption > should allow new Hawl to start after interruption if wealth rises again 30ms
     â†’ Cannot read properties of undefined (reading 'id')
   Ã— Integration: Hawl Interruption > should not interrupt if wealth temporarily fluctuates but stays above Nisab 53ms
     â†’ expected false to be true // Object.is equality
   Ã— Integration: Hawl Interruption > should record interruption in audit trail 46ms
     â†’ Cannot read properties of undefined (reading '0')
   Ã— Integration: Hawl Interruption > should clear Hawl completion date on interruption 30ms
     â†’ expected undefined to be defined
[0mPOST /api/assets [32m201[0m 9.818 ms - 495[0m
[0mGET /api/nisab-year-records/status [32m200[0m 3.011 ms - 16[0m
[0mGET /api/nisab-year-records/undefined [33m404[0m 5.086 ms - 66[0m
 â¯ tests/integration/hawlDetection.test.ts (6 tests | 6 failed) 706ms
   Ã— Integration: Nisab Achievement Detection > should detect Nisab achievement and create DRAFT record 70ms
     â†’ expected false to be true // Object.is equality
   Ã— Integration: Nisab Achievement Detection > should not create duplicate Hawl if active DRAFT exists 36ms
     â†’ expected false to be true // Object.is equality
   Ã— Integration: Nisab Achievement Detection > should use gold-based Nisab if gold threshold is lower 34ms
     â†’ expected false to be true // Object.is equality
   Ã— Integration: Nisab Achievement Detection > should lock Nisab threshold value at Hawl start 57ms
     â†’ expected undefined to be defined
   Ã— Integration: Nisab Achievement Detection > should calculate Hawl completion date as 354 days from start 31ms
     â†’ expected NaN to be 354 // Object.is equality
   Ã— Integration: Nisab Achievement Detection > should include Hijri date equivalents 42ms
     â†’ .toMatch() expects to receive a string, but got undefined
stdout | ../tests/unit/EncryptionService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-d97b4bfec12cf2a0.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-d97b4bfec12cf2a0.db

stdout | tests/contract/nisabYearRecords.put.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8d27e8a055677c01.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8d27e8a055677c01.db

stdout | tests/contract/nisabYearRecords.post.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 â¯ ../tests/unit/EncryptionService.test.ts (29 tests | 5 failed) 392ms
   âœ“ Implementation Task T023: EncryptionService > Core Encryption/Decryption > should encrypt and decrypt data successfully 6ms
   âœ“ Implementation Task T023: EncryptionService > Core Encryption/Decryption > should generate different encrypted values for the same plaintext 1ms
   Ã— Implementation Task T023: EncryptionService > Core Encryption/Decryption > should throw error for empty plaintext 15ms
     â†’ promise resolved "'bI/ZM0rchm5/wQJL::8VRb0gR5ZhQz+A1rviSâ€¦'" instead of rejecting
   Ã— Implementation Task T023: EncryptionService > Core Encryption/Decryption > should throw error for empty key 1ms
     â†’ You must provide a Promise to expect() when using .rejects, not 'object'.
   âœ“ Implementation Task T023: EncryptionService > Core Encryption/Decryption > should throw error for invalid encrypted data format 2ms
   âœ“ Implementation Task T023: EncryptionService > Object Encryption/Decryption > should encrypt and decrypt objects successfully 2ms
   âœ“ Implementation Task T023: EncryptionService > Object Encryption/Decryption > should handle complex nested objects 1ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should generate secure random keys 1ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should derive keys from passwords using PBKDF2 174ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should generate different keys for different salts 164ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should generate cryptographically secure salts 1ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should reject empty password for key derivation 0ms
   âœ“ Implementation Task T023: EncryptionService > Key Management > should reject empty salt for key derivation 0ms
   âœ“ Implementation Task T023: EncryptionService > Hashing and Verification > should create consistent SHA-256 hashes 1ms
   âœ“ Implementation Task T023: EncryptionService > Hashing and Verification > should create different hashes for different data 0ms
   âœ“ Implementation Task T023: EncryptionService > Hashing and Verification > should verify hashes correctly 0ms
   âœ“ Implementation Task T023: EncryptionService > Hashing and Verification > should handle empty data in hash verification 0ms
   âœ“ Implementation Task T023: EncryptionService > Hashing and Verification > should throw error for empty data hashing 0ms
   âœ“ Implementation Task T023: EncryptionService > Islamic Compliance Features > should encrypt asset data with integrity checks 1ms
   Ã— Implementation Task T023: EncryptionService > Islamic Compliance Features > should validate asset data integrity 5ms
     â†’ promise resolved "{ type: 'gold', value: 50000, â€¦(2) }" instead of rejecting
   âœ“ Implementation Task T023: EncryptionService > Islamic Compliance Features > should include timestamp in encrypted asset data 1ms
   âœ“ Implementation Task T023: EncryptionService > Security Features > should detect encrypted data format 1ms
   âœ“ Implementation Task T023: EncryptionService > Security Features > should normalize keys correctly 1ms
   Ã— Implementation Task T023: EncryptionService > Security Features > should validate encryption configuration 7ms
     â†’ expected false to be true // Object.is equality
   âœ“ Implementation Task T023: EncryptionService > Security Features > should handle key length variations 1ms
   Ã— Implementation Task T023: EncryptionService > Error Handling > should provide meaningful error messages 1ms
     â†’ promise resolved "'LA2zMTKrCIesruxh::EFmmdxdQGoxJzs+wU/4â€¦'" instead of rejecting
   âœ“ Implementation Task T023: EncryptionService > Error Handling > should handle malformed encrypted data gracefully 1ms
   âœ“ Implementation Task T023: EncryptionService > Performance and Scalability > should handle large data encryption efficiently 1ms
   âœ“ Implementation Task T023: EncryptionService > Performance and Scalability > should handle multiple concurrent encryptions 1ms
stdout | tests/contract/nisabYearRecords.getById.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a2b6f04b0e530d17.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a2b6f04b0e530d17.db

stdout | tests/contract/nisabYearRecords.put.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.getById.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.post.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create DRAFT record with required fields
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create DRAFT record with required fields
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4i200010gpoyv6phrge 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create DRAFT record with required fields
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4i200010gpoyv6phrge for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 50.307 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create record with silver nisab basis
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create record with silver nisab basis
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4jp00040gpos12sorny 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create record with silver nisab basis
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4jp00040gpos12sorny for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 23.079 ms - 797[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate nisabThresholdAtStart if not provided
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate nisabThresholdAtStart if not provided
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4km00070gposgikgn90 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate nisabThresholdAtStart if not provided
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4km00070gposgikgn90 for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 21.171 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept user-provided nisabThresholdAtStart
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept user-provided nisabThresholdAtStart
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4lh000a0gpo2tiz0pvy 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept user-provided nisabThresholdAtStart
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4lh000a0gpo2tiz0pvy for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 16.578 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept optional userNotes field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept optional userNotes field
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4mg000d0gposyu6yuee 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept optional userNotes field
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4mg000d0gposyu6yuee for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 23.890 ms - 825[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate hawlCompletionDate (354 days after start)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate hawlCompletionDate (354 days after start)
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4nd000g0gpolwcn3ko3 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate hawlCompletionDate (354 days after start)
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4nd000g0gpolwcn3ko3 for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 18.212 ms - 795[0m
[0mPOST /api/nisab-year-records [33m400[0m 0.890 ms - 82[0m
[0mPOST /api/nisab-year-records [33m400[0m 1.016 ms - 90[0m
[0mPOST /api/nisab-year-records [33m400[0m 1.433 ms - 90[0m
[0mPOST /api/nisab-year-records [33m400[0m 1.090 ms - 91[0m
[0mPOST /api/nisab-year-records [33m400[0m 2.811 ms - 97[0m
[0mPOST /api/nisab-year-records [33m401[0m 0.592 ms - 94[0m
[0mPOST /api/nisab-year-records [33m401[0m 1.094 ms - 91[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should create record with authenticated user ID
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should create record with authenticated user ID
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4pg000j0gpo44ffe0hk 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should create record with authenticated user ID
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4pg000j0gpo44ffe0hk for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 21.338 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should return correct response structure
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should return correct response structure
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4qd000m0gpoy5q0i82j 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should return correct response structure
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4qd000m0gpoy5q0i82j for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 21.948 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should include Hijri dates in response
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should include Hijri dates in response
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4rf000p0gpoww8tgkn0 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should include Hijri dates in response
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4rf000p0gpoww8tgkn0 for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 18.601 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should encrypt sensitive fields in database
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.put.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should encrypt sensitive fields in database
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4sf000s0gpog11a83fa 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should encrypt sensitive fields in database
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4sf000s0gpog11a83fa for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 26.716 ms - 795[0m
stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should set correct initial status to DRAFT
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should set correct initial status to DRAFT
[AuditTrailService] INFO: Audit event recorded: CREATED for record cmldpx4tc000v0gpo2oz8oeee 

stdout | tests/contract/nisabYearRecords.post.test.ts > POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should set correct initial status to DRAFT
[NisabYearRecordService] INFO: Nisab Year Record created: cmldpx4tc000v0gpo2oz8oeee for user cmldpx4gk00000gponb9a8oht 

[0mPOST /api/nisab-year-records [32m201[0m 19.821 ms - 795[0m
 â¯ tests/contract/nisabYearRecords.post.test.ts (18 tests | 2 failed) 496ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create DRAFT record with required fields 85ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should create record with silver nisab basis 38ms
   Ã— POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate nisabThresholdAtStart if not provided 34ms
     â†’ expected 0 to be greater than 0
   Ã— POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept user-provided nisabThresholdAtStart 33ms
     â†’ expected +0 to be 5687.2 // Object.is equality
   âœ“ POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should accept optional userNotes field 34ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Successful Record Creation > should calculate hawlCompletionDate (354 days after start) 28ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Request Validation > should return 400 when hawlStartDate is missing 7ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Request Validation > should return 400 when nisabBasis is missing 6ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Request Validation > should return 400 when nisabBasis is invalid 8ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Request Validation > should return 400 when hawlStartDate is invalid format 6ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Request Validation > should return 400 when nisabThresholdAtStart is negative 9ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should return 401 without auth token 5ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should return 401 with invalid token 6ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Authentication & Authorization > should create record with authenticated user ID 31ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should return correct response structure 41ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Response Schema Validation > should include Hijri dates in response 30ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should encrypt sensitive fields in database 37ms
   âœ“ POST /api/nisab-year-records - Contract Tests > Business Logic Validation > should set correct initial status to DRAFT 29ms
stdout | tests/contract/nisabYearRecords.put.test.ts
JWT_SECRET (jwt.ts): supersecret

stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update userNotes on DRAFT record
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldpx4w100020gqencwbewx4 

stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update userNotes on DRAFT record
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldpx4w100020gqencwbewx4 

[0mPUT /api/nisab-year-records/cmldpx4w100020gqencwbewx4 [32m200[0m 44.042 ms - -[0m
stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update totalLiabilities on DRAFT record
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldpx4yh00060gqeggwtv04c 

stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update totalLiabilities on DRAFT record
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldpx4yh00060gqeggwtv04c 

[0mPUT /api/nisab-year-records/cmldpx4yh00060gqeggwtv04c [32m200[0m 17.106 ms - -[0m
stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update UNLOCKED record
[AuditTrailService] INFO: Audit event recorded: EDITED for record cmldpx4zj000a0gqelzd5yykr 

stdout | tests/contract/nisabYearRecords.put.test.ts > PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record updated: cmldpx4zj000a0gqelzd5yykr 

[0mPUT /api/nisab-year-records/cmldpx4zj000a0gqelzd5yykr [32m200[0m 18.262 ms - -[0m
[0mPUT /api/nisab-year-records/cmldpx50j000e0gqezc2p8kf8 [33m409[0m 13.937 ms - 94[0m
[0mPUT /api/nisab-year-records/00000000-0000-0000-0000-000000000000 [33m404[0m 3.924 ms - 66[0m
[0mPUT /api/nisab-year-records/some-id [33m401[0m 0.626 ms - 94[0m
stdout | ../tests/contract/nisabYearRecords.getById.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a1fd4d5572bdf72b.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a1fd4d5572bdf72b.db

 â¯ tests/contract/nisabYearRecords.put.test.ts (6 tests | 1 failed) 269ms
   âœ“ PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update userNotes on DRAFT record 89ms
   Ã— PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update totalLiabilities on DRAFT record 37ms
     â†’ expected '0' to be '1500' // Object.is equality
   âœ“ PUT /api/nisab-year-records/:id - Contract Tests > Update Records > should update UNLOCKED record 36ms
   âœ“ PUT /api/nisab-year-records/:id - Contract Tests > Update Restriction Validation > should reject updates to FINALIZED records 50ms
   âœ“ PUT /api/nisab-year-records/:id - Contract Tests > Error Cases > should return 404 for non-existent record 11ms
   âœ“ PUT /api/nisab-year-records/:id - Contract Tests > Error Cases > should return 401 without auth token 5ms
stdout | ../tests/contract/nisabYearRecords.get.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-acf8d69d14b44644.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-acf8d69d14b44644.db

stdout | tests/contract/nisabYearRecords.getById.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.getById.test.ts
JWT_SECRET (jwt.ts): supersecret

[0mGET /api/nisab-year-records/cmldpx5f400020grtql12d6z5 [32m200[0m 20.134 ms - -[0m
[0mGET /api/nisab-year-records/cmldpx5f400020grtql12d6z5 [32m200[0m 7.027 ms - -[0m
[0mGET /api/nisab-year-records/00000000-0000-0000-0000-000000000000 [33m404[0m 9.346 ms - 66[0m
[0mGET /api/nisab-year-records/cmldpx5f400020grtql12d6z5 [33m401[0m 2.680 ms - 94[0m
[0mGET /api/nisab-year-records/cmldpx5f400020grtql12d6z5 [33m404[0m 11.393 ms - 66[0m
[0mGET /api/nisab-year-records/cmldpx5f400020grtql12d6z5 [32m200[0m 6.156 ms - -[0m
[0mGET /api/nisab-year-records/cmldpx5f400020grtql12d6z5 [32m200[0m 3.572 ms - -[0m
 â¯ tests/contract/nisabYearRecords.getById.test.ts (7 tests | 1 failed) 209ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Successful Retrieval > should return 200 with complete record data 50ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Successful Retrieval > should include live tracking for DRAFT records 19ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Error Cases > should return 404 for non-existent record ID 14ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Error Cases > should return 401 without auth token 8ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Error Cases > should return 404 when accessing another user's record 46ms
   âœ“ GET /api/nisab-year-records/:id - Contract Tests > Response Schema Validation > should return correct response structure 13ms
   Ã— GET /api/nisab-year-records/:id - Contract Tests > Response Schema Validation > should decrypt sensitive fields for display 14ms
     â†’ expected 'number' to be 'string' // Object.is equality
stdout | ../tests/contract/nisabYearRecords.getById.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.finalize.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-93bf306ea580b5f7.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-93bf306ea580b5f7.db

stdout | ../tests/contract/nisabYearRecords.get.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.finalize.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.getById.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mGET /api/nisab-year-records/cmldpx6vc00020gslluem0ist [33m401[0m 4.272 ms - 91[0m
[0mGET /api/nisab-year-records/cmldpx6vc00020gslluem0ist [33m401[0m 2.655 ms - 91[0m
[0mGET /api/nisab-year-records/cmldpx6vc00020gslluem0ist [33m401[0m 0.470 ms - 91[0m
[0mGET /api/nisab-year-records/nonexistent-id [33m401[0m 0.437 ms - 91[0m
[0mGET /api/nisab-year-records/cmldpx6vc00020gslluem0ist [33m401[0m 0.439 ms - 94[0m
[0mGET /api/nisab-year-records/cmldpx6vc00020gslluem0ist [33m401[0m 0.380 ms - 116[0m
 â¯ ../tests/contract/nisabYearRecords.getById.test.ts (6 tests | 6 failed) 123ms
   Ã— GET /api/nisab-year-records/:id > should return 200 with record details 38ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— GET /api/nisab-year-records/:id > should include audit trail in response 10ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— GET /api/nisab-year-records/:id > should include live tracking fields for DRAFT records 6ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— GET /api/nisab-year-records/:id > should return 404 for non-existent record 5ms
     â†’ expected 401 to be 404 // Object.is equality
   Ã— GET /api/nisab-year-records/:id > should return 401 for unauthenticated request 7ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   Ã— GET /api/nisab-year-records/:id > should not return records of other users 15ms
     â†’ expected 401 to be 404 // Object.is equality
stdout | ../tests/contract/nisabYearRecords.get.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.unlock.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-83bfd41352d156f8.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-83bfd41352d156f8.db

[0mGET /api/nisab-year-records [32m200[0m 12.197 ms - 820[0m
[0mGET /api/nisab-year-records?status=DRAFT [32m200[0m 5.629 ms - 820[0m
[0mGET /api/nisab-year-records?year=2025 [32m200[0m 4.937 ms - 820[0m
[0mGET /api/nisab-year-records [33m401[0m 0.548 ms - 94[0m
[0mGET /api/nisab-year-records?status=FINALIZED&year=1900 [32m200[0m 5.656 ms - 86[0m
 â¯ ../tests/contract/nisabYearRecords.get.test.ts (5 tests | 5 failed) 139ms
   Ã— GET /api/nisab-year-records > should return 200 with all records for authenticated user 40ms
     â†’ expected false to be true // Object.is equality
   Ã— GET /api/nisab-year-records > should filter records by status=DRAFT 15ms
     â†’ expected { records: [ { â€¦(28) } ], â€¦(4) } to deeply equal ArrayContaining{â€¦}
   Ã— GET /api/nisab-year-records > should filter records by year parameter 12ms
     â†’ actual value must be number or bigint, received "undefined"
   Ã— GET /api/nisab-year-records > should return 401 for unauthenticated request 6ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   Ã— GET /api/nisab-year-records > should return empty array when no records match filter 11ms
     â†’ expected { records: [], total: +0, â€¦(3) } to deeply equal []
stdout | ../tests/unit/encryption.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a172b2da49c59a81.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a172b2da49c59a81.db

stdout | ../tests/contract/nisabYearRecords.finalize.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 â¯ ../tests/unit/encryption.test.ts (29 tests | 2 failed | 1 skipped) 111ms
   âœ“ EncryptionService > Constructor and Initialization > should have encryption key configured 2ms
   âœ“ EncryptionService > Constructor and Initialization > should throw error with missing encryption key 1ms
   âœ“ EncryptionService > Constructor and Initialization > should throw error with invalid encryption key length 0ms
   â†“ EncryptionService > Constructor and Initialization > should create singleton instance
   âœ“ EncryptionService > Basic Encryption/Decryption > should encrypt and decrypt text data 4ms
   âœ“ EncryptionService > Basic Encryption/Decryption > should encrypt and decrypt JSON objects 1ms
   âœ“ EncryptionService > Basic Encryption/Decryption > should encrypt and decrypt arrays 1ms
   Ã— EncryptionService > Basic Encryption/Decryption > should handle empty strings 10ms
     â†’ expected '{"encryptedData":"","iv":"1182bc3b90fâ€¦' to be '' // Object.is equality
   âœ“ EncryptionService > Basic Encryption/Decryption > should handle null and undefined values in objects 1ms
   âœ“ EncryptionService > Security Properties > should generate different IV for each encryption 1ms
   âœ“ EncryptionService > Security Properties > should produce different ciphertext for identical inputs 1ms
   âœ“ EncryptionService > Security Properties > should handle sensitive financial data correctly 1ms
   âœ“ EncryptionService > Security Properties > should use AES-256-GCM algorithm 1ms
   âœ“ EncryptionService > Error Handling > should throw error for invalid encrypted data format 4ms
   âœ“ EncryptionService > Error Handling > should throw error for invalid IV format 1ms
   âœ“ EncryptionService > Error Handling > should throw error for missing encrypted data 0ms
   Ã— EncryptionService > Error Handling > should throw error for missing IV 3ms
     â†’ expected [Function] to throw an error
   âœ“ EncryptionService > Error Handling > should handle JSON parsing errors gracefully 1ms
   âœ“ EncryptionService > Data Types and Edge Cases > should handle very long strings 0ms
   âœ“ EncryptionService > Data Types and Edge Cases > should handle unicode characters 0ms
   âœ“ EncryptionService > Data Types and Edge Cases > should handle special characters and symbols 0ms
   âœ“ EncryptionService > Data Types and Edge Cases > should handle complex nested objects 0ms
   âœ“ EncryptionService > Data Types and Edge Cases > should handle numeric precision correctly 0ms
   âœ“ EncryptionService > Performance and Memory > should encrypt/decrypt within reasonable time limits 6ms
   âœ“ EncryptionService > Performance and Memory > should not leak memory with repeated operations 64ms
   âœ“ EncryptionService > Islamic Compliance Data Protection > should properly encrypt Zakat calculation data 2ms
   âœ“ EncryptionService > Islamic Compliance Data Protection > should encrypt user profile data securely 1ms
   âœ“ EncryptionService > Backwards Compatibility > should maintain consistent encryption format 1ms
   âœ“ EncryptionService > Backwards Compatibility > should decrypt data encrypted with same algorithm 1ms
[0mPOST /api/nisab-year-records/cmldpx7nf00020gu54rbsxiai/finalize [33m401[0m 15.293 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldpx7nl00040gu56bfhs4g6/finalize [33m401[0m 1.406 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldpx7nl00040gu56bfhs4g6/finalize [33m401[0m 0.748 ms - 91[0m
[0mPOST /api/nisab-year-records/nonexistent-id/finalize [33m401[0m 0.718 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldpx7nf00020gu54rbsxiai/finalize [33m401[0m 0.677 ms - 94[0m
[0mPOST /api/nisab-year-records/cmldpx7nf00020gu54rbsxiai/finalize [33m401[0m 0.711 ms - 91[0m
stdout | ../tests/contract/nisabYearRecords.unlock.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 â¯ ../tests/contract/nisabYearRecords.finalize.test.ts (6 tests | 5 failed) 130ms
   Ã— POST /api/nisab-year-records/:id/finalize > should finalize a DRAFT record when Hawl is complete 47ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/finalize > should not finalize when Hawl is incomplete 10ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/finalize > should allow override with acknowledgePremature flag 6ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/finalize > should return 404 for non-existent record 7ms
     â†’ expected 401 to be 404 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/finalize > should return 401 for unauthenticated request 9ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   âœ“ POST /api/nisab-year-records/:id/finalize > should create audit trail entry for finalization 6ms
stdout | ../tests/contract/nisabYearRecords.post.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6b45f8b9625c1c2a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6b45f8b9625c1c2a.db

stdout | ../tests/contract/nisabYearRecords.put.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b0d50835691a9064.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b0d50835691a9064.db

stdout | ../tests/contract/nisabYearRecords.post.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.put.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.unlock.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/nisab-year-records/cmldpx90d00020guxekmilvsk/unlock [33m401[0m 12.193 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldpx90d00020guxekmilvsk/unlock [33m401[0m 1.302 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldpx90d00020guxekmilvsk/unlock [33m401[0m 1.322 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldpx90d00020guxekmilvsk/unlock [33m401[0m 0.960 ms - 91[0m
[0mPOST /api/nisab-year-records/nonexistent-id/unlock [33m401[0m 0.804 ms - 91[0m
[0mPOST /api/nisab-year-records/cmldpx90d00020guxekmilvsk/unlock [33m401[0m 0.828 ms - 94[0m
[0mPOST /api/nisab-year-records/cmldpx90d00020guxekmilvsk/unlock [33m401[0m 0.756 ms - 91[0m
 â¯ ../tests/contract/nisabYearRecords.unlock.test.ts (7 tests | 5 failed) 118ms
   Ã— POST /api/nisab-year-records/:id/unlock > should unlock a FINALIZED record with valid reason 40ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/unlock > should reject unlock reason shorter than 10 characters 6ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/unlock > should reject unlock without reason 6ms
     â†’ expected 401 to be 400 // Object.is equality
   âœ“ POST /api/nisab-year-records/:id/unlock > should create audit trail entry with unlock reason 5ms
   Ã— POST /api/nisab-year-records/:id/unlock > should return 404 for non-existent record 5ms
     â†’ expected 401 to be 404 // Object.is equality
   Ã— POST /api/nisab-year-records/:id/unlock > should return 401 for unauthenticated request 7ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   âœ“ POST /api/nisab-year-records/:id/unlock > should return encrypted unlock reason in audit trail 4ms
stdout | ../tests/contract/nisabYearRecords.delete.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-90424a6885e9c5ce.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-90424a6885e9c5ce.db

stdout | ../tests/contract/nisabYearRecords.post.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/nisabYearRecords.put.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/nisab-year-records [33m401[0m 29.385 ms - 91[0m
[0mPOST /api/nisab-year-records [33m401[0m 1.851 ms - 91[0m
[0mPOST /api/nisab-year-records [33m401[0m 0.759 ms - 91[0m
[0mPOST /api/nisab-year-records [33m401[0m 0.916 ms - 91[0m
[0mPOST /api/nisab-year-records [33m401[0m 6.153 ms - 94[0m
[0mPOST /api/nisab-year-records [33m401[0m 0.795 ms - 91[0m
 â¯ ../tests/contract/nisabYearRecords.post.test.ts (6 tests | 6 failed) 226ms
   Ã— POST /api/nisab-year-records > should create a new DRAFT record with valid data 95ms
     â†’ expected 401 to be 201 // Object.is equality
   Ã— POST /api/nisab-year-records > should reject request without required hawlStartDate 8ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— POST /api/nisab-year-records > should reject request without required nisabBasis 19ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— POST /api/nisab-year-records > should reject invalid nisabBasis value 17ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— POST /api/nisab-year-records > should return 401 for unauthenticated request 18ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   Ã— POST /api/nisab-year-records > should calculate nisabThresholdAtStart if not provided 16ms
     â†’ expected 401 to be 201 // Object.is equality
[0mPUT /api/nisab-year-records/cmldpx9zl00020gws9yl8dw3y [33m401[0m 12.231 ms - 91[0m
[0mPUT /api/nisab-year-records/cmldpx9zl00020gws9yl8dw3y [33m401[0m 1.605 ms - 91[0m
[0mPUT /api/nisab-year-records/cmldpx9zl00020gws9yl8dw3y [33m401[0m 0.754 ms - 91[0m
[0mPUT /api/nisab-year-records/cmldpx9zl00020gws9yl8dw3y [33m401[0m 0.646 ms - 91[0m
[0mPUT /api/nisab-year-records/nonexistent-id [33m401[0m 1.225 ms - 91[0m
[0mPUT /api/nisab-year-records/cmldpx9zl00020gws9yl8dw3y [33m401[0m 0.647 ms - 94[0m
 â¯ ../tests/contract/nisabYearRecords.put.test.ts (6 tests | 6 failed) 133ms
   Ã— PUT /api/nisab-year-records/:id > should update record fields for DRAFT status 42ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— PUT /api/nisab-year-records/:id > should transition from DRAFT to FINALIZED 7ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— PUT /api/nisab-year-records/:id > should require unlock reason when transitioning to UNLOCKED 6ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— PUT /api/nisab-year-records/:id > should reject invalid status transitions 7ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— PUT /api/nisab-year-records/:id > should return 404 for non-existent record 6ms
     â†’ expected 401 to be 404 // Object.is equality
   Ã— PUT /api/nisab-year-records/:id > should return 401 for unauthenticated request 7ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
stdout | ../tests/contract/nisabYearRecords.delete.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/unit/zakatService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-919079237ff7173c.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-919079237ff7173c.db

stdout | src/__tests__/calendarService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b28310c99f924385.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b28310c99f924385.db

 â¯ src/__tests__/calendarService.test.ts (37 tests | 1 failed) 31ms
   âœ“ CalendarService > gregorianToHijri conversion > should convert known Gregorian dates to Hijri dates accurately 3ms
   âœ“ CalendarService > gregorianToHijri conversion > should convert January 1, 2024 to a valid Hijri date 1ms
   âœ“ CalendarService > gregorianToHijri conversion > should convert October 9, 2025 (current date) to valid Hijri 0ms
   âœ“ CalendarService > gregorianToHijri conversion > should handle year boundary conversions correctly 1ms
   âœ“ CalendarService > gregorianToHijri conversion > should handle month boundary conversions correctly 1ms
   âœ“ CalendarService > gregorianToHijri conversion > should return valid month names 1ms
   Ã— CalendarService > getCurrentIslamicDate > should return current Hijri date 9ms
     â†’ expected undefined to be truthy
   âœ“ CalendarService > formatHijriDate > should format Hijri date correctly 0ms
   âœ“ CalendarService > formatHijriDate > should format all month names correctly 1ms
   âœ“ CalendarService > formatHijriDate > should handle different day values 0ms
   âœ“ CalendarService > isHijriLeapYear > should correctly identify leap years in 30-year cycle 1ms
   âœ“ CalendarService > isHijriLeapYear > should work for years beyond first cycle 0ms
   âœ“ CalendarService > isHijriLeapYear > should handle year 0 0ms
   âœ“ CalendarService > getDaysInHijriMonth > should return 30 days for odd months 0ms
   âœ“ CalendarService > getDaysInHijriMonth > should return 29 days for even months (except month 12 in leap years) 0ms
   âœ“ CalendarService > getDaysInHijriMonth > should return 29 days for month 12 in leap years 0ms
   âœ“ CalendarService > getDaysInHijriMonth > should return 30 days for month 12 in non-leap years 0ms
   âœ“ CalendarService > getDaysInHijriMonth > should handle all 12 months correctly 0ms
   âœ“ CalendarService > getLunarYearAdjustment > should return correct lunar year adjustment factor 0ms
   âœ“ CalendarService > getLunarYearAdjustment > should be less than 1 (lunar year is shorter) 0ms
   âœ“ CalendarService > getCalendarInfo > should return complete calendar calculation information 1ms
   âœ“ CalendarService > getCalendarInfo > should include valid Hijri date components 0ms
   âœ“ CalendarService > getCalendarInfo > should return lunar adjustment factor by default 0ms
   âœ“ CalendarService > calculateZakatYearPeriod > should calculate lunar year period correctly 0ms
   âœ“ CalendarService > calculateZakatYearPeriod > should calculate solar year period correctly 0ms
   âœ“ CalendarService > calculateZakatYearPeriod > should handle leap years correctly for solar calendar 1ms
   âœ“ CalendarService > calculateZakatYearPeriod > should calculate different end dates for lunar vs solar 0ms
   âœ“ CalendarService > Edge cases and error handling > should handle very old dates 0ms
   âœ“ CalendarService > Edge cases and error handling > should handle future dates 0ms
   âœ“ CalendarService > Edge cases and error handling > should handle Islamic epoch date 0ms
   âœ“ CalendarService > should handle midnight dates 1ms
   âœ“ CalendarService > should handle end of day dates 0ms
   âœ“ CalendarService > Zakat calculation integration > should provide correct adjustment factor for zakat calculations 0ms
   âœ“ CalendarService > Zakat calculation integration > should calculate next zakat date correctly 0ms
   âœ“ CalendarService > Performance and consistency > should return consistent results for same date 0ms
   âœ“ CalendarService > Performance and consistency > should handle rapid sequential calls 1ms
   âœ“ CalendarService > Performance and consistency > should complete conversion in reasonable time 0ms
stdout | tests/unit/services/hawlTrackingService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-51df6abf8dbd957d.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-51df6abf8dbd957d.db

stdout | ../tests/unit/zakatService.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 â¯ ../tests/unit/zakatService.test.ts (27 tests | 7 failed) 50ms
   âœ“ Comprehensive ZakatService Methodology Tests > Nisab Calculations by Method > Hanafi method uses silver nisab exclusively 2ms
   âœ“ Comprehensive ZakatService Methodology Tests > Nisab Calculations by Method > Shafi'i method uses dual minimum nisab 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Nisab Calculations by Method > Standard method uses minimum with specific basis tracking 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Nisab Calculations by Method > Custom method allows configurable nisab approach 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Edge Case Tests > Nisab Boundary Conditions > should handle assets exactly at nisab threshold 3ms
   âœ“ Comprehensive ZakatService Methodology Tests > Edge Case Tests > Nisab Boundary Conditions > should handle assets just below nisab threshold 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Edge Case Tests > Nisab Boundary Conditions > should handle assets just above nisab threshold 0ms
   Ã— Comprehensive ZakatService Methodology Tests > Edge Case Tests > Debt Deduction Tests > should apply comprehensive debt deduction for Hanafi method 18ms
     â†’ expected 'conservative' to be 'comprehensive' // Object.is equality
   Ã— Comprehensive ZakatService Methodology Tests > Edge Case Tests > Debt Deduction Tests > should apply conservative debt deduction for Shafi'i method 2ms
     â†’ expected 'comprehensive' to be 'conservative' // Object.is equality
   âœ“ Comprehensive ZakatService Methodology Tests > Edge Case Tests > Debt Deduction Tests > should handle zero debt scenario 1ms
   Ã— Comprehensive ZakatService Methodology Tests > Edge Case Tests > Business Asset Inclusion Tests > should include business assets comprehensively in Hanafi method 4ms
     â†’ expected [ 'Hanafi methodology applied' ] to include 'Comprehensive business asset inclusion'
   âœ“ Comprehensive ZakatService Methodology Tests > Edge Case Tests > Business Asset Inclusion Tests > should categorize business assets detailed for Shafi'i method 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Cross-Method Validation and Consistency > should produce logically consistent results across all methods 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Cross-Method Validation and Consistency > should demonstrate Hanafi vs Standard nisab differences 0ms
   Ã— Comprehensive ZakatService Methodology Tests > Cross-Method Validation and Consistency > should validate method-specific source citations 1ms
     â†’ expected [ Array(1) ] to include 'Al-Hidayah by al-Marghinani'
   âœ“ Comprehensive ZakatService Methodology Tests > Cross-Method Validation and Consistency > should ensure all methods handle same asset categories 3ms
   Ã— Comprehensive ZakatService Methodology Tests > Method-Specific Rule Validation > should apply Hanafi-specific rules correctly 1ms
     â†’ expected [ 'Hanafi methodology applied' ] to include 'Comprehensive business asset inclusion'
   Ã— Comprehensive ZakatService Methodology Tests > Method-Specific Rule Validation > should apply Shafi'i-specific rules correctly 1ms
     â†’ expected 'silver' to be 'dual_minimum' // Object.is equality
   Ã— Comprehensive ZakatService Methodology Tests > Method-Specific Rule Validation > should apply Standard method (AAOIFI) rules correctly 1ms
     â†’ expected [ Array(1) ] to include 'AAOIFI FAS 9'
   âœ“ Comprehensive ZakatService Methodology Tests > Custom Method Configuration Tests > should handle custom nisab values 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Custom Method Configuration Tests > should validate custom method configuration requirements 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Performance and Error Handling Tests > should handle large asset portfolios efficiently 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Performance and Error Handling Tests > should handle invalid method gracefully 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Performance and Error Handling Tests > should handle empty asset list 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Performance and Error Handling Tests > should handle extreme price scenarios 0ms
   âœ“ Comprehensive ZakatService Methodology Tests > Integration and Comprehensive Scenarios > should handle complete zakat calculation scenario 1ms
   âœ“ Comprehensive ZakatService Methodology Tests > Integration and Comprehensive Scenarios > should provide consistent calculation breakdown structure 1ms
stdout | tests/unit/services/hawlTrackingService.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > detectNisabAchievement > should process users and create DRAFT records if Nisab reached
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > detectNisabAchievement > should process users and create DRAFT records if Nisab reached
[HawlTrackingService] INFO: Nisab detection complete: 0 DRAFT records created 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > handleWealthChange > should start Hawl if wealth >= Nisab and no active Hawl
[HawlTrackingService] INFO: Handling wealth change for user user1 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > handleWealthChange > should interrupt Hawl if wealth < Nisab and active Hawl exists
[HawlTrackingService] INFO: Handling wealth change for user user1 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > handleWealthChange > should do nothing if wealth < Nisab and no active Hawl
[HawlTrackingService] INFO: Handling wealth change for user user1 

stdout | tests/unit/services/hawlTrackingService.test.ts > HawlTrackingService > handleWealthChange > should do nothing if wealth >= Nisab and active Hawl exists
[HawlTrackingService] INFO: Handling wealth change for user user1 

 â¯ tests/unit/services/hawlTrackingService.test.ts (9 tests | 3 failed) 65ms
   âœ“ HawlTrackingService > calculateHawlCompletionDate > should add 354 days to start date for lunar year 4ms
   âœ“ HawlTrackingService > toHijriDate > should convert Gregorian date to Hijri format 4ms
   Ã— HawlTrackingService > detectNisabAchievement > should process users and create DRAFT records if Nisab reached 18ms
     â†’ expected +0 to be 1 // Object.is equality
   âœ“ HawlTrackingService > isHawlComplete > should return true if 354 days have passed 2ms
   âœ“ HawlTrackingService > isHawlComplete > should return false if 354 days have not passed 2ms
   Ã— HawlTrackingService > handleWealthChange > should start Hawl if wealth >= Nisab and no active Hawl 7ms
     â†’ expected "spy" to be called at least once
   Ã— HawlTrackingService > handleWealthChange > should interrupt Hawl if wealth < Nisab and active Hawl exists 8ms
     â†’ expected "spy" to be called with arguments: [ { where: { id: 'record1' } } ][90m

Number of calls: [1m0[22m
[39m
   âœ“ HawlTrackingService > handleWealthChange > should do nothing if wealth < Nisab and no active Hawl 13ms
   âœ“ HawlTrackingService > handleWealthChange > should do nothing if wealth >= Nisab and active Hawl exists 3ms
stdout | src/__tests__/MetalPriceScraperService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-7c10e85c363c3d9a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-7c10e85c363c3d9a.db

stdout | ../tests/unit/islamic-calculation.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-02417861fd639f0a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-02417861fd639f0a.db

 â¯ ../tests/unit/islamic-calculation.test.ts (30 tests | 26 failed | 4 skipped) 26ms
   â†“ IslamicCalculationService > Nisab Threshold Calculations > should calculate correct gold nisab threshold
   â†“ IslamicCalculationService > Nisab Threshold Calculations > should calculate correct silver nisab threshold
   â†“ IslamicCalculationService > Nisab Threshold Calculations > should use lower of gold and silver nisab for cash calculations
   â†“ IslamicCalculationService > Nisab Threshold Calculations > should handle different currency conversions
   Ã— IslamicCalculationService > Zakat Rate Calculations > should apply 2.5% rate for cash and cash equivalents 8ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Zakat Rate Calculations > should apply 2.5% rate for gold 1ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Zakat Rate Calculations > should apply 2.5% rate for silver 1ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Zakat Rate Calculations > should apply 2.5% rate for business assets 1ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Zakat Rate Calculations > should not apply zakat to property for personal use 1ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Zakat Rate Calculations > should handle cryptocurrency as cash equivalent 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Methodology-Specific Calculations > Hanafi Methodology > should use specific nisab calculations for Hanafi school 5ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Methodology-Specific Calculations > Hanafi Methodology > should apply Hanafi rules for mixed assets 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Methodology-Specific Calculations > Shafi Methodology > should use Shafi-specific rules for calculations 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Methodology-Specific Calculations > Maliki Methodology > should apply Maliki school interpretations 2ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Methodology-Specific Calculations > Hanbali Methodology > should follow Hanbali jurisprudence rules 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Lunar Calendar Considerations > should calculate correct lunar year completion 1ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Lunar Calendar Considerations > should handle incomplete lunar year 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Lunar Calendar Considerations > should adjust for Hijri calendar differences 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Complex Asset Calculations > should handle mixed asset portfolio calculation 1ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Complex Asset Calculations > should exclude non-zakatable business assets 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Complex Asset Calculations > should handle debt deductions correctly 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Edge Cases and Error Handling > should handle zero or negative asset values 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Edge Cases and Error Handling > should handle assets below nisab threshold 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Edge Cases and Error Handling > should validate input data types 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Edge Cases and Error Handling > should handle very large numbers correctly 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Edge Cases and Error Handling > should maintain precision with decimal calculations 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Historical Accuracy Validation > should match traditional Islamic scholarship calculations 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Historical Accuracy Validation > should validate against contemporary Islamic finance standards 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Performance and Optimization > should complete calculations within reasonable time 0ms
     â†’ IslamicCalculationService is not a constructor
   Ã— IslamicCalculationService > Performance and Optimization > should cache nisab calculations for performance 0ms
     â†’ IslamicCalculationService is not a constructor
 â¯ src/__tests__/MetalPriceScraperService.test.ts (7 tests | 2 failed) 41ms
   âœ“ MetalPriceScraperService > scrapeGoldPrice > should extract gold price from page title 14ms
   âœ“ MetalPriceScraperService > scrapeGoldPrice > should extract gold price from body as fallback 3ms
   âœ“ MetalPriceScraperService > scrapeGoldPrice > should throw error if price cannot be found 3ms
   Ã— MetalPriceScraperService > scrapeSilverPrice > should extract silver price from gram format in title 9ms
     â†’ Could not find silver price on https://www.livepriceofgold.com/silver-price/us.html. Check if page structure changed.
   Ã— MetalPriceScraperService > scrapeSilverPrice > should convert ounce price if gram price missing 2ms
     â†’ Could not find silver price on https://www.livepriceofgold.com/silver-price/us.html. Check if page structure changed.
   âœ“ MetalPriceScraperService > scrapeSilverPrice > should ignore high values (gold price) in body and throw or find correct silver price 4ms
   âœ“ MetalPriceScraperService > scrapeSilverPrice > should throw error if only high value (gold) is found 2ms
stdout | ../tests/contract/assets-put.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-3937fce72ebad6bd.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-3937fce72ebad6bd.db

stdout | ../tests/contract/nisabYearRecords.delete.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 â¯ ../tests/contract/assets-put.test.ts (12 tests | 12 skipped) 14ms
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should require authentication
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should update asset with valid data and return standardized response
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should handle asset not found
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should handle unauthorized access to other users assets
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should validate asset value when provided
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should validate currency format when provided
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should validate description length when provided
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should validate notes length when provided
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should not allow changing asset type
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should handle partial updates
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should handle empty update request
   â†“ Contract Test: PUT /api/assets/:id > PUT /api/assets/:id > should validate UUID format for asset ID
stdout | tests/unit/EncryptionServiceAltSeparator.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-fc90ea7778f3fac7.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-fc90ea7778f3fac7.db

[0mDELETE /api/nisab-year-records/cmldpxbih00020gxsy3vb82m6 [33m401[0m 5.289 ms - 91[0m
[0mDELETE /api/nisab-year-records/cmldpxbip00040gxso6ty5l5x [33m401[0m 1.099 ms - 91[0m
[0mDELETE /api/nisab-year-records/nonexistent-id [33m401[0m 0.494 ms - 91[0m
[0mDELETE /api/nisab-year-records/cmldpxbih00020gxsy3vb82m6 [33m401[0m 0.432 ms - 94[0m
 â¯ tests/unit/EncryptionServiceAltSeparator.test.ts (2 tests | 1 failed) 27ms
   âœ“ EncryptionService alternative separator handling > should decrypt encrypted payloads where separator has been replaced with `.=`, and isEncrypted should detect it 13ms
   Ã— EncryptionService alternative separator handling > PaymentRecordService should decrypt fields that use ".=" separator 12ms
     â†’ expected 3 to be close to 12.34, received difference is 9.34, but expected 0.005
[0mDELETE /api/nisab-year-records/cmldpxbih00020gxsy3vb82m6 [33m401[0m 0.463 ms - 91[0m
 â¯ ../tests/contract/nisabYearRecords.delete.test.ts (5 tests | 4 failed) 136ms
   Ã— DELETE /api/nisab-year-records/:id > should delete a DRAFT record 45ms
     â†’ expected 401 to be 200 // Object.is equality
   Ã— DELETE /api/nisab-year-records/:id > should not delete FINALIZED records 8ms
     â†’ expected 401 to be 400 // Object.is equality
   Ã— DELETE /api/nisab-year-records/:id > should return 404 for non-existent record 7ms
     â†’ expected 401 to be 404 // Object.is equality
   Ã— DELETE /api/nisab-year-records/:id > should return 401 for unauthenticated request 13ms
     â†’ expected { success: false, error: { â€¦(2) } } to have property "error" with value 'UNAUTHORIZED'
   âœ“ DELETE /api/nisab-year-records/:id > should not return deleted record in subsequent GET 4ms
stdout | ../tests/integration/assetRefresh.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-cfa1cb7280d589c1.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-cfa1cb7280d589c1.db

stdout | ../tests/integration/asset-management-enhancements.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-571511ac453bddc9.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-571511ac453bddc9.db

stdout | ../tests/integration/asset-management.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c91504c7427b0a62.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c91504c7427b0a62.db

stdout | ../tests/integration/errorHandling.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-713e821a7fec5491.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-713e821a7fec5491.db

stdout | ../tests/integration/finalization.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-77e6f4f042b27286.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-77e6f4f042b27286.db

stdout | ../tests/integration/assetRefresh.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/integration/hawlDetectionAssets.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-79dfaabaf11ab6c9.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-79dfaabaf11ab6c9.db

stdout | ../tests/integration/hawlInterruption.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f39b0d01023e9dbf.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f39b0d01023e9dbf.db

stdout | ../tests/integration/liveWealth.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5f39bed3d0f8d4ea.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5f39bed3d0f8d4ea.db

stdout | ../tests/integration/nisabAchievement.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-7343f45a0aafe404.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-7343f45a0aafe404.db

stdout | ../tests/integration/statusTransitions.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8f89cefff85b05c0.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8f89cefff85b05c0.db

stdout | ../tests/integration/unlockEditRefinalize.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6a5f636c6dfa2ebb.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6a5f636c6dfa2ebb.db

stdout | ../tests/integration/user-registration.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-20bbb2728c935af7.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-20bbb2728c935af7.db

stdout | ../tests/performance/api-performance.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1bae5b1bcecb7d49.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1bae5b1bcecb7d49.db

stdout | ../tests/unit/data-migration.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-64a59abd37cff793.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-64a59abd37cff793.db

stdout | ../tests/integration/assetRefresh.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/unit/zakat-engine.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ff2e078fa56587ed.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ff2e078fa56587ed.db

 â¯ ../tests/integration/assetRefresh.test.ts (8 tests | 8 skipped) 4ms
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return current assets for DRAFT record
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for UNLOCKED record
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 404 for non-existent record
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 403 when accessing another user's record
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should handle assets deleted after record creation
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
   â†“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should require authentication
stdout | ../tests/unit/components/AuditTrailView.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-60737b1040bb9a95.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-60737b1040bb9a95.db

stdout | ../tests/unit/components/FinalizationModal.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-3997c4e99318145b.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-3997c4e99318145b.db

stdout | ../tests/unit/components/HawlProgressIndicator.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-e2f4e7843cacd898.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-e2f4e7843cacd898.db

stdout | ../tests/unit/components/NisabComparisonWidget.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b10aeb35a6345a2d.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b10aeb35a6345a2d.db

stdout | ../tests/unit/components/UnlockReasonDialog.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-096a405479b7cfb5.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-096a405479b7cfb5.db

stdout | ../tests/unit/security/payment-security-audit.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6f3f69f9eb5433ad.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-6f3f69f9eb5433ad.db

stdout | ../tests/unit/services/auditTrailService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b480bbc1474510e1.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b480bbc1474510e1.db

stdout | ../tests/unit/services/hawlTrackingService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-803dedc10bcfae08.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-803dedc10bcfae08.db

stdout | ../tests/unit/services/nisabCalculationService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-28ecb9cc0697f69b.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-28ecb9cc0697f69b.db

stdout | ../tests/unit/services/nisabYearRecordService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a2ef491cb6d7a89e.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a2ef491cb6d7a89e.db

stdout | ../tests/unit/services/wealthAggregationService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1538f70ca68fb613.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1538f70ca68fb613.db

stdout | tests/integration/hawlDetectionAssets.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f5ac7f98fde233b1.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f5ac7f98fde233b1.db

stdout | tests/integration/hawlDetectionAssets.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/assetRefresh.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-acb342c6de280be3.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-acb342c6de280be3.db

stdout | ../tests/contract/assets-delete.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-0e0da8cd4b79a635.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-0e0da8cd4b79a635.db

stdout | tests/integration/assetRefresh.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/assets-delete.test.ts > Contract Test: DELETE /api/assets/:id
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionAssets.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/assetRefresh.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | ../tests/contract/assets-delete.test.ts > Contract Test: DELETE /api/assets/:id
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 397.235 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 369.523 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 376.371 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 328.275 ms - -[0m
[0mPOST /api/assets [32m201[0m 21.438 ms - 506[0m
[0mPOST /api/assets [32m201[0m 25.306 ms - 500[0m
[0mPOST /api/assets [32m201[0m 33.038 ms - 503[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create DRAFT record with assetBreakdown populated when Nisab achieved
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create DRAFT record with assetBreakdown populated when Nisab achieved
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create DRAFT record with assetBreakdown populated when Nisab achieved
[HawlTrackingService] INFO: Created DRAFT record for user cmldpxgqg00000gg9wsn20ldo, wealth: 10500, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create DRAFT record with assetBreakdown populated when Nisab achieved
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

[0mPOST /api/auth/login [32m200[0m 333.826 ms - -[0m
[0mPOST /api/assets [32m201[0m 13.663 ms - 524[0m
[0mDELETE /api/assets/cmldpxh5w00040ghnwj8hx7ut [33m401[0m 0.885 ms - 94[0m
[0mPOST /api/assets [32m201[0m 8.369 ms - 530[0m
[0mDELETE /api/assets/cmldpxh6g00060ghn91dt5jec [32m200[0m 9.618 ms - 811[0m
[0mDELETE /api/assets/12345678-1234-4123-a123-123456789012 [33m404[0m 1.898 ms - 150[0m
[0mDELETE /api/assets/cmldpxh5w00040ghnwj8hx7ut [33m403[0m 0.483 ms - 89[0m
[0mDELETE /api/assets/invalid-uuid [33m400[0m 0.774 ms - 237[0m
[0mPOST /api/auth/login [32m200[0m 329.495 ms - -[0m
[0mPOST /api/assets [32m201[0m 12.437 ms - 537[0m
[0mDELETE /api/assets/cmldpxh7p00080ghnd3nivz9i [32m200[0m 10.760 ms - 818[0m
[0mPOST /api/assets [32m201[0m 21.637 ms - 503[0m
[0mGET /api/assets/cmldpxh7p00080ghnd3nivz9i [33m404[0m 2.662 ms - 150[0m
[0mPOST /api/assets [32m201[0m 27.400 ms - 508[0m
[0mPOST /api/assets [32m201[0m 11.804 ms - 530[0m
[0mDELETE /api/assets/cmldpxh8l000a0ghn9rpb2mer [32m200[0m 8.899 ms - 811[0m
[0mPOST /api/assets [32m201[0m 11.674 ms - 510[0m
[0mPOST /api/assets [32m201[0m 10.289 ms - 529[0m
[0mGET /api/nisab-year-records/cmldpxh8p00080ghhnhm8o2de/assets/refresh [32m200[0m 13.907 ms - 662[0m
[0mDELETE /api/assets/cmldpxh9b000c0ghnjr4vwel7 [32m200[0m 8.033 ms - 810[0m
[0mPOST /api/assets [32m201[0m 12.468 ms - 530[0m
[0mDELETE /api/assets/cmldpxha8000e0ghn07dvnrov?force=true [32m200[0m 12.626 ms - 765[0m
[0mPOST /api/assets [32m201[0m 9.707 ms - 532[0m
[0mDELETE /api/assets/cmldpxhb3000g0ghnlnfq9gar [32m200[0m 9.239 ms - 813[0m
[0mPOST /api/assets [32m201[0m 8.746 ms - 535[0m
[0mDELETE /api/assets/cmldpxhbq000i0ghnsts62ug4 [32m200[0m 8.824 ms - 816[0m
[0mDELETE /api/assets/cmldpxhbq000i0ghnsts62ug4 [33m404[0m 13.392 ms - 150[0m
 âœ“ ../tests/contract/assets-delete.test.ts (12 tests | 1 skipped) 3206ms
[0mPOST /api/auth/register [32m201[0m 344.811 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxgqg00000gg9wsn20ldo 

stdout | ../tests/contract/auth-login.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-66f4d72fa1a7de63.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-66f4d72fa1a7de63.db

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxgqg00000gg9wsn20ldo 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxgqg00000gg9wsn20ldo 

[0mPOST /api/auth/register [32m201[0m 356.217 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 375.354 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 14.438 ms - 506[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[HawlTrackingService] INFO: Created DRAFT record for user cmldpxhd2000d0gg9k9279m34, wealth: 7500.5, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxgx200000ghhidmh0tca 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxgx200000ghhidmh0tca 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxgx200000ghhidmh0tca 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 379.801 ms - -[0m
stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mGET /api/nisab-year-records/cmldpxhvj000f0ghh6r0fvckl/assets/refresh [33m400[0m 2.893 ms - 96[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/register [32m201[0m 355.077 ms - -[0m
stdout | ../tests/contract/auth-login.test.ts > Contract Test: POST /api/auth/login
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 338.402 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxhd2000d0gg9k9279m34 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 350.945 ms - -[0m
[0mPOST /api/assets [32m201[0m 9.966 ms - 495[0m
[0mPOST /api/assets [32m201[0m 9.968 ms - 515[0m
[0mPOST /api/assets [32m201[0m 10.199 ms - 495[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[HawlTrackingService] INFO: Created DRAFT record for user cmldpxhzy000m0gg9fbadqrty, wealth: 8000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

[0mPOST /api/auth/login [32m200[0m 329.828 ms - -[0m
[0mGET /api/nisab-year-records/cmldpxifa000k0ghh9dxk1xli/assets/refresh [33m400[0m 6.434 ms - 96[0m
[0mPOST /api/auth/register [32m201[0m 339.077 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 340.157 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxhzy000m0gg9fbadqrty 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxhzy000m0gg9fbadqrty 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxhzy000m0gg9fbadqrty 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 377.275 ms - -[0m
[0mPOST /api/assets [32m201[0m 9.120 ms - 499[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[HawlTrackingService] INFO: Created DRAFT record for user cmldpxilz000z0gg9bjpb1br2, wealth: 10000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

[0mPOST /api/auth/login [32m200[0m 335.736 ms - -[0m
[0mGET /api/nisab-year-records/clxxxxxxxxxxxxxxxxxxxxxxxx/assets/refresh [33m404[0m 4.359 ms - 66[0m
stdout | ../tests/contract/auth-login.test.ts > Contract Test: POST /api/auth/login
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 377.418 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 358.940 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxilz000z0gg9bjpb1br2 

[0mPOST /api/auth/register [32m201[0m 370.241 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 322.273 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 333.878 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets
[HawlTrackingService] INFO: Nisab detection complete: 0 DRAFT records created 

[0mPOST /api/auth/login [32m200[0m 339.600 ms - -[0m
[0mPOST /api/auth/login [33m401[0m 3.135 ms - 103[0m
[0mPOST /api/auth/login [33m400[0m 1.061 ms - 198[0m
[0mPOST /api/auth/login [33m400[0m 0.788 ms - 155[0m
[0mPOST /api/auth/login [33m400[0m 0.935 ms - 186[0m
[0mPOST /api/auth/login [33m401[0m 3.511 ms - 103[0m
 âœ“ ../tests/contract/auth-login.test.ts (5 tests) 2790ms
   âœ“ Contract Test: POST /api/auth/login > POST /api/auth/login > should accept valid login credentials and return standardized response  745ms
[0mPOST /api/auth/register [32m201[0m 339.235 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 365.918 ms - -[0m
stdout | ../tests/contract/methodology-config.contract.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8a7f47732c335f20.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8a7f47732c335f20.db

[0mPOST /api/auth/login [32m200[0m 355.212 ms - -[0m
[0mGET /api/nisab-year-records/cmldpxk24000v0ghhgj6hnit0/assets/refresh [33m403[0m 2.599 ms - 101[0m
[0mPOST /api/auth/login [32m200[0m 329.807 ms - -[0m
[0mPOST /api/assets [32m201[0m 13.966 ms - 504[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with assets below Nisab
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with assets below Nisab
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with assets below Nisab
[HawlTrackingService] INFO: Nisab detection complete: 0 DRAFT records created 

[0mPOST /api/auth/register [32m201[0m 371.372 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 346.025 ms - -[0m
stdout | ../tests/contract/methodology-config.contract.test.ts > Methodology Configuration Contract Tests
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxjsx001d0gg9m9t71kgx 

[0mPOST /api/auth/login [32m200[0m 349.702 ms - -[0m
[0mPOST /api/assets [32m201[0m 15.595 ms - 498[0m
[0mPOST /api/assets [32m201[0m 27.486 ms - 500[0m
[0mPOST /api/auth/login [32m200[0m 341.286 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mGET /api/nisab-year-records/cmldpxknw00140ghht6mtebyo/assets/refresh [32m200[0m 7.294 ms - 263[0m
[0mPOST /api/assets [32m201[0m 10.318 ms - 505[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[HawlTrackingService] INFO: Created DRAFT record for user cmldpxkdp001k0gg9y74sfcj8, wealth: 10000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

[0mPOST /api/auth/register [32m201[0m 334.184 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 336.219 ms - -[0m
stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxkce000w0ghhdavv13qj 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxkce000w0ghhdavv13qj 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxkdp001k0gg9y74sfcj8 

[0mPOST /api/auth/login [32m200[0m 377.259 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 345.264 ms - -[0m
[0mPOST /api/assets [32m201[0m 11.543 ms - 495[0m
[0mPOST /api/assets [32m201[0m 14.268 ms - 505[0m
stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 13.046 ms - 496[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 15.657 ms - 503[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[HawlTrackingService] INFO: Created DRAFT record for user cmldpxkz3001t0gg9ec074o65, wealth: 10000, Nisab: 5686.2 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved
[HawlTrackingService] INFO: Nisab detection complete: 0 DRAFT records created 

[0mPOST /api/assets [32m201[0m 19.277 ms - 495[0m
[0mGET /api/nisab-year-records/cmldpxlba001h0ghh1borckuq/assets/refresh [32m200[0m 5.814 ms - 638[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | ../tests/contract/methodology-config.contract.test.ts > Methodology Configuration Contract Tests
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 363.015 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 359.094 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxkz3001t0gg9ec074o65 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxky300150ghhj6285k3w 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxky300150ghhj6285k3w 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxky300150ghhj6285k3w 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxky300150ghhj6285k3w 

[0mPOST /api/auth/login [32m200[0m 335.694 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 9.861 ms - 505[0m
stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 11.199 ms - 501[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[HawlTrackingService] INFO: Created DRAFT record for user cmldpxllb00220gg9ry2r51dq, wealth: 7000, Nisab: 5686.2 

[0mPOST /api/auth/register [32m201[0m 391.563 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

[0mPOST /api/auth/login [32m200[0m 307.074 ms - -[0m
[0mGET /api/methodologies [32m200[0m 6.028 ms - -[0m
[0mGET /api/methodologies [33m401[0m 0.667 ms - 94[0m
[0mPOST /api/auth/register [32m201[0m 312.861 ms - -[0m
[0mGET /api/methodologies/STANDARD [32m200[0m 1.679 ms - -[0m
[0mGET /api/methodologies/UNKNOWN [33m404[0m 2.584 ms - 87[0m
[0mPUT /api/methodologies/STANDARD [33m400[0m 2.701 ms - 94[0m
[0mGET /api/methodologies/UNKNOWN [33m404[0m 2.233 ms - 87[0m
[0mPOST /api/methodologies/custom [32m201[0m 8.234 ms - 178[0m
[0mPUT /api/methodologies/cmldpxm7300040gk6yd7tmagr [32m200[0m 9.851 ms - 180[0m
[0mPUT /api/methodologies/STANDARD [33m400[0m 1.870 ms - 172[0m
[0mPUT /api/methodologies/INVALID_ID [33m404[0m 2.772 ms - 97[0m
[0mPOST /api/methodologies/custom [32m201[0m 7.595 ms - 235[0m
[0mPOST /api/methodologies/custom [33m400[0m 1.189 ms - 287[0m
[0mPOST /api/methodologies/custom [32m201[0m 7.993 ms - 178[0m
[0mDELETE /api/methodologies/cmldpxm8e00080gk619l6q8zy [32m200[0m 6.676 ms - 68[0m
[0mGET /api/methodologies/cmldpxm8e00080gk619l6q8zy [33m404[0m 2.261 ms - 105[0m
[0mDELETE /api/methodologies/STANDARD [33m400[0m 0.882 ms - 94[0m
 âœ“ ../tests/contract/methodology-config.contract.test.ts (13 tests) 2803ms
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxllb00220gg9ry2r51dq 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxllb00220gg9ry2r51dq 

stdout | ../tests/contract/calendar.contract.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c759d70ad072f9c9.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c759d70ad072f9c9.db

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/auth/login [32m200[0m 345.897 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 12.543 ms - 502[0m
[0mPOST /api/assets [32m201[0m 10.570 ms - 503[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[HawlTrackingService] INFO: Created DRAFT record for user cmldpxm5r002d0gg9opzmwf17, wealth: 7000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

[0mPOST /api/auth/register [32m201[0m 333.819 ms - -[0m
stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxm5r002d0gg9opzmwf17 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[HawlTrackingService] INFO: Handling wealth change for user cmldpxm5r002d0gg9opzmwf17 

[0mPOST /api/auth/login [32m200[0m 333.006 ms - -[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mPOST /api/assets [32m201[0m 9.050 ms - 502[0m
stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[HawlTrackingService] INFO: Starting Nisab achievement detection for all users 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[HawlTrackingService] INFO: Created DRAFT record for user cmldpxmtn002o0gg985xjhfns, wealth: 10000, Nisab: 5686.2 

stdout | tests/integration/hawlDetectionAssets.test.ts > Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure
[HawlTrackingService] INFO: Nisab detection complete: 1 DRAFT records created 

 âœ“ tests/integration/hawlDetectionAssets.test.ts (11 tests) 8709ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create DRAFT record with assetBreakdown populated when Nisab achieved  886ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should include correct asset details in snapshot  814ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should only include zakatable assets in snapshot  809ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should encrypt assetBreakdown field  785ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with no assets  747ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle user with assets below Nisab  757ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should create snapshot at exact moment of detection  777ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should not create duplicate records if Nisab already achieved  776ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should handle assets with zero value  782ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > Asset Snapshot Creation > should preserve asset order by addedAt date  840ms
   âœ“ Automatic Asset Inclusion in Hawl Detection > JSON Structure Validation > should match exact assetBreakdown JSON structure  731ms
stdout | src/__tests__/performance-testing.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c2cbe9064000a2b1.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c2cbe9064000a2b1.db

stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 âœ“ src/__tests__/performance-testing.test.ts (22 tests) 1194ms
   âœ“ Performance Testing and Optimization - T155 > Zakat Calculation Performance > should validate basic calculation performance <200ms  308ms
[0mPOST /api/auth/login [32m200[0m 326.599 ms - -[0m
[0mPOST /api/calendar/convert [32m200[0m 3.664 ms - 210[0m
[0mPOST /api/calendar/convert [32m200[0m 1.327 ms - 210[0m
[0mPOST /api/calendar/convert [33m400[0m 0.987 ms - 111[0m
[0mPOST /api/calendar/convert [33m400[0m 3.353 ms - 93[0m
[0mPOST /api/calendar/convert [33m400[0m 1.299 ms - 114[0m
[0mPOST /api/calendar/convert [33m401[0m 0.555 ms - 94[0m
[0mPOST /api/calendar/zakat-year [32m200[0m 1.342 ms - 284[0m
[0mPOST /api/calendar/zakat-year [32m200[0m 1.161 ms - 150[0m
[0mPOST /api/calendar/zakat-year [33m400[0m 0.934 ms - 107[0m
[0mPOST /api/calendar/zakat-year [33m400[0m 0.796 ms - 101[0m
[0mPOST /api/calendar/zakat-year [33m401[0m 0.605 ms - 94[0m
[0mGET /api/calendar/preference [32m200[0m 4.875 ms - 43[0m
[0mGET /api/calendar/preference [33m401[0m 0.375 ms - 94[0m
stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests > PUT /api/calendar/preference > should update calendar preference to HIJRI
Update Calendar/Methodology Request: {
  userId: [32m'cmldpxo3i00000gliyr7zjo7q'[39m,
  body: { preferredCalendar: [32m'HIJRI'[39m }
}

[0mPUT /api/calendar/preference [32m200[0m 8.922 ms - 98[0m
[0mGET /api/calendar/preference [32m200[0m 2.013 ms - 39[0m
stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests > PUT /api/calendar/preference > should update calendar preference to GREGORIAN
Update Calendar/Methodology Request: {
  userId: [32m'cmldpxo3i00000gliyr7zjo7q'[39m,
  body: { preferredCalendar: [32m'GREGORIAN'[39m }
}

[0mPUT /api/calendar/preference [32m200[0m 8.565 ms - 102[0m
[0mPUT /api/calendar/preference [33m400[0m 0.907 ms - 101[0m
stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests > PUT /api/calendar/preference > should reject invalid calendar preference
Update Calendar/Methodology Request: {
  userId: [32m'cmldpxo3i00000gliyr7zjo7q'[39m,
  body: { preferredCalendar: [32m'INVALID'[39m }
}

[0mPUT /api/calendar/preference [33m400[0m 1.077 ms - 146[0m
stdout | ../tests/contract/calendar.contract.test.ts > Calendar API Contract Tests > PUT /api/calendar/preference > should reject missing calendarPreference
Update Calendar/Methodology Request: { userId: [32m'cmldpxo3i00000gliyr7zjo7q'[39m, body: {} }

stdout | src/__tests__/integration/assets.eligibility.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-470feaee19b65a96.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-470feaee19b65a96.db

[0mPUT /api/calendar/preference [33m401[0m 0.503 ms - 94[0m
 âœ“ ../tests/contract/calendar.contract.test.ts (18 tests) 2515ms
stdout | src/__tests__/integration/assets.api.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ea35fae0b315e468.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ea35fae0b315e468.db

stdout | src/__tests__/integration/assets.eligibility.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/integration/assets.api.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [31m500[0m 5407.240 ms - 96[0m
stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/assetRefresh.test.ts > Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | src/__tests__/integration/assets.eligibility.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 351.248 ms - -[0m
stdout | src/__tests__/integration/assets.api.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/login [32m200[0m 347.439 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 398.839 ms - -[0m
[0mGET /api/nisab-year-records/some-id/assets/refresh [33m401[0m 0.280 ms - 94[0m
 â¯ tests/integration/assetRefresh.test.ts (9 tests | 1 failed) 12599ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return current assets for DRAFT record  852ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for FINALIZED record  780ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 400 for UNLOCKED record  709ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 404 for non-existent record  698ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should return 403 when accessing another user's record  1409ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should handle assets deleted after record creation  818ms
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should only return zakatable assets  828ms
   Ã— Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should allow updating record with refreshed assets and persist zakatable wealth correctly 5782ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   âœ“ Asset Refresh Workflow Integration Test > GET /api/nisab-year-records/:id/assets/refresh > should require authentication  720ms
[0mPOST /api/auth/register [32m201[0m 387.735 ms - -[0m
stdout | src/__tests__/authController.isVerified.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c873c706bf88b8e6.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c873c706bf88b8e6.db

[0mPOST /api/auth/login [32m200[0m 336.267 ms - -[0m
[0mPOST /api/assets [32m201[0m 15.758 ms - 505[0m
[0mGET /api/assets [32m200[0m 7.877 ms - 693[0m
[0mPUT /api/assets/cmldpxqmn00040gmutj9mox6a [32m200[0m 18.586 ms - 506[0m
[0mGET /api/assets [32m200[0m 3.000 ms - 691[0m
 âœ“ src/__tests__/integration/assets.eligibility.test.ts (1 test) 831ms
   âœ“ Integration: Asset eligibility and passive modifier > creates a passive asset, then disables eligibility and verifies summary excludes it  830ms
[0mPOST /api/auth/login [32m200[0m 337.381 ms - -[0m
[0mPOST /api/assets [32m201[0m 14.899 ms - 513[0m
 âœ“ src/__tests__/integration/assets.api.test.ts (1 test) 779ms
   âœ“ Integration: Auth and Assets API > should register, login, and create an asset successfully  777ms
stdout | src/__tests__/integration/analytics-api.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1842911749a32bcc.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1842911749a32bcc.db

stdout | tests/integration/hawlDetectionJob.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-da30e0339ac41195.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-da30e0339ac41195.db

stdout | src/__tests__/authController.isVerified.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionJob.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/integration/analytics-api.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/authController.isVerified.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | src/__tests__/integration/analytics-api.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/integration/hawlDetectionJob.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 429.184 ms - -[0m
stdout | tests/integration/hawlDetectionJob.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/auth/register [32m201[0m 387.469 ms - -[0m
[0mPOST /api/auth/login [32m200[0m 331.311 ms - -[0m
[0mGET /api/auth/me [32m200[0m 4.680 ms - 554[0m
[0mGET /api/analytics/summary [32m200[0m 36.960 ms - 841[0m
[0mPOST /api/auth/login [33m401[0m 2.205 ms - 103[0m
stdout | src/__tests__/authController.isVerified.test.ts > AuthController isVerified Response > Admin verification flow > should update isVerified status when admin verifies user
Skipping admin test - no admin user available

 âœ“ src/__tests__/authController.isVerified.test.ts (4 tests) 827ms
   âœ“ AuthController isVerified Response > POST /auth/register > should return isVerified field in response  460ms
   âœ“ AuthController isVerified Response > POST /auth/login > should return isVerified field in response  337ms
[0mGET /api/analytics/summary?year=2024 [32m200[0m 28.213 ms - 841[0m
[0mGET /api/analytics/summary?includeTrends=true [32m200[0m 27.491 ms - -[0m
[0mPOST /api/auth/register [32m201[0m 392.896 ms - -[0m
[0mGET /api/analytics/metrics [32m200[0m 57.780 ms - -[0m
[0mPOST /api/assets [32m201[0m 19.544 ms - 496[0m
[0mGET /api/analytics/metrics?metricTypes=wealth_trend,zakat_trend [32m200[0m 34.254 ms - 763[0m
stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should reconcile wealth drift in DRAFT records
[hawlDetectionJob] INFO: Starting Hawl detection & reconciliation job 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should reconcile wealth drift in DRAFT records
[hawlDetectionJob] INFO: Processing 1 users 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should reconcile wealth drift in DRAFT records
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

[0mGET /api/analytics/trends [32m200[0m 29.275 ms - 780[0m
stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should reconcile wealth drift in DRAFT records
[AuditTrailService] INFO: Audit event recorded: NISAB_ACHIEVED for record cmldpxt4300060gpojnoperjn 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should reconcile wealth drift in DRAFT records
[hawlDetectionJob] INFO: SAFETY NET: Started missed Hawl for user cmldpxt1q00000gpoh38us4s7 
[hawlDetectionJob] INFO: Hawl detection job complete: 1 users, 1 reconciled, 1 achievements, 0 interruptions, 0 completions, 0 errors, 38ms 

[0mGET /api/analytics/trends?period=6months [32m200[0m 25.415 ms - 779[0m
[0mPOST /api/assets [32m201[0m 15.773 ms - 495[0m
stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should detect missed Nisab achievement (Safety Net)
[hawlDetectionJob] INFO: Starting Hawl detection & reconciliation job 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should detect missed Nisab achievement (Safety Net)
[hawlDetectionJob] INFO: Processing 1 users 

[0mGET /api/analytics/comparison [32m200[0m 16.726 ms - 421[0m
stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should detect missed Nisab achievement (Safety Net)
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

stdout | tests/integration/hawlDetectionJob.test.ts > Integration: Hawl Detection & Reconciliation Job > should detect missed Nisab achievement (Safety Net)
[hawlDetectionJob] INFO: SAFETY NET: Detected missed Nisab achievement for user cmldpxt1q00000gpoh38us4s7 
[hawlDetectionJob] INFO: Hawl detection job complete: 1 users, 0 reconciled, 1 achievements, 0 interruptions, 0 completions, 0 errors, 13ms 

[0mGET /api/analytics/comparison?period1=2025&period2=2026 [32m200[0m 13.738 ms - 416[0m
[0mPOST /api/analytics/cache/clear [32m200[0m 10.080 ms - 65[0m
 âœ“ src/__tests__/integration/analytics-api.test.ts (10 tests) 747ms
 âœ“ tests/integration/hawlDetectionJob.test.ts (2 tests) 583ms
stdout | tests/contract/nisabYearRecords.get.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-d9f6bd836a1a1d61.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-d9f6bd836a1a1d61.db

stdout | tests/contract/nisabYearRecords.unlock.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ee99fe051a0cbe0d.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-ee99fe051a0cbe0d.db

stdout | tests/performance/wealthAggregation.performance.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-088836dd35853c13.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-088836dd35853c13.db

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should calculate wealth for 500 assets in < 100ms

âœ“ Wealth calculation: 7ms for 500 assets

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should maintain consistent performance across 10 runs

âœ“ Average: 6.80ms
  Min: 5ms, Max: 9ms

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should handle incremental load (50, 100, 250, 500 assets)

ðŸ“Š Performance scaling:

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should handle incremental load (50, 100, 250, 500 assets)
  50 assets: 2ms (target: <50ms)

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should handle incremental load (50, 100, 250, 500 assets)
  100 assets: 3ms (target: <75ms)

stdout | tests/contract/nisabYearRecords.get.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should handle incremental load (50, 100, 250, 500 assets)
  250 assets: 4ms (target: <90ms)

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should handle incremental load (50, 100, 250, 500 assets)
  500 assets: 6ms (target: <100ms)

stdout | tests/performance/wealthAggregation.performance.test.ts > WealthAggregationService Performance > should efficiently query with userId + isActive index

âœ“ Indexed query: 5ms (excellent performance)

 âœ“ tests/performance/wealthAggregation.performance.test.ts (4 tests) 428ms
stdout | tests/contract/nisabYearRecords.unlock.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.finalize.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9e2cec2a4daa83e6.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-9e2cec2a4daa83e6.db

stdout | tests/contract/nisabYearRecords.finalize.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.get.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.get.test.ts
JWT_SECRET (jwt.ts): supersecret

[0mGET /api/nisab-year-records [32m200[0m 14.719 ms - 86[0m
[0mGET /api/nisab-year-records [32m200[0m 7.431 ms - -[0m
[0mGET /api/nisab-year-records?status=DRAFT [32m200[0m 5.628 ms - -[0m
[0mGET /api/nisab-year-records?status=FINALIZED [32m200[0m 3.596 ms - -[0m
[0mGET /api/nisab-year-records?year=2025 [32m200[0m 3.661 ms - -[0m
[0mGET /api/nisab-year-records?status=ALL [32m200[0m 4.208 ms - -[0m
[0mGET /api/nisab-year-records [33m401[0m 0.526 ms - 94[0m
[0mGET /api/nisab-year-records [33m401[0m 0.627 ms - 91[0m
stdout | tests/contract/nisabYearRecords.unlock.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mGET /api/nisab-year-records [32m200[0m 3.887 ms - 86[0m
[0mGET /api/nisab-year-records/cmldpxva7000f0gqq2ct1vwh3 [32m200[0m 10.962 ms - -[0m
 âœ“ tests/contract/nisabYearRecords.get.test.ts (10 tests) 304ms
stdout | tests/contract/nisabYearRecords.unlock.test.ts
JWT_SECRET (jwt.ts): supersecret

stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Successful Unlock > should unlock FINALIZED record with valid reason
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpxvcs00020gr9ct72s6i2 

stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Successful Unlock > should unlock FINALIZED record with valid reason
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpxvcs00020gr9ct72s6i2 with reason: Need to correct tota... 

[0mPOST /api/nisab-year-records/cmldpxvcs00020gr9ct72s6i2/unlock [32m200[0m 39.410 ms - -[0m
stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Successful Unlock > should create audit trail entry with unlock reason
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpxvf300060gr9iholxf21 

stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Successful Unlock > should create audit trail entry with unlock reason
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpxvf300060gr9iholxf21 with reason: Discovered uncounted... 

[0mPOST /api/nisab-year-records/cmldpxvf300060gr9iholxf21/unlock [32m200[0m 31.479 ms - -[0m
[0mPOST /api/nisab-year-records/cmldpxvgz000a0gr9vn2uffsd/unlock [33m400[0m 6.416 ms - 81[0m
[0mPOST /api/nisab-year-records/cmldpxvig000c0gr9n7jrkqov/unlock [33m400[0m 0.995 ms - 100[0m
[0mPOST /api/nisab-year-records/cmldpxvj7000e0gr9gunjbrfg/unlock [33m409[0m 20.829 ms - 90[0m
stdout | tests/contract/nisabYearRecords.delete.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a0fcffd4dd9b1564.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-a0fcffd4dd9b1564.db

[0mPOST /api/nisab-year-records/cmldpxvkf000g0gr9z3c3i2u5/unlock [33m409[0m 3.432 ms - 93[0m
[0mPOST /api/nisab-year-records/00000000-0000-0000-0000-000000000000/unlock [33m404[0m 2.748 ms - 66[0m
[0mPOST /api/nisab-year-records/some-id/unlock [33m401[0m 0.619 ms - 94[0m
[0mPOST /api/nisab-year-records/cmldpxvlp000i0gr93ywc7wbg/unlock [33m404[0m 3.820 ms - 66[0m
stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Response Schema Validation > should return correct response structure
[AuditTrailService] INFO: Audit event recorded: UNLOCKED for record cmldpxvmv000l0gr9b07jvyco 

stdout | tests/contract/nisabYearRecords.unlock.test.ts > POST /api/nisab-year-records/:id/unlock - Contract Tests > Response Schema Validation > should return correct response structure
[NisabYearRecordService] INFO: Nisab Year Record unlocked: cmldpxvmv000l0gr9b07jvyco with reason: Correction needed fo... 

[0mPOST /api/nisab-year-records/cmldpxvmv000l0gr9b07jvyco/unlock [32m200[0m 17.718 ms - -[0m
 âœ“ tests/contract/nisabYearRecords.unlock.test.ts (10 tests) 435ms
stdout | src/__tests__/calculation-history-basic.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-0323373fcdad017c.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-0323373fcdad017c.db

stdout | tests/contract/nisabYearRecords.finalize.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 âœ“ src/__tests__/calculation-history-basic.test.ts (3 tests) 57ms
stdout | tests/contract/nisabYearRecords.finalize.test.ts
JWT_SECRET (jwt.ts): supersecret

stdout | tests/contract/nisabYearRecords.finalize.test.ts > POST /api/nisab-year-records/:id/finalize - Contract Tests > Successful Finalization > should finalize DRAFT record when Hawl is complete
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpxw3000020gt0cqdqmbx9 

stdout | tests/contract/nisabYearRecords.finalize.test.ts > POST /api/nisab-year-records/:id/finalize - Contract Tests > Successful Finalization > should finalize DRAFT record when Hawl is complete
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpxw3000020gt0cqdqmbx9 with Zakat 0 

[0mPOST /api/nisab-year-records/cmldpxw3000020gt0cqdqmbx9/finalize [32m200[0m 39.532 ms - -[0m
[0mPOST /api/nisab-year-records/cmldpxw5n00060gt00wvnn5by/finalize [33m409[0m 6.215 ms - 115[0m
stdout | tests/contract/nisabYearRecords.finalize.test.ts > POST /api/nisab-year-records/:id/finalize - Contract Tests > Successful Finalization > should allow finalization with override flag even when Hawl early
[AuditTrailService] INFO: Audit event recorded: FINALIZED for record cmldpxw5n00060gt00wvnn5by 

stdout | tests/contract/nisabYearRecords.finalize.test.ts > POST /api/nisab-year-records/:id/finalize - Contract Tests > Successful Finalization > should allow finalization with override flag even when Hawl early
[NisabYearRecordService] INFO: Nisab Year Record finalized: cmldpxw5n00060gt00wvnn5by with Zakat 0 

stdout | tests/contract/nisabYearRecords.delete.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

[0mPOST /api/nisab-year-records/cmldpxw5n00060gt00wvnn5by/finalize [32m200[0m 32.033 ms - -[0m
[0mPOST /api/nisab-year-records/cmldpxw7q000a0gt0opsu0ctp/finalize [33m409[0m 4.661 ms - 115[0m
stdout | ../tests/unit/JWTService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-858c1f3ef776d587.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-858c1f3ef776d587.db

[0mPOST /api/nisab-year-records/cmldpxw8m000c0gt0mxyttlk0/finalize [33m409[0m 3.552 ms - 115[0m
[0mPOST /api/nisab-year-records/cmldpxw9p000e0gt0uioo3957/finalize [33m409[0m 4.257 ms - 96[0m
[0mPOST /api/nisab-year-records/00000000-0000-0000-0000-000000000000/finalize [33m404[0m 4.527 ms - 66[0m
[0mPOST /api/nisab-year-records/some-id/finalize [33m401[0m 0.472 ms - 94[0m
 âœ“ tests/contract/nisabYearRecords.finalize.test.ts (7 tests) 318ms
 âœ“ ../tests/unit/JWTService.test.ts (25 tests) 50ms
stdout | src/__tests__/unit/AnalyticsService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1a549cd816a48eb5.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1a549cd816a48eb5.db

stdout | src/services/__tests__/AssetService.categoryNormalization.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f89fe1502928bfaf.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f89fe1502928bfaf.db

 âœ“ src/__tests__/unit/AnalyticsService.test.ts (26 tests) 41ms
stdout | src/services/__tests__/AssetService.categoryNormalization.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 âœ“ src/services/__tests__/AssetService.categoryNormalization.test.ts (2 tests) 28ms
stdout | src/__tests__/calculation-history.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-3ea84987a41250f3.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-3ea84987a41250f3.db

stdout | ../tests/unit/ValidationMiddleware.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8b9aee803a0ab53f.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-8b9aee803a0ab53f.db

 âœ“ src/__tests__/calculation-history.test.ts (31 tests) 32ms
 âœ“ ../tests/unit/ValidationMiddleware.test.ts (20 tests) 38ms
stdout | tests/unit/services/auditTrailService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-cda369febc28bffc.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-cda369febc28bffc.db

stdout | tests/unit/services/auditTrailService.test.ts > AuditTrailService > recordEvent > should record CREATED event for new Nisab Year Record
[AuditTrailService] INFO: Audit event recorded: CREATED for record record1 

 âœ“ tests/unit/services/auditTrailService.test.ts (4 tests) 33ms
stdout | tests/unit/services/nisabYearRecordService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-4d829a351c4ae9a3.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-4d829a351c4ae9a3.db

stdout | tests/contract/nisabYearRecords.delete.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.delete.test.ts
JWT_SECRET (jwt.ts): supersecret

stdout | tests/unit/services/nisabYearRecordService.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/contract/nisabYearRecords.delete.test.ts > DELETE /api/nisab-year-records/:id - Contract Tests > Successful Deletion > should delete DRAFT record
[NisabYearRecordService] INFO: Nisab Year Record deleted: cmldpxxu800020gts5gbvxqgf 

stdout | tests/unit/services/nisabYearRecordService.test.ts > NisabYearRecordService > createRecord > should create a new DRAFT Nisab Year Record
[NisabYearRecordService] INFO: Nisab Year Record created: record1 for user user1 

stdout | src/__tests__/methodology-selection-guide.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-447d90a670919f13.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-447d90a670919f13.db

[0mDELETE /api/nisab-year-records/cmldpxxu800020gts5gbvxqgf [32m200[0m 31.313 ms - 56[0m
 âœ“ tests/unit/services/nisabYearRecordService.test.ts (4 tests) 31ms
stdout | tests/contract/nisabYearRecords.delete.test.ts > DELETE /api/nisab-year-records/:id - Contract Tests > Successful Deletion > should allow delete of UNLOCKED record
[NisabYearRecordService] INFO: Nisab Year Record deleted: cmldpxxws00040gtsd18ihnc6 

[0mDELETE /api/nisab-year-records/cmldpxxws00040gtsd18ihnc6 [32m200[0m 16.410 ms - 56[0m
[0mDELETE /api/nisab-year-records/cmldpxxxw00060gtsqubl6xpt [33m409[0m 22.307 ms - 137[0m
stdout | src/__tests__/methodology-selection-guide.test.ts > T158: Methodology Selection Guide > Summary and Validation > should meet all T158 requirements
âœ… T158 Requirement: decisionTree - Met
âœ… T158 Requirement: regionalRecommendations - Met
âœ… T158 Requirement: assetConsiderations - Met
âœ… T158 Requirement: quiz - Met
âœ… T158 Requirement: additionalResources - Met
âœ… T158 Requirement: clearAndHelpful - Met
âœ… T158 Requirement: logicalProcess - Met
âœ… T158 Requirement: beginnerAccessible - Met
âœ… T158 Requirement: scholarConsultation - Met

stdout | src/__tests__/methodology-selection-guide.test.ts > T158: Methodology Selection Guide

ðŸŽ¯ T158 Completion Summary:
ðŸ“„ Guide Length: 3891 words
ðŸ“‹ Major Sections: 14
âœ… Decision Tree: Included
ðŸŒ Regional Recommendations: 7 regions covered
ðŸ’¼ Asset Type Guidance: 5 categories covered
â“ Interactive Quiz: 5 questions with profile matching
ðŸŽ“ Educational Content: Comprehensive methodology explanations
ðŸ“š Additional Resources: Scholar consultation and tools
ðŸ”° Beginner Friendly: Clear language and step-by-step guidance
ðŸ‘¨â€ðŸ« Scholar Consultation: Encouraged throughout guide

ðŸ† T158 Status: COMPLETE - Comprehensive methodology selection guide created

 âœ“ src/__tests__/methodology-selection-guide.test.ts (25 tests) 54ms
[0mDELETE /api/nisab-year-records/cmldpxxzm00080gts4231zbxk [33m409[0m 5.643 ms - 137[0m
[0mDELETE /api/nisab-year-records/00000000-0000-0000-0000-000000000000 [33m404[0m 5.604 ms - 66[0m
[0mDELETE /api/nisab-year-records/some-id [33m401[0m 0.507 ms - 94[0m
[0mDELETE /api/nisab-year-records/cmldpxy1e000a0gtsun1r1zci [33m404[0m 3.785 ms - 66[0m
 âœ“ tests/contract/nisabYearRecords.delete.test.ts (7 tests) 359ms
stdout | src/__tests__/SyncService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2241437dca325e3a.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2241437dca325e3a.db

stdout | src/__tests__/unit/ReminderService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b945f53e04bd12d4.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-b945f53e04bd12d4.db

 âœ“ src/__tests__/unit/ReminderService.test.ts (32 tests) 21ms
stdout | src/__tests__/unit/AnnualSummaryService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-43b248545eb41065.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-43b248545eb41065.db

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Ensuring CouchDB user: user_test_user 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Ensure CouchDB user: user_test_user (Synced Credentials) 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Creating database: zakapp_test_user_assets 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Created database: zakapp_test_user_assets 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Creating database: zakapp_test_user_liabilities 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Created database: zakapp_test_user_liabilities 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Creating database: zakapp_test_user_nisab_year_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Created database: zakapp_test_user_nisab_year_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Creating database: zakapp_test_user_payment_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Created database: zakapp_test_user_payment_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Creating database: zakapp_test_user_user_settings 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should create user and databases if they do not exist
[SyncService] INFO: Created database: zakapp_test_user_user_settings 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should handle existing user by updating with revision
[SyncService] INFO: Ensuring CouchDB user: user_test_user 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should handle existing user by updating with revision
[SyncService] INFO: CouchDB user exists: user_test_user (rev: 1-old) 

stdout | src/__tests__/SyncService.test.ts > SyncService > ensureUserAndDatabases > should handle existing user by updating with revision
[SyncService] INFO: Ensure CouchDB user: user_test_user (Synced Credentials) 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should delete all user databases and the user document
[SyncService] INFO: Deleting CouchDB user and data for: user_test_user 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Deleting CouchDB user and data for: user_test_user 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Database already gone: zakapp_test_user_assets 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Database already gone: zakapp_test_user_liabilities 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Database already gone: zakapp_test_user_nisab_year_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Database already gone: zakapp_test_user_payment_records 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: Database already gone: zakapp_test_user_user_settings 

stdout | src/__tests__/SyncService.test.ts > SyncService > deleteUser > should handle already deleted databases gracefully
[SyncService] INFO: CouchDB user already gone: user_test_user 

 âœ“ src/__tests__/SyncService.test.ts (4 tests) 22ms
 âœ“ src/__tests__/unit/AnnualSummaryService.test.ts (23 tests) 24ms
stdout | src/__tests__/unit/ComparisonService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-65b3c6f7a175d87f.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-65b3c6f7a175d87f.db

stdout | src/__tests__/methodology-documentation.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-97130ed8e5def779.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-97130ed8e5def779.db

stdout | src/__tests__/methodology-documentation.test.ts > User Documentation for Methodologies - T156 > Documentation Structure and Content > should have comprehensive methodology guide documentation
CWD: /home/chuwi_agent/workspace/zakapp/server
Docs Path: /home/chuwi_agent/workspace/zakapp/client/public/docs/methodology-guide.md
Exists: [33mtrue[39m

 âœ“ src/__tests__/unit/ComparisonService.test.ts (23 tests) 24ms
stdout | src/__tests__/methodology-documentation.test.ts > User Documentation for Methodologies - T156 > Documentation Validation Summary > should meet all T156 requirements
âœ… T156 Requirement: methodologyExplanations - Met
âœ… T156 Requirement: selectionGuidance - Met
âœ… T156 Requirement: comparisonCharts - Met
âœ… T156 Requirement: practicalExamples - Met
âœ… T156 Requirement: comprehensiveContent - Met
âœ… T156 Requirement: userFriendly - Met
âœ… T156 Requirement: accurate - Met
âœ… T156 Requirement: completeGuide - Met
ðŸŽ¯ T156 Completion Rate: 100%

 âœ“ src/__tests__/methodology-documentation.test.ts (23 tests) 26ms
stdout | src/__tests__/unit/CalendarConversionService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f24b7ee52d6684cd.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-f24b7ee52d6684cd.db

stdout | tests/unit/services/wealthAggregationService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2e2b3bc331100309.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-2e2b3bc331100309.db

stdout | src/services/__tests__/NisabService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-d1a90bce2db3bc67.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-d1a90bce2db3bc67.db

 âœ“ tests/unit/services/wealthAggregationService.test.ts (6 tests) 16ms
stdout | src/__tests__/utils/schemaCheck.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1cd0ce5b2f352b22.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-1cd0ce5b2f352b22.db

 âœ“ src/services/__tests__/NisabService.test.ts (6 tests) 14ms
 âœ“ src/__tests__/utils/schemaCheck.test.ts (5 tests) 15ms
stdout | src/__tests__/unit/PaymentService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5bd3843522a6c5a9.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-5bd3843522a6c5a9.db

stdout | tests/unit/services/nisabCalculationService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c3e16c0bb9b2b182.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-c3e16c0bb9b2b182.db

 âœ“ src/__tests__/unit/PaymentService.test.ts (6 tests) 14ms
stdout | tests/unit/services/nisabCalculationService.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

stdout | tests/unit/services/nisabCalculationService.test.ts > NisabCalculationService > calculateNisabThreshold > should use fallback prices if API fetch fails
[NisabCalculationService] INFO: Using fallback gold price: $65/gram 
[NisabCalculationService] INFO: Using fallback silver price: $0.75/gram 

 âœ“ tests/unit/services/nisabCalculationService.test.ts (4 tests) 20ms
stdout | src/services/__tests__/AssetService.update.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-02746d9afaba88da.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-02746d9afaba88da.db

 âœ“ src/__tests__/unit/CalendarConversionService.test.ts (20 tests) 41ms
stdout | src/services/__tests__/EncryptionService.decryption-tolerance.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-4576c52270fb1c39.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-4576c52270fb1c39.db

 âœ“ src/services/__tests__/EncryptionService.decryption-tolerance.test.ts (3 tests) 7ms
stdout | src/services/__tests__/AssetService.update.test.ts
[APP] INFO: GOLD_API_KEY not configured. Using fallback precious metal prices (Gold: $65/g, Silver: $0.75/g) 

 âœ“ src/services/__tests__/AssetService.update.test.ts (2 tests) 9ms
stdout | src/__tests__/utils/assetModifiers.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-bb050b731e866499.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-bb050b731e866499.db

 âœ“ src/__tests__/utils/assetModifiers.test.ts (8 tests) 5ms
stdout | ../tests/unit/stableId.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-de4bc1692a8b4bff.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-de4bc1692a8b4bff.db

 âœ“ ../tests/unit/stableId.test.ts (3 tests) 6ms
stdout | src/services/__tests__/WealthAggregationService.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-eb941bf6af60599e.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-eb941bf6af60599e.db

 âœ“ src/services/__tests__/WealthAggregationService.test.ts (1 test) 4ms
stdout | src/__tests__/integration/assets.passive.test.ts
Copied base database (761856 bytes) to /home/chuwi_agent/workspace/zakapp/server/prisma/test/test-e0862aef65e10e67.db
Test database created successfully (761856 bytes)
Test DATABASE_URL: file:/home/chuwi_agent/workspace/zakapp/server/prisma/test/test-e0862aef65e10e67.db

 âœ“ src/__tests__/integration/assets.passive.test.ts (5 tests) 4ms

 Test Files  60 failed | 42 passed (102)
      Tests  166 failed | 649 passed | 34 skipped (849)
   Start at  12:26:44
   Duration  72.77s (transform 2.81s, setup 998ms, collect 84.73s, tests 94.72s, environment 29ms, prepare 10.45s)

